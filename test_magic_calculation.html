<!DOCTYPE html>
<html>
<head>
    <title>NPB ë§¤ì§ë„˜ë²„ ê³„ì‚° ê²€ì¦</title>
    <meta charset="utf-8">
</head>
<body>
    <h1>NPB ë§¤ì§ë„˜ë²„ ê³„ì‚° ë¡œì§ ê²€ì¦</h1>
    
    <h2>ì‹¤ì œ ë°ì´í„° (2025-09-06 ì„¼íŠ¸ëŸ´ë¦¬ê·¸)</h2>
    <ul>
        <li><strong>1ìœ„ HAN(í•œì‹ )</strong>: 76ìŠ¹ 45íŒ¨ 3ë¬´ (124ê²½ê¸°)</li>
        <li><strong>2ìœ„ YOG(ê±°ì¸)</strong>: 59ìŠ¹ 62íŒ¨ 3ë¬´ (124ê²½ê¸°)</li>
    </ul>
    
    <h2>ìˆ˜ë™ ê³„ì‚°</h2>
    <div id="manual-calc"></div>
    
    <h2>ì œê³µëœ ë¡œì§ìœ¼ë¡œ ê³„ì‚°</h2>
    <div id="logic-calc"></div>

    <script>
        // ===== ì œê³µëœ ë§¤ì§ë„˜ë²„ ê³„ì‚° ë¡œì§ =====
        function calcR(team, season=143) {
            return season - (team.W + team.L + team.T);
        }
        function winPct(team, R) {
            const denom = team.W + team.L;
            return denom > 0 ? team.W / denom : 0;
        }
        function pMax(team, R) {
            const denom = team.W + team.L + R;
            return denom > 0 ? (team.W + R) / denom : 0;
        }
        function pMin(team, R) {
            const denom = team.W + team.L + R;
            return denom > 0 ? (team.W) / denom : 0;
        }
        function clamp(v, lo, hi) { return Math.max(lo, Math.min(hi, v)); }
        function round3(x){ return Number(x.toFixed(3)); }

        function sortStandings(teams, season=143) {
            return [...teams].map(t => {
                const R = calcR(t, season);
                return { ...t, R, winPct: winPct(t, R) };
            }).sort((a,b)=> b.winPct - a.winPct);
        }

        function officialLeaderMagicTragic(teams, season=143) {
            const table = sortStandings(teams, season);
            const leader = table[0];
            const runner = table[1];

            const R1 = leader.R;
            const D1 = leader.W + leader.L + R1;
            const R2 = runner.R;
            const D2 = runner.W + runner.L + R2;

            // 1ìœ„ í™•ì •(ë§¤ì§)
            const K1_official = (runner.W + R2) / D2;
            const needWins_rhs = K1_official * D1 - leader.W;
            const x_strict = Math.max(0, Math.floor(needWins_rhs) + 1);
            const x_tieOK  = Math.max(0, Math.ceil(needWins_rhs));
            const x_strict_c = clamp(x_strict, 0, R1);
            const x_tieOK_c  = clamp(x_tieOK,  0, R1);

            return {
                leader: { id: leader.id, W: leader.W, L: leader.L, T: leader.T, R: leader.R, winPct: round3(leader.winPct) },
                runnerUp: { id: runner.id, W: runner.W, L: runner.L, T: runner.T, R: runner.R, winPct: round3(runner.winPct) },
                K1_official: round3(K1_official),
                x_strict: x_strict_c,
                x_tieOK: x_tieOK_c
            };
        }

        // ===== ê²€ì¦ ì‹¤í–‰ =====
        const teams = [
            { id: "HAN", W: 76, L: 45, T: 3 },
            { id: "YOG", W: 59, L: 62, T: 3 }
        ];

        // ìˆ˜ë™ ê³„ì‚°
        const han_remaining = 143 - (76 + 45 + 3); // 19ê²½ê¸°
        const yog_remaining = 143 - (59 + 62 + 3); // 19ê²½ê¸°
        const yog_max_wins = 59 + 19; // 78ìŠ¹
        const manual_magic = yog_max_wins - 76 + 1; // = 3

        document.getElementById('manual-calc').innerHTML = `
            <p><strong>í•œì‹  ì”ì—¬ê²½ê¸°:</strong> 143 - (76+45+3) = ${han_remaining}ê²½ê¸°</p>
            <p><strong>ê±°ì¸ ì”ì—¬ê²½ê¸°:</strong> 143 - (59+62+3) = ${yog_remaining}ê²½ê¸°</p>
            <p><strong>ê±°ì¸ ìµœëŒ€ ê°€ëŠ¥ ìŠ¹ìˆ˜:</strong> 59 + ${yog_remaining} = ${yog_max_wins}ìŠ¹</p>
            <p><strong>ë§¤ì§ë„˜ë²„ (ê³µì‹):</strong> ${yog_max_wins} - 76 + 1 = <strong style="color:blue">${manual_magic}</strong></p>
        `;

        // ì œê³µëœ ë¡œì§ ê³„ì‚°
        const result = officialLeaderMagicTragic(teams, 143);
        
        document.getElementById('logic-calc').innerHTML = `
            <p><strong>ë¦¬ë”:</strong> ${result.leader.id} (${result.leader.W}ìŠ¹ ${result.leader.L}íŒ¨ ${result.leader.T}ë¬´, ì”ì—¬ ${result.leader.R}ê²½ê¸°)</p>
            <p><strong>2ìœ„:</strong> ${result.runnerUp.id} (${result.runnerUp.W}ìŠ¹ ${result.runnerUp.L}íŒ¨ ${result.runnerUp.T}ë¬´, ì”ì—¬ ${result.runnerUp.R}ê²½ê¸°)</p>
            <p><strong>2ìœ„ ìµœëŒ€ ìŠ¹ë¥ :</strong> ${result.K1_official}</p>
            <p><strong>ë§¤ì§ë„˜ë²„ (ë™ë¥  ë¶ˆí—ˆ):</strong> <strong style="color:green">${result.x_strict}</strong></p>
            <p><strong>ë§¤ì§ë„˜ë²„ (ë™ë¥  í—ˆìš©):</strong> <strong style="color:green">${result.x_tieOK}</strong></p>
        `;

        // ê²€ì¦ ê²°ê³¼
        const isCorrect = manual_magic === result.x_strict;
        document.body.innerHTML += `
            <h2>ğŸ” ê²€ì¦ ê²°ê³¼</h2>
            <p style="font-size: 18px; color: ${isCorrect ? 'green' : 'red'};">
                <strong>${isCorrect ? 'âœ… ê³„ì‚° ì¼ì¹˜!' : 'âŒ ê³„ì‚° ë¶ˆì¼ì¹˜!'}</strong>
            </p>
            <p>ìˆ˜ë™ ê³„ì‚°: ${manual_magic}</p>
            <p>ë¡œì§ ê³„ì‚°: ${result.x_strict} (ë™ë¥ ë¶ˆí—ˆ) / ${result.x_tieOK} (ë™ë¥ í—ˆìš©)</p>
        `;
    </script>
</body>
</html>