# 🏟️ NPB Dashboard 상세 기능 명세서

## 📋 목차

- [1. 실시간 순위표 시스템](#1-실시간-순위표-시스템)
- [2. 매직넘버 분석 시스템](#2-매직넘버-분석-시스템)
- [3. 상대전적 매트릭스](#3-상대전적-매트릭스)
- [4. 분석 대시보드](#4-분석-대시보드)
- [5. API 서비스](#5-api-서비스)
- [6. 사용자 인터페이스](#6-사용자-인터페이스)
- [7. 데이터 관리 시스템](#7-데이터-관리-시스템)

---

## 1. 실시간 순위표 시스템

### 1.1 기본 순위표
**기능 ID**: `STANDINGS-001`

#### 표시 정보
- **기본 순위 정보**
  - 순위 (1-6위)
  - 팀명 (한글/영문/일본어)
  - 경기수 (총 144경기)
  - 승수 / 패수 / 무승부수
  - 승률 (소수점 3자리)
  - 게임차 (선두팀 대비)

- **추가 통계**
  - 득실차 (득점 - 실점)
  - 연속 기록 (승/패/무 연속)
  - 최근 10경기 성적
  - 홈/원정 성적
  - 매직넘버 (우승/플레이오프)

#### 시각적 특징
- **리그별 색상 구분**
  - 센트럴 리그: 빨간색 계열 (#d32f2f)
  - 퍼시픽 리그: 파란색 계열 (#1976d2)
  
- **순위별 하이라이트**
  - 1위: 황금색 배경
  - 2-3위 (플레이오프): 연한 녹색 배경
  - 6위: 연한 빨간색 배경

- **팀 색상 인디케이터**
  - 각 팀 고유 색상으로 왼쪽 세로 바 표시
  - 팀 로고 썸네일 (20x20px)

### 1.2 상세 순위 정보
**기능 ID**: `STANDINGS-002`

#### 확장 통계
- **월별 성적 추이**
  - 3월~10월 월별 승률
  - 시즌 중반/후반 페이스 분석
  
- **상황별 성적**
  - 주간 경기 vs 야간 경기
  - 토요일/일요일 성적
  - 연장전 기록
  
- **투타 지표**
  - 팀 타율 / 팀 방어율
  - 홈런수 / 도루수
  - 실책수 / WHIP

### 1.3 순위 변동 추적
**기능 ID**: `STANDINGS-003`

#### 순위 변동 히스토리
- **일별 순위 변동**
  - 전일 대비 순위 변화 (↑↓→)
  - 지난 7일간 순위 변동 그래프
  
- **시즌 순위 추이**
  - 개막일부터 현재까지 순위 라인 차트
  - 주요 전환점 마킹 (연승/연패 시작점)

---

## 2. 매직넘버 분석 시스템

### 2.1 기본 매직넘버
**기능 ID**: `MAGIC-001`

#### 우승 매직넘버
- **정의**: 리그 우승 확정까지 필요한 승수
- **계산 방식**: `(리그 총 경기수 + 1) - 현재 승수 - 2위팀 잔여 승수`
- **표시 정보**:
  - 숫자 매직넘버 (1~99, 또는 "E"=탈락)
  - 우승 확률 백분율 (%)
  - 남은 경기수 대비 필요 승률

#### 플레이오프 매직넘버  
- **정의**: 플레이오프 진출 확정까지 필요한 승수
- **CS 진출 조건**: 리그 3위 이내
- **표시 정보**:
  - 플레이오프 매직넘버
  - 진출 확률 백분율
  - 안전권 진입 시점 예측

### 2.2 매직넘버 서브탭 시스템
**기능 ID**: `MAGIC-002`

#### 🎲 우승 & 플레이오프 경우의 수
- **시나리오 시뮬레이션**
  - 총 가능한 시나리오 수 (조합론적 계산)
  - 우승 가능한 시나리오 수
  - 플레이오프 진출 시나리오 수
  - 탈락 시나리오 수

- **확률 분포 시각화**
  - 파이 차트: 우승/플레이오프/탈락 확률
  - 막대 그래프: 최종 순위별 확률 분포

#### 🎯 1위 탈환 가능성  
- **역전 시나리오 분석**
  - 현재 2위 이하 팀의 1위 탈환 가능성
  - 필요한 연승 수
  - 상위 팀이 져야 하는 경기 수
  
- **직접 대결 중요도**
  - 상위 팀과의 잔여 직접 대결 일정
  - 각 경기의 매직넘버 영향도 분석

#### 🏟️ 플레이오프 진출 조건
- **리그별 플레이오프 시스템**
  - 센트럴: 상위 3팀 → 클라이맥스 시리즈
  - 퍼시픽: 상위 3팀 → 클라이맥스 시리즈
  
- **진출 시나리오**
  - 각 팀별 플레이오프 진출 조건
  - 다른 팀 경기 결과 의존도
  - 최악의 경우/최선의 경우 시나리오

#### 📊 팀별 순위표 (매직넘버 버전)
- **매직넘버 중심 순위표**
  - 일반 순위 + 매직넘버 정보 통합
  - 우승/플레이오프 확률 컬럼 추가
  - 탈락 위험도 색상 코딩

### 2.3 매직넘버 히스토리
**기능 ID**: `MAGIC-003`

#### 일별 매직넘버 변화
- **매직넘버 감소 추적**
  - 매일 경기 후 매직넘버 변화량
  - 상대팀 경기 결과가 매직넘버에 미친 영향
  
- **확률 변화 추이**
  - 시간에 따른 우승 확률 변화 그래프
  - 주요 전환점 분석 (연승/연패 구간)

---

## 3. 상대전적 매트릭스

### 3.1 기본 상대전적 매트릭스
**기능 ID**: `H2H-001`

#### 12x12 상대전적 테이블
- **매트릭스 구조**
  ```
        YOG HAN YDB HIR CHU YAK SOF LOT RAK ORI SEI NIP
    YOG  -   4-2 3-3 5-1 2-4 6-0 2-1 1-2 0-3 3-0 1-2 2-1
    HAN 2-4  -   1-5 2-4 3-3 4-2 1-2 2-1 1-2 2-1 0-3 1-2
    ...
  ```

- **표시 정보**
  - 승-패 기록 (무승부 포함시 승-패-무)
  - 승률 (색상 코딩)
  - 최근 대결 결과 (최근 3경기)

#### 시각적 특징
- **승률 기반 색상 코딩**
  - 높은 승률: 진한 녹색 (#2e7d32)
  - 중간 승률: 연한 녹색 (#8bc34a)  
  - 낮은 승률: 연한 빨강 (#ef5350)
  - 매우 낮은 승률: 진한 빨강 (#c62828)

### 3.2 상세 상대전적 분석
**기능 ID**: `H2H-002`

#### 팀별 상대전적 상세
- **홈/원정 구분 기록**
  - 홈에서의 상대전적
  - 원정에서의 상대전적
  - 구장별 성적 차이 분석

- **시즌 내 대결 일정**
  - 완료된 대결과 결과
  - 남은 대결 일정
  - 각 대결의 순위 영향도

#### 리그간 교류전 분석
- **인터리그 성적**
  - 센트럴 vs 퍼시픽 전체 승률
  - 팀별 인터리그 특화도
  - 리그 강도 비교 지표

### 3.3 상대전적 트렌드
**기능 ID**: `H2H-003`

#### 최근 대결 트렌드
- **연도별 상대전적 변화**
  - 지난 3년간 상대전적 추이
  - 상성 변화 패턴 분석

- **시즌 내 대결 패턴**
  - 시즌 초반/중반/후반 상대전적 차이
  - 중요한 시기 대결 성과

---

## 4. 분석 대시보드

### 4.1 팀별 성적 분석
**기능 ID**: `ANALYTICS-001`

#### 승률 추이 차트
- **시간별 승률 변화**
  - 월별/주별 승률 라인 차트
  - 각 팀별 색상 구분
  - 시즌 목표 승률 기준선

- **홈/원정 성적 비교**
  - 홈 승률 vs 원정 승률 산점도
  - 홈 어드밴티지 순위
  - 구장 특성 분석

#### 득실점 분석
- **득점/실점/득실차 트렌드**
  - 월별 득점/실점 변화
  - 득실차와 승률 상관관계
  - 피타고라스 승률 vs 실제 승률

### 4.2 고급 통계 분석
**기능 ID**: `ANALYTICS-002`

#### 세이버메트릭스 지표
- **팀 OPS / 팀 ERA**
- **WHIP (Walks + Hits per Innings Pitched)**
- **피타고라스 승률**
- **런 디퍼렌셜 효율성**

#### 상황별 성적 분석
- **클러치 상황 성적**
  - 9회 역전 상황 승률
  - 1점차 경기 성적
  - 연장전 성적

### 4.3 예측 모델
**기능 ID**: `ANALYTICS-003`

#### 시즌 최종 예측
- **잔여 경기 시뮬레이션**
  - 몬테카를로 시뮬레이션 (10,000회)
  - 최종 순위 확률 분포
  - 승수 예측 구간

---

## 5. API 서비스

### 5.1 RESTful API
**기능 ID**: `API-001`

#### 주요 엔드포인트
```
GET /api/v1/standings                    # 전체 순위
GET /api/v1/standings/:league           # 리그별 순위  
GET /api/v1/standings/team/:teamId      # 팀별 순위

GET /api/v1/magic-numbers               # 전체 매직넘버
GET /api/v1/magic-numbers/:league       # 리그별 매직넘버
GET /api/v1/magic-numbers/team/:teamId  # 팀별 매직넘버

GET /api/v1/head-to-head               # 상대전적 매트릭스
GET /api/v1/head-to-head/:teamId       # 팀별 상대전적
GET /api/v1/head-to-head/:teamA/:teamB # 직접 대결

GET /api/v1/games                      # 경기 목록
GET /api/v1/games/today               # 오늘 경기
GET /api/v1/games/:gameId             # 경기 상세
GET /api/v1/games/schedule/:date      # 날짜별 일정

GET /api/v1/teams                      # 팀 목록
GET /api/v1/teams/:league             # 리그별 팀
GET /api/v1/teams/team/:teamId        # 팀 상세정보
```

#### API 기능
- **자동 캐싱**: Redis 기반 5-15분 캐시
- **Rate Limiting**: IP당 시간당 1000회 제한
- **Error Handling**: 표준 HTTP 에러 코드
- **CORS 지원**: 크로스 도메인 요청 허용

### 5.2 실시간 업데이트
**기능 ID**: `API-002`

#### WebSocket 연결 (향후 구현)
- **실시간 점수 업데이트**
- **순위 변동 실시간 알림**
- **매직넘버 변화 푸시**

### 5.3 API 문서화
**기능 ID**: `API-003`

#### Swagger/OpenAPI 문서
- **인터랙티브 API 문서**
- **예제 요청/응답**
- **에러 코드 설명**
- **인증 가이드**

---

## 6. 사용자 인터페이스

### 6.1 반응형 디자인
**기능 ID**: `UI-001`

#### 다바이스 대응
- **데스크톱** (1920px+): 전체 기능 표시
- **태블릿** (768-1919px): 메뉴 축약, 테이블 스크롤
- **모바일** (767px-): 햄버거 메뉴, 카드 형태 표시

#### Bootstrap 5 기반
- **그리드 시스템**: 12컬럼 레이아웃
- **컴포넌트**: 카드, 테이블, 모달, 네비게이션
- **유틸리티 클래스**: 마진, 패딩, 색상

### 6.2 사용자 경험
**기능 ID**: `UI-002`

#### 인터랙티브 요소
- **테이블 행 호버**: 팀 정보 하이라이트
- **팀 클릭**: 상세 정보 모달 표시
- **차트 툴팁**: 데이터 포인트별 상세 정보
- **로딩 인디케이터**: 스피너와 스켈레톤 UI

#### 접근성 (A11Y)
- **키보드 네비게이션**: Tab 순서 최적화
- **스크린 리더**: ARIA 라벨 적용
- **색상 대비**: WCAG 2.1 AA 레벨 준수
- **폰트 크기**: 최소 16px 기준

### 6.3 다국어 지원
**기능 ID**: `UI-003`

#### 언어 옵션
- **한국어** (기본): 모든 텍스트 한글
- **일본어**: 팀명, 구장명 일본어 표시
- **영어**: 국제 사용자 대응

---

## 7. 데이터 관리 시스템

### 7.1 데이터 수집
**기능 ID**: `DATA-001`

#### 크롤링 시스템
- **NPB 공식 사이트**: https://npb.jp
- **Yahoo Sports JP**: https://baseball.yahoo.co.jp  
- **Sports Navi**: https://sports.yahoo.co.jp

#### 수집 주기
- **실시간 데이터**: 경기 진행 중 5분마다
- **순위 데이터**: 경기 종료 후 30분 이내
- **통계 데이터**: 일 1회 (새벽 3시)

### 7.2 데이터 검증
**기능 ID**: `DATA-002`

#### 데이터 품질 관리
- **중복 제거**: Primary Key 기반 중복 검증
- **논리적 검증**: 승+패+무 = 경기수 검증
- **범위 검증**: 승률 0-1 범위, 날짜 유효성
- **참조 무결성**: 외래 키 제약조건 준수

#### 오류 처리
- **데이터 불일치**: 자동 재수집 후 수동 검토
- **소스 접근 불가**: 대체 소스 활용
- **형식 오류**: 로그 기록 후 관리자 알림

### 7.3 데이터 백업
**기능 ID**: `DATA-003`

#### 백업 전략
- **실시간 복제**: PostgreSQL Streaming Replication
- **일일 백업**: 전체 데이터베이스 덤프
- **주간 백업**: 클라우드 스토리지 보관
- **연간 아카이브**: 시즌 완료 데이터 장기 보관

---

## 8. 성능 및 확장성

### 8.1 성능 최적화
**기능 ID**: `PERF-001`

#### 캐싱 전략
- **Redis 캐시**: API 응답 5-15분 캐시
- **브라우저 캐시**: 정적 리소스 1시간 캐시
- **CDN**: 이미지, CSS, JS 파일 CDN 배포

#### 데이터베이스 최적화
- **인덱스 최적화**: 자주 조회되는 컬럼에 인덱스
- **쿼리 최적화**: EXPLAIN ANALYZE 기반 튜닝
- **파티셔닝**: 시즌별 데이터 파티션

### 8.2 모니터링
**기능 ID**: `PERF-002`

#### 성능 메트릭
- **응답 시간**: API 평균 응답시간 < 500ms
- **처리량**: 초당 요청 처리 수 > 100 RPS  
- **가용성**: 월간 가동시간 > 99.5%
- **에러율**: 4xx/5xx 에러율 < 1%

#### 알림 시스템
- **임계값 초과**: Slack/이메일 자동 알림
- **서비스 장애**: SMS 긴급 알림
- **성능 저하**: 대시보드 시각화

---

## 9. 보안 및 컴플라이언스

### 9.1 보안 조치
**기능 ID**: `SEC-001`

#### 웹 보안
- **HTTPS 강제**: SSL/TLS 1.2+ 사용
- **헤더 보안**: Helmet.js 기반 보안 헤더
- **CSRF 보호**: CSRF 토큰 검증
- **SQL 인젝션 방지**: 매개변수화된 쿼리

#### API 보안
- **Rate Limiting**: IP/사용자별 요청 제한
- **Input Validation**: Joi 기반 입력값 검증
- **Error Handling**: 민감 정보 노출 방지

### 9.2 데이터 보호
**기능 ID**: `SEC-002`

#### 개인정보 보호
- **익명화**: 개인 식별 정보 수집/저장 없음
- **로그 관리**: IP 주소 마스킹 처리
- **데이터 최소화**: 필요 최소한의 데이터만 수집

---

이 상세한 기능 명세서를 바탕으로 개발 우선순위를 정하고 단계적으로 구현할 수 있습니다. 각 기능은 독립적으로 개발 가능하도록 모듈화되어 있습니다.