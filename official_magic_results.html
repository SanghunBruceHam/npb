<!DOCTYPE html>
<html>
<head>
    <title>NPB ê³µì‹ ë§¤ì§ë„˜ë²„ (í˜„ì‹¤ ë°ì´í„°)</title>
    <meta charset="utf-8">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { border-collapse: collapse; width: 100%; margin: 15px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background-color: #f5f5f5; font-weight: bold; }
        .rank1 { background-color: #ffe6e6; font-weight: bold; }
        .magic { color: #d63384; font-weight: bold; font-size: 16px; }
        .clinched { color: #198754; font-weight: bold; }
        h2 { color: #333; border-bottom: 2px solid #ddd; padding-bottom: 5px; }
    </style>
</head>
<body>
    <h1>ğŸ“Š NPB ê³µì‹ ë§¤ì§ë„˜ë²„ (2025-09-06 í˜„ì‹¤ ë°ì´í„°)</h1>
    
    <div id="central-league">
        <h2>ğŸ”µ ì„¼íŠ¸ëŸ´ ë¦¬ê·¸</h2>
        <table id="central-table">
            <thead>
                <tr>
                    <th>ìˆœìœ„</th>
                    <th>íŒ€</th>
                    <th>ê²½ê¸°</th>
                    <th>ìŠ¹</th>
                    <th>íŒ¨</th>
                    <th>ë¬´</th>
                    <th>ìŠ¹ë¥ </th>
                    <th>ì”ì—¬</th>
                    <th>ë§¤ì§ë„˜ë²„</th>
                    <th>ì—˜ë¦¬ë¯¸ë„¤ì´ì…˜</th>
                    <th>ìƒíƒœ</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    
    <div id="pacific-league">
        <h2>ğŸŸ  í¼ì‹œí”½ ë¦¬ê·¸</h2>
        <table id="pacific-table">
            <thead>
                <tr>
                    <th>ìˆœìœ„</th>
                    <th>íŒ€</th>
                    <th>ê²½ê¸°</th>
                    <th>ìŠ¹</th>
                    <th>íŒ¨</th>
                    <th>ë¬´</th>
                    <th>ìŠ¹ë¥ </th>
                    <th>ì”ì—¬</th>
                    <th>ë§¤ì§ë„˜ë²„</th>
                    <th>ì—˜ë¦¬ë¯¸ë„¤ì´ì…˜</th>
                    <th>ìƒíƒœ</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <script>
        // ===== ì œê³µë°›ì€ ê³µì‹ ë§¤ì§ë„˜ë²„ ê³„ì‚° ë¡œì§ =====
        function calcR(team, season=143) {
            return season - (team.W + team.L + team.T);
        }
        function winPct(team, R) {
            const denom = team.W + team.L;
            return denom > 0 ? team.W / denom : 0;
        }
        function clamp(v, lo, hi) { return Math.max(lo, Math.min(hi, v)); }
        function round3(x){ return Number(x.toFixed(3)); }

        function sortStandings(teams, season=143) {
            return [...teams].map(t => {
                const R = calcR(t, season);
                return { ...t, R, winPct: winPct(t, R) };
            }).sort((a,b)=> b.winPct - a.winPct);
        }

        function officialLeaderMagicTragic(teams, season=143) {
            const table = sortStandings(teams, season);
            const leader = table[0];
            const runner = table[1];

            const R1 = leader.R;
            const D1 = leader.W + leader.L + R1;
            const R2 = runner.R;
            const D2 = runner.W + runner.L + R2;

            // 1ìœ„ í™•ì •(ë§¤ì§): ë™ë¥  í—ˆìš© ê¸°ì¤€
            const K1_official = (runner.W + R2) / D2;
            const needWins_rhs = K1_official * D1 - leader.W;
            const x_tieOK = Math.max(0, Math.ceil(needWins_rhs));
            const x_tieOK_c = clamp(x_tieOK, 0, R1);

            // 1ìœ„ íƒˆë½(íŠ¸ë˜ì§): ë™ë¥  í—ˆìš© ê¸°ì¤€
            const K1min_official = (runner.W) / D2;        
            const lose_rhs = leader.W + R1 - K1min_official * D1;
            const y_tieOK = Math.max(0, Math.floor(lose_rhs) + 1);
            const y_tieOK_c = clamp(y_tieOK, 0, R1);

            return {
                leader: { id: leader.id, W: leader.W, L: leader.L, T: leader.T, R: leader.R, winPct: round3(leader.winPct) },
                runnerUp: { id: runner.id, W: runner.W, L: runner.L, T: runner.T, R: runner.R, winPct: round3(runner.winPct) },
                magic: x_tieOK_c,
                tragic: y_tieOK_c
            };
        }

        // ===== í˜„ì‹¤ ë°ì´í„° (2025-09-06) =====
        const centralLeague = [
            { id: "HAN", name: "é˜ªç¥ã‚¿ã‚¤ã‚¬ãƒ¼ã‚¹", W: 76, L: 45, T: 3, games_played: 124 },
            { id: "YOG", name: "èª­å£²ã‚¸ãƒ£ã‚¤ã‚¢ãƒ³ãƒ„", W: 59, L: 62, T: 3, games_played: 124 },
            { id: "YDB", name: "æ¨ªæµœDeNAãƒ™ã‚¤ã‚¹ã‚¿ãƒ¼ã‚º", W: 57, L: 61, T: 5, games_played: 123 },
            { id: "HIR", name: "åºƒå³¶æ±æ´‹ã‚«ãƒ¼ãƒ—", W: 56, L: 64, T: 4, games_played: 124 },
            { id: "CHU", name: "ä¸­æ—¥ãƒ‰ãƒ©ã‚´ãƒ³ã‚º", W: 50, L: 69, T: 5, games_played: 124 },
            { id: "YAK", name: "æ±äº¬ãƒ¤ã‚¯ãƒ«ãƒˆã‚¹ãƒ¯ãƒ­ãƒ¼ã‚º", W: 47, L: 73, T: 4, games_played: 124 }
        ];

        const pacificLeague = [
            { id: "SOF", name: "ç¦å²¡ã‚½ãƒ•ãƒˆãƒãƒ³ã‚¯ãƒ›ãƒ¼ã‚¯ã‚¹", W: 68, L: 52, T: 4, games_played: 124 },
            { id: "LOT", name: "åƒè‘‰ãƒ­ãƒƒãƒ†ãƒãƒªãƒ¼ãƒ³ã‚º", W: 66, L: 54, T: 4, games_played: 124 },
            { id: "ORI", name: "ã‚ªãƒªãƒƒã‚¯ã‚¹ãƒ»ãƒãƒ•ã‚¡ãƒ­ãƒ¼ã‚º", W: 65, L: 55, T: 4, games_played: 124 },
            { id: "RAK", name: "æ±åŒ—æ¥½å¤©ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¤ãƒ¼ã‚°ãƒ«ã‚¹", W: 57, L: 63, T: 4, games_played: 124 },
            { id: "SEI", name: "åŸ¼ç‰è¥¿æ­¦ãƒ©ã‚¤ã‚ªãƒ³ã‚º", W: 54, L: 66, T: 4, games_played: 124 },
            { id: "NIP", name: "åŒ—æµ·é“æ—¥æœ¬ãƒãƒ ãƒ•ã‚¡ã‚¤ã‚¿ãƒ¼ã‚º", W: 50, L: 70, T: 4, games_played: 124 }
        ];

        // ===== í…Œì´ë¸” ìƒì„± í•¨ìˆ˜ =====
        function createTable(teams, tableId) {
            const tbody = document.querySelector(`#${tableId} tbody`);
            
            // ìŠ¹ë¥ ìˆœ ì •ë ¬
            const sortedTeams = teams.sort((a, b) => {
                const aWinPct = a.W / (a.W + a.L);
                const bWinPct = b.W / (b.W + b.L);
                return bWinPct - aWinPct;
            });

            // ê³µì‹ ë§¤ì§ë„˜ë²„ ê³„ì‚°
            const convertedTeams = sortedTeams.map(t => ({ id: t.id, W: t.W, L: t.L, T: t.T }));
            const magicResult = officialLeaderMagicTragic(convertedTeams, 143);

            let html = '';
            sortedTeams.forEach((team, idx) => {
                const rank = idx + 1;
                const remaining = 143 - team.games_played;
                const winPct = (team.W / (team.W + team.L)).toFixed(3);
                const rankClass = rank === 1 ? 'rank1' : '';
                
                let magic = '-';
                let eliminate = '-';
                let status = '-';
                
                if (rank === 1) {
                    if (magicResult.magic === 0) {
                        magic = 'âœ“';
                        status = 'ìš°ìŠ¹í™•ì •';
                    } else {
                        magic = magicResult.magic;
                        status = `${magic}ìŠ¹ í•„ìš”`;
                    }
                    
                    if (magicResult.tragic === 0) {
                        eliminate = 'E';
                    } else {
                        eliminate = magicResult.tragic;
                    }
                } else {
                    // 2ìœ„ ì´í•˜ íŒ€ë“¤ì˜ ìš°ìŠ¹ íƒˆë½ ê³„ì‚° (ê°„ë‹¨í•œ ê³„ì‚°)
                    const teamMaxWins = team.W + remaining;
                    const leaderWins = sortedTeams[0].W;
                    if (teamMaxWins < leaderWins) {
                        eliminate = 'E';
                        status = 'ìš°ìŠ¹íƒˆë½';
                    } else {
                        // MLB ìŠ¤íƒ€ì¼ ì—˜ë¦¬ë¯¸ë„¤ì´ì…˜ ë„˜ë²„
                        const combo = (143 + 1) - leaderWins - team.L;
                        eliminate = combo <= 0 ? 'E' : combo;
                        if (eliminate === 'E') {
                            status = 'ìš°ìŠ¹íƒˆë½';
                        }
                    }
                }

                html += `
                    <tr class="${rankClass}">
                        <td>${rank}</td>
                        <td style="text-align:left;">${team.name}</td>
                        <td>${team.games_played}</td>
                        <td>${team.W}</td>
                        <td>${team.L}</td>
                        <td>${team.T}</td>
                        <td>${winPct}</td>
                        <td>${remaining}</td>
                        <td class="${magic === 'âœ“' ? 'clinched' : 'magic'}">${magic}</td>
                        <td class="${eliminate === 'E' ? 'clinched' : ''}">${eliminate}</td>
                        <td style="font-size:12px;">${status}</td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }

        // ===== ì‹¤í–‰ =====
        createTable(centralLeague, 'central-table');
        createTable(pacificLeague, 'pacific-table');

        // ===== ìš”ì•½ ì •ë³´ =====
        document.body.innerHTML += `
            <div style="margin-top: 30px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                <h3>ğŸ“‹ ê³„ì‚° ê¸°ì¤€ (ê³µì‹ ëª¨ë“œ)</h3>
                <ul>
                    <li><strong>ì‹œì¦Œ ê²½ê¸°ìˆ˜:</strong> 143ê²½ê¸°</li>
                    <li><strong>ìŠ¹ë¥  ê³„ì‚°:</strong> ìŠ¹/(ìŠ¹+íŒ¨) - ë¬´ìŠ¹ë¶€ ì œì™¸</li>
                    <li><strong>ë§¤ì§ë„˜ë²„:</strong> (2ìœ„ ìµœëŒ€ìŠ¹ìˆ˜) - (1ìœ„ í˜„ì¬ìŠ¹ìˆ˜) + 1</li>
                    <li><strong>ë™ë¥  ì²˜ë¦¬:</strong> ë™ë¥  í—ˆìš© (â‰¥)</li>
                    <li><strong>ê³„ì‚° ë°©ì‹:</strong> í˜„ì¬ 1ìœ„ vs í˜„ì¬ 2ìœ„ë§Œ ë¹„êµ (ì¼ë³¸ ì–¸ë¡  ê³µì‹ ë°©ì‹)</li>
                </ul>
            </div>
        `;
    </script>
</body>
</html>