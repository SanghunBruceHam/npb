name: ğŸ KBO ë°ì´í„° ì¼ì¼ ìë™ ì—…ë°ì´íŠ¸

on:
  schedule:
    # ë§¤ì¼ í•œêµ­ì‹œê°„ ì˜¤í›„ 6ì‹œ (UTC 09:00)
    - cron: '0 9 * * *'
    # ë§¤ì¼ í•œêµ­ì‹œê°„ ì˜¤í›„ 10ì‹œ (UTC 13:00) 
    - cron: '0 13 * * *'
    # ë§¤ì¼ í•œêµ­ì‹œê°„ ìì • 12ì‹œ (UTC 15:00)
    - cron: '0 15 * * *'
  
  # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥
  workflow_dispatch:

jobs:
  update-kbo-data:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ ì €ì¥ì†Œ ì²´í¬ì•„ì›ƒ
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        
    - name: ğŸŸ¢ Node.js ì„¤ì •
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: ğŸ“¦ ì˜ì¡´ì„± ì„¤ì¹˜
      run: |
        npm ci
        # Puppeteer ì˜ì¡´ì„± ì„¤ì¹˜
        npx puppeteer browsers install chrome
        
    - name: ğŸ¤– KBO ë°ì´í„° í¬ë¡¤ë§ ë° ì—…ë°ì´íŠ¸
      run: |
        echo "ğŸ KBO ë°ì´í„° ì—…ë°ì´íŠ¸ ì‹œì‘..."
        echo "ğŸ“… ì‹¤í–‰ ì‹œê°„: $(date)"
        
        # ì™„ì „ ìë™í™” ì‹œìŠ¤í…œ ì‹¤í–‰ (ìˆœìœ„ + ê²½ê¸°ê²°ê³¼ + ìƒëŒ€ì „ì  + ì›¹ì‚¬ì´íŠ¸ ì—…ë°ì´íŠ¸)
        node complete-kbo-automation.js
        
        echo "âœ… ë°ì´í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ"
        
    - name: ğŸ“Š ë³€ê²½ì‚¬í•­ í™•ì¸
      id: changes
      run: |
        if [[ -n $(git status --porcelain) ]]; then
          echo "ë³€ê²½ì‚¬í•­ì´ ìˆìŠµë‹ˆë‹¤."
          echo "has_changes=true" >> $GITHUB_OUTPUT
          git status
        else
          echo "ë³€ê²½ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤."
          echo "has_changes=false" >> $GITHUB_OUTPUT
        fi
        
    - name: ğŸš€ ë³€ê²½ì‚¬í•­ ì»¤ë°‹ ë° í‘¸ì‹œ
      if: steps.changes.outputs.has_changes == 'true'
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        
        git add .
        
        git commit -m "ğŸš€ KBO ì™„ì „ ìë™í™” ì—…ë°ì´íŠ¸ - $(date '+%Y-%m-%d %H:%M:%S')

        âœ… ì™„ì „ í†µí•© ìë™í™” ì‹œìŠ¤í…œ:
        - ğŸ“Š KBO ê³µì‹ íŒ€ ìˆœìœ„/í†µê³„ (ìµœê·¼10ê²½ê¸°, ì—°ì†ê¸°ë¡)
        - âš¾ ë„¤ì´ë²„ ìŠ¤í¬ì¸  ìµœì‹  ê²½ê¸° ê²°ê³¼ í¬ë¡¤ë§
        - ğŸ”„ ìƒëŒ€ì „ì  ì‹¤ì‹œê°„ ìë™ ì—…ë°ì´íŠ¸  
        - ğŸŒ ì›¹ì‚¬ì´íŠ¸ ë°ì´í„° ì™„ì „ ë™ê¸°í™”
        - ğŸ¯ ë§¤ì§ë„˜ë²„ ì‹¤ì‹œê°„ ì¬ê³„ì‚°

        ğŸ¤– Generated with GitHub Actions (Complete Automation)
        ğŸ”— Workflow: ${{ github.workflow }}
        ğŸ“… Run: ${{ github.run_number }}"
        
        git push
        
    - name: ğŸ“¢ ê²°ê³¼ ìš”ì•½
      run: |
        echo "ğŸ‰ KBO ë°ì´í„° ì—…ë°ì´íŠ¸ ì‘ì—… ì™„ë£Œ!"
        echo "ğŸ“… ì‹¤í–‰ ì‹œê°„: $(date)"
        echo "ğŸ”— ì›Œí¬í”Œë¡œìš°: ${{ github.workflow }}"
        echo "ğŸ“Š ì‹¤í–‰ ë²ˆí˜¸: ${{ github.run_number }}"
        
        if [[ "${{ steps.changes.outputs.has_changes }}" == "true" ]]; then
          echo "âœ… ìƒˆë¡œìš´ ë°ì´í„°ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤."
        else
          echo "ğŸ“Œ ë³€ê²½ì‚¬í•­ì´ ì—†ì–´ ì—…ë°ì´íŠ¸í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."
        fi