name: ğŸ KBO ì™„ì „ ìë™í™” ì‹œìŠ¤í…œ

on:
  schedule:
    # ë§¤ì¼ í•œêµ­ì‹œê°„ ì˜¤í›„ 6ì‹œ (UTC 09:00) - ê²½ê¸° ì‹œì‘ ì‹œê°„
    - cron: '0 9 * * *'
    # ë§¤ì¼ í•œêµ­ì‹œê°„ ì˜¤í›„ 10ì‹œ (UTC 13:00) - ëŒ€ë¶€ë¶„ ê²½ê¸° ì¢…ë£Œ
    - cron: '0 13 * * *'
    # ë§¤ì¼ í•œêµ­ì‹œê°„ ìì • 12ì‹œ (UTC 15:00) - ëª¨ë“  ê²½ê¸° ì¢…ë£Œ í›„
    - cron: '0 15 * * *'
  
  # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥
  workflow_dispatch:

jobs:
  update-kbo-data:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ ì €ì¥ì†Œ ì²´í¬ì•„ì›ƒ
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        
    - name: ğŸŸ¢ Node.js ì„¤ì •
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: ğŸ“¦ ì˜ì¡´ì„± ì„¤ì¹˜
      run: |
        npm ci
        
    - name: ğŸ¤– KBO ë°ì´í„° ì²˜ë¦¬ ë° ì—…ë°ì´íŠ¸
      run: |
        echo "ğŸ KBO ì™„ì „ ìë™í™” ì‹œìŠ¤í…œ ì‹œì‘..."
        echo "ğŸ“… ì‹¤í–‰ ì‹œê°„: $(date)"
        
        # í˜„ì¬ ì‹œìŠ¤í…œ: clean.txt ê¸°ë°˜ ì™„ì „ ìë™í™” ì²˜ë¦¬
        npm run update-data
        
        echo "âœ… ë°ì´í„° ì²˜ë¦¬ ì™„ë£Œ"
        
    - name: ğŸ“Š ë³€ê²½ì‚¬í•­ í™•ì¸
      id: changes
      run: |
        if [[ -n $(git status --porcelain) ]]; then
          echo "ë³€ê²½ì‚¬í•­ì´ ìˆìŠµë‹ˆë‹¤."
          echo "has_changes=true" >> $GITHUB_OUTPUT
          git status
        else
          echo "ë³€ê²½ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤."
          echo "has_changes=false" >> $GITHUB_OUTPUT
        fi
        
    - name: ğŸš€ ë³€ê²½ì‚¬í•­ ì»¤ë°‹ ë° í‘¸ì‹œ
      if: steps.changes.outputs.has_changes == 'true'
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        
        git add .
        
        git commit -m "ğŸš€ KBO ì™„ì „ ìë™í™” ì—…ë°ì´íŠ¸ - $(TZ='Asia/Seoul' date '+%Y-%m-%d %H:%M:%S')

        âœ… 2025-season-data-clean.txt ê¸°ë°˜ ì™„ì „ ìë™í™”:
        - ğŸ“Š íŒ€ë³„ ìˆœìœ„ ë° í†µê³„ (ìŠ¹ë¥ , í™ˆ/ì›ì • ê¸°ë¡)
        - ğŸ”® ë§¤ì§ë„˜ë²„ 4ì¢… (í”Œë ˆì´ì˜¤í”„/ìš°ìŠ¹/íƒˆë½/í™ˆì–´ë“œë°´í‹°ì§€)
        - âš”ï¸ ìƒëŒ€ì „ì  10x10 ë§¤íŠ¸ë¦­ìŠ¤  
        - ğŸŒ ì›¹ì„œë¹„ìŠ¤ JSON ë°ì´í„° ë™ê¸°í™”
        - ğŸ“… ì”ì—¬ê²½ê¸° ìë™ ê³„ì‚°

        ğŸ¤– Generated with Claude Code
        Co-Authored-By: Claude <noreply@anthropic.com>"
        
        git push
        
    - name: ğŸ“¢ ê²°ê³¼ ìš”ì•½
      run: |
        echo "ğŸ‰ KBO ë°ì´í„° ì—…ë°ì´íŠ¸ ì‘ì—… ì™„ë£Œ!"
        echo "ğŸ“… ì‹¤í–‰ ì‹œê°„: $(date)"
        echo "ğŸ”— ì›Œí¬í”Œë¡œìš°: ${{ github.workflow }}"
        echo "ğŸ“Š ì‹¤í–‰ ë²ˆí˜¸: ${{ github.run_number }}"
        
        if [[ "${{ steps.changes.outputs.has_changes }}" == "true" ]]; then
          echo "âœ… ìƒˆë¡œìš´ ë°ì´í„°ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤."
        else
          echo "ğŸ“Œ ë³€ê²½ì‚¬í•­ì´ ì—†ì–´ ì—…ë°ì´íŠ¸í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."
        fi