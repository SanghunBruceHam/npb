name: Pages Deploy on Bot Push

on:
  push:
    branches: [ main ]
    # ë´‡ì— ì˜í•œ ì»¤ë°‹ì¼ ë•Œë§Œ ì‹¤í–‰
    # ì»¤ë°‹ ë©”ì‹œì§€ì— "ğŸ¤– KBO ë°ì´í„° ìë™ ì—…ë°ì´íŠ¸" ë˜ëŠ” "KBO Auto Crawler"ê°€ í¬í•¨ëœ ê²½ìš°

# ê¶Œí•œ ì„¤ì •
permissions:
  contents: read
  pages: write
  id-token: write

# ë™ì‹œ ì‹¤í–‰ ë°©ì§€
concurrency:
  group: pages-deploy-bot
  cancel-in-progress: true

jobs:
  deploy:
    # ë´‡ ì»¤ë°‹ì¸ì§€ í™•ì¸ í›„ ì‹¤í–‰
    if: contains(github.event.head_commit.message, 'ğŸ¤– KBO ë°ì´í„° ìë™ ì—…ë°ì´íŠ¸') || contains(github.event.head_commit.message, 'KBO Auto Crawler')
    runs-on: ubuntu-latest
    
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    
    steps:
    - name: ğŸ“ ì €ì¥ì†Œ ì²´í¬ì•„ì›ƒ
      uses: actions/checkout@v4

    - name: ğŸ“ ë°°í¬ ì „ìš© ë””ë ‰í† ë¦¬ ìƒì„±
      run: |
        echo "ğŸ“ ë°°í¬ ì „ìš© ë””ë ‰í† ë¦¬ ìƒì„± ì¤‘..."
        mkdir -p _site
        
        # í•„ìš”í•œ íŒŒì¼ë“¤ë§Œ ë³µì‚¬
        cp index.html _site/
        cp -r magic-number/ _site/
        cp -r images/ _site/ 2>/dev/null || true
        cp *.json _site/ 2>/dev/null || true
        cp manifest.json _site/ 2>/dev/null || true
        cp robots.txt _site/ 2>/dev/null || true
        cp sitemap.xml _site/ 2>/dev/null || true
        cp ads.txt _site/ 2>/dev/null || true
        cp CNAME _site/ 2>/dev/null || true
        
        # ë°°í¬ ë””ë ‰í† ë¦¬ í¬ê¸° í™•ì¸
        DEPLOY_SIZE=$(du -sh _site | cut -f1)
        echo "ğŸ“Š ë°°í¬ ë””ë ‰í† ë¦¬ í¬ê¸°: ${DEPLOY_SIZE}"
        
        echo "âœ… ë°°í¬ ì „ìš© ë””ë ‰í† ë¦¬ ìƒì„± ì™„ë£Œ"

    - name: ğŸ“¦ Pages ì•„í‹°íŒ©íŠ¸ ì—…ë¡œë“œ
      uses: actions/upload-pages-artifact@v3
      with:
        path: '_site'
        
    - name: ğŸŒ GitHub Pages ë°°í¬
      id: deployment
      uses: actions/deploy-pages@v4
      timeout-minutes: 10
        
    - name: âœ… ë°°í¬ ì™„ë£Œ í™•ì¸
      run: |
        echo "ğŸš€ GitHub Pages ë°°í¬ ì™„ë£Œ!"
        echo "ğŸŒ ë°°í¬ URL: ${{ steps.deployment.outputs.page_url }}"
        echo "ğŸ“Š ë´‡ í‘¸ì‹œì— ì˜í•œ ìë™ ë°°í¬ ì„±ê³µ"