# KBO ë§¤ì§ë„˜ë²„ ì›¹ì„œë¹„ìŠ¤ GitHub Pages ë°°í¬
name: Deploy KBO Magic Number to Pages

on:
  # main ë¸Œëœì¹˜ì— í‘¸ì‹œë  ë•Œ íŠ¸ë¦¬ê±° (KBO ë°ì´í„° ì—…ë°ì´íŠ¸ í›„)
  push:
    branches: ["main"]
    paths:
      - 'magic-number/**'  # magic-number í´ë” ë³€ê²½ì‹œì—ë§Œ ë°°í¬
      - '.github/workflows/static.yml'  # ì›Œí¬í”Œë¡œìš° ìì²´ ë³€ê²½ì‹œ

  # Actions íƒ­ì—ì„œ ìˆ˜ë™ ì‹¤í–‰ í—ˆìš©
  workflow_dispatch:

# GitHub Pagesì— ë°°í¬í•  ê¶Œí•œ ì„¤ì •
permissions:
  contents: read
  pages: write
  id-token: write

# ë™ì‹œì— í•˜ë‚˜ì˜ ë°°í¬ë§Œ í—ˆìš©í•˜ë˜, ì§„í–‰ ì¤‘ì¸ ì‹¤í–‰ì€ ì·¨ì†Œí•˜ì§€ ì•ŠìŒ
concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“ ì €ì¥ì†Œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4

      - name: âš™ï¸ GitHub Pages ì„¤ì •
        uses: actions/configure-pages@v4

      - name: ğŸ“Š ë°°í¬ íŒŒì¼ ì¤€ë¹„
        run: |
          echo "ğŸš€ KBO ë§¤ì§ë„˜ë²„ ì›¹ì„œë¹„ìŠ¤ ë°°í¬ ì¤€ë¹„..."
          
          # magic-number í´ë” ì¡´ì¬ í™•ì¸
          if [ ! -d "magic-number" ]; then
            echo "âŒ magic-number í´ë”ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
            exit 1
          fi
          
          # ì£¼ìš” íŒŒì¼ë“¤ ì¡´ì¬ í™•ì¸
          echo "ğŸ“ ë°°í¬í•  íŒŒì¼ë“¤ í™•ì¸:"
          echo "  - index.html: $([ -f magic-number/index.html ] && echo 'âœ…' || echo 'âŒ')"
          echo "  - service-data.json: $([ -f magic-number/data/service-data.json ] && echo 'âœ…' || echo 'âŒ')"
          echo "  - kbo-rankings.json: $([ -f magic-number/data/kbo-rankings.json ] && echo 'âœ…' || echo 'âŒ')"
          
          # íˆìŠ¤í† ë¦¬ íŒŒì¼ ìˆ˜ í™•ì¸
          if [ -d magic-number/history/daily ]; then
            HISTORY_COUNT=$(ls -1 magic-number/history/daily/*.json 2>/dev/null | wc -l)
            echo "  - ì¼ì¼ íˆìŠ¤í† ë¦¬: ${HISTORY_COUNT}ê°œ íŒŒì¼"
          fi
          
          echo "âœ… ë°°í¬ ì¤€ë¹„ ì™„ë£Œ"

      - name: ğŸ“¦ ì•„í‹°íŒ©íŠ¸ ì—…ë¡œë“œ
        uses: actions/upload-pages-artifact@v3
        with:
          # magic-number í´ë”ë§Œ GitHub Pagesë¡œ ë°°í¬
          path: './magic-number'

      - name: ğŸš€ GitHub Pages ë°°í¬
        id: deployment
        uses: actions/deploy-pages@v4

      - name: ğŸ‰ ë°°í¬ ì™„ë£Œ ì•Œë¦¼
        run: |
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ğŸ¯ KBO ë§¤ì§ë„˜ë²„ ì›¹ì„œë¹„ìŠ¤ ë°°í¬ ì™„ë£Œ!"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ğŸŒ ë°°í¬ URL: ${{ steps.deployment.outputs.page_url }}"
          echo "ğŸ“… ë°°í¬ ì‹œê°„: $(TZ='Asia/Seoul' date '+%Y-%m-%d %H:%M')"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
