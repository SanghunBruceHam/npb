
name: KBO ë°ì´í„° ìë™ ì—…ë°ì´íŠ¸

on:
  schedule:
    # ë§¤ì¼ ì˜¤í›„ 6ì‹œ (KST) = UTC 09:00
    - cron: '0 9 * * *'
    # ë§¤ì¼ ì˜¤í›„ 10ì‹œ (KST) = UTC 13:00  
    - cron: '0 13 * * *'
    # ë§¤ì¼ ë°¤ 12ì‹œ (KST) = UTC 15:00
    - cron: '0 15 * * *'
  workflow_dispatch:  # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥

jobs:
  update-kbo-data:
    runs-on: ubuntu-latest
    
    steps:
    - name: ì½”ë“œ ì²´í¬ì•„ì›ƒ
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        
    - name: Node.js ì„¤ì •
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: ì˜ì¡´ì„± ì„¤ì¹˜
      run: |
        npm ci
        
    - name: KBO ë°ì´í„° ì „ì²´ ì—…ë°ì´íŠ¸
      run: |
        echo "ğŸš€ KBO ë°ì´í„° í¬ë¡¤ë§ ë° ì—…ë°ì´íŠ¸ ì‹œì‘..."
        npm run update-data
        echo "âœ… ë°ì´í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ"
      
    - name: ë³€ê²½ì‚¬í•­ í™•ì¸
      id: changes
      run: |
        git diff --quiet && echo "changed=false" >> $GITHUB_OUTPUT || echo "changed=true" >> $GITHUB_OUTPUT
        
    - name: ë³€ê²½ì‚¬í•­ ì»¤ë°‹ ë° í‘¸ì‹œ
      if: steps.changes.outputs.changed == 'true'
      run: |
        git config --local user.email "noreply@github.com"
        git config --local user.name "GitHub Actions"
        
        # í˜„ì¬ ë‚ ì§œ (KST)
        DATE=$(TZ='Asia/Seoul' date +'%Yë…„ %mì›” %dì¼ %Hì‹œ')
        
        git add .
        git commit -m "ğŸ“Š KBO ë°ì´í„° ìë™ ì—…ë°ì´íŠ¸ ($DATE)

        - ìˆœìœ„í‘œ ë° íŒ€ ê¸°ë¡ ì—…ë°ì´íŠ¸
        - ë§¤ì§ë„˜ë²„ ì¬ê³„ì‚° 
        - í”Œë ˆì´ì˜¤í”„ ì§„ì¶œ ì¡°ê±´ ì—…ë°ì´íŠ¸
        - HTML íŒŒì¼ ìë™ ì—…ë°ì´íŠ¸

        ğŸ¤– ìë™ ì—…ë°ì´íŠ¸"
        
        git push
        
    - name: ì—…ë°ì´íŠ¸ ê²°ê³¼ ìš”ì•½
      run: |
        if [ "${{ steps.changes.outputs.changed }}" == "true" ]; then
          echo "âœ… ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ì–´ í‘¸ì‹œë˜ì—ˆìŠµë‹ˆë‹¤."
          echo "ğŸ“Š ì—…ë°ì´íŠ¸ ì‹œê°„: $(date)"
        else
          echo "â„¹ï¸ ë³€ê²½ì‚¬í•­ì´ ì—†ì–´ í‘¸ì‹œí•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."
        fi
