name: Update KBO Data Daily

on:
  schedule:
    # ë§¤ì¼ KST 23:30 (UTC 14:30)ì— ì‹¤í–‰
    - cron: '30 14 * * *'
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥

jobs:
  update-data:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        
    - name: Install dependencies
      run: |
        npm install puppeteer cheerio axios
        
    - name: Crawl KBO data and update
      run: |
        echo "ğŸš€ KBO ë°ì´í„° í¬ë¡¤ë§ ë° ì—…ë°ì´íŠ¸ ì‹œì‘..."
        node scripts/simple-update.js
        echo "âœ… ë°ì´í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ"
      
    - name: Check for changes
      id: changes
      run: |
        git diff --quiet && echo "changed=false" >> $GITHUB_OUTPUT || echo "changed=true" >> $GITHUB_OUTPUT
        
    - name: Commit and push changes
      if: steps.changes.outputs.changed == 'true'
      run: |
        git config --local user.email "noreply@github.com"
        git config --local user.name "GitHub Actions"
        
        # í˜„ì¬ ë‚ ì§œ (KST)
        DATE=$(TZ='Asia/Seoul' date +'%Yë…„ %mì›” %dì¼')
        
        git add .
        git commit -m "ğŸ“Š KBO ë°ì´í„° ìë™ ì—…ë°ì´íŠ¸ ($DATE)

        - ìˆœìœ„í‘œ ë° íŒ€ ê¸°ë¡ ì—…ë°ì´íŠ¸
        - ë§¤ì§ë„˜ë²„ ì¬ê³„ì‚° 
        - í”Œë ˆì´ì˜¤í”„ ì§„ì¶œ ì¡°ê±´ ì—…ë°ì´íŠ¸

        ğŸ¤– Generated with [Claude Code](https://claude.ai/code)

        Co-Authored-By: Claude <noreply@anthropic.com>"
        
        git push
        
    - name: Summary
      run: |
        if [ "${{ steps.changes.outputs.changed }}" == "true" ]; then
          echo "âœ… ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ì–´ í‘¸ì‹œë˜ì—ˆìŠµë‹ˆë‹¤."
        else
          echo "â„¹ï¸ ë³€ê²½ì‚¬í•­ì´ ì—†ì–´ í‘¸ì‹œí•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."
        fi