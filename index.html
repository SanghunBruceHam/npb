<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NPB 대시보드 v3</title>
    <!-- Design System CSS -->
    <link rel="stylesheet" href="css/tokens.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/npb-specific.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🏟️ NPB 대시보드</h1>
            <p>일본 프로야구 2025시즌 순위 및 통계 분석</p>
            <div class="controls">
                <span style="margin-left: auto; color: #6b7280; font-size: 14px;">
                    마지막 업데이트: <span id="last-update">로딩 중...</span>
                </span>
            </div>
        </div>
        
        <!-- 매직넘버 현황 카드 -->
        <div class="magic-status-card" id="magic-status-card" style="display: none;">
            <div class="magic-status-title">
                <span>📊</span>
                <span>매직넘버 현황</span>
            </div>
            <div class="magic-status-grid">
                <div class="magic-status-item">
                    <div class="magic-status-label">우승/진출 확정</div>
                    <div class="magic-status-value">
                        <span id="clinched-count">0</span>
                        <span class="magic-status-unit">팀</span>
                    </div>
                </div>
                <div class="magic-status-item">
                    <div class="magic-status-label">탈락 확정</div>
                    <div class="magic-status-value">
                        <span id="eliminated-count">0</span>
                        <span class="magic-status-unit">팀</span>
                    </div>
                </div>
                <div class="magic-status-item">
                    <div class="magic-status-label">경쟁 중</div>
                    <div class="magic-status-value">
                        <span id="competing-count">0</span>
                        <span class="magic-status-unit">팀</span>
                    </div>
                </div>
                <div class="magic-status-item">
                    <div class="magic-status-label">평균 매직넘버</div>
                    <div class="magic-status-value">
                        <span id="avg-magic-number">0</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="initialization-error">
            <!-- 초기화 오류 메시지 -->
        </div>
        
        <div class="tab-nav">
            <button class="tab-button active" data-tab="standings">순위</button>
            <button class="tab-button" data-tab="magic-number">매직넘버</button>
            <button class="tab-button" data-tab="home-away">홈/원정</button>
            <button class="tab-button" data-tab="head-to-head">상대전적</button>
            <button class="tab-button" data-tab="season-progress">시즌 진행</button>
            <button class="tab-button" data-tab="trends-analysis">추이 분석</button>
            <button class="tab-button" data-tab="interleague">교류전</button>
            <button class="tab-button" data-tab="team-schedule">팀별 일정</button>
        </div>
        
        <div id="standings-tab" class="tab-content active">
            <div id="standings-container">
                <div class="loading-indicator">순위 데이터 로딩 중...</div>
            </div>
        </div>
        
        <div id="magic-number-tab" class="tab-content">
            <div id="magic-number-container">
                <div class="loading-indicator">매직넘버 계산 중...</div>
            </div>
        </div>
        
        <div id="season-progress-tab" class="tab-content">
            <div id="season-progress-container">
                <div class="loading-indicator">시즌 진행률 계산 중...</div>
            </div>
        </div>

        <div id="trends-analysis-tab" class="tab-content">
            <div id="trends-analysis-container">
                <div class="loading-indicator">추이 분석 데이터 로딩 중...</div>
            </div>
        </div>


        <div id="home-away-tab" class="tab-content">
            <div id="home-away-container">
                <div class="loading-indicator">홈/원정 분석 데이터 로딩 중...</div>
            </div>
        </div>

        <div id="head-to-head-tab" class="tab-content">
            <div id="head-to-head-container">
                <div class="loading-indicator">상대전적 데이터 로딩 중...</div>
            </div>
        </div>


        <div id="team-schedule-tab" class="tab-content">
            <div id="team-schedule-container">
                <div class="loading-indicator">팀별 일정 로딩 중...</div>
            </div>
        </div>


        <div id="interleague-tab" class="tab-content">
            <div id="interleague-container">
                <div class="loading-indicator">교류전 데이터 로딩 중...</div>
            </div>
        </div>

    </div>
    
    <div id="debug-panel">
        <div id="debug-info">
            <!-- 디버그 정보 -->
        </div>
    </div>

    <!-- 외부 라이브러리 먼저 로드 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    
    <!-- NPB JavaScript 모듈들 순차적으로 로드 -->
    <!-- 핵심 유틸리티 모듈들 먼저 로드 -->
    <script src="js/core/utils.js?v=2"></script>
    <script src="js/core/data-manager.js?v=2"></script>
    <script src="js/core/api-client.js?v=2"></script>
    <script src="js/core/table-sort.js?v=1"></script>
    <script src="js/core/unified-table.js?v=1"></script>
    
    <!-- 테이블 모듈들 로드 -->
    <script src="js/tables/standings.js?v=2"></script>
    <script src="js/tables/home-away.js?v=3"></script>
    <script src="js/tables/magic-number.js?v=2"></script>
    <script src="js/tables/head-to-head.js?v=2"></script>
    <script src="js/tables/interleague.js?v=2"></script>
    <script src="js/tables/extra-tabs.js?v=2"></script>
    
    <!-- 메인 애플리케이션 마지막에 로드 -->
    <script src="js/app.js?v=2"></script>
    
    <!-- 탭 네비게이션 및 핵심 기능 스크립트 -->
    <script>
        // 탭 네비게이션 초기화
        document.addEventListener('DOMContentLoaded', () => {
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');
            
            // 탭 전환 함수
            const switchToTab = (targetTab, animate = true) => {
                // 현재 활성 탭 찾기
                const currentActive = document.querySelector('.tab-content.active');
                
                // 모든 탭 비활성화
                tabButtons.forEach(btn => btn.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));
                
                // 새 탭 활성화
                const targetButton = document.querySelector(`[data-tab="${targetTab}"]`);
                const targetContent = document.getElementById(`${targetTab}-tab`);
                
                if (targetButton && targetContent) {
                    targetButton.classList.add('active');
                    targetContent.classList.add('active');
                    
                    // 스크롤을 탭으로 이동 (모바일에서 유용)
                    if (window.innerWidth <= 768) {
                        targetButton.scrollIntoView({ 
                            behavior: 'smooth', 
                            block: 'nearest', 
                            inline: 'center' 
                        });
                    }
                }
            };
            
            // 탭 버튼 이벤트 리스너 등록
            tabButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetTab = button.dataset.tab;
                    switchToTab(targetTab);
                });
            });
            
            // 키보드 네비게이션 지원
            document.addEventListener('keydown', (e) => {
                const activeTab = document.querySelector('.tab-button.active');
                if (!activeTab) return;
                
                let newTab = null;
                if (e.key === 'ArrowRight') {
                    newTab = activeTab.nextElementSibling;
                } else if (e.key === 'ArrowLeft') {
                    newTab = activeTab.previousElementSibling;
                }
                
                if (newTab && newTab.classList.contains('tab-button')) {
                    e.preventDefault();
                    switchToTab(newTab.dataset.tab);
                }
            });
            
            // 마지막 업데이트 시간 업데이트
            const updateLastUpdateTime = () => {
                const lastUpdateElement = document.getElementById('last-update');
                if (lastUpdateElement) {
                    const now = new Date();
                    const options = {
                        year: 'numeric', 
                        month: '2-digit', 
                        day: '2-digit',
                        hour: '2-digit', 
                        minute: '2-digit',
                        timeZone: 'Asia/Tokyo'
                    };
                    lastUpdateElement.textContent = now.toLocaleString('ja-JP', options);
                }
            };
            
            // 서브 탭 네비게이션 초기화
            const initializeSubTabs = () => {
                const subTabButtons = document.querySelectorAll('.sub-tab-btn');
                const subContents = document.querySelectorAll('.sub-content');
                
                subTabButtons.forEach(button => {
                    button.addEventListener('click', (e) => {
                        e.preventDefault();
                        const targetSubTab = button.dataset.subtab;
                        const parentContainer = button.closest('.tab-content');
                        const parentContainerId = parentContainer.id.replace('-tab', '-container');
                        
                        // 해당 부모 탭 내의 서브 탭들만 처리
                        const siblingButtons = parentContainer.querySelectorAll('.sub-tab-btn');
                        const siblingContents = parentContainer.querySelectorAll('.sub-content');
                        
                        // 모든 서브 탭 비활성화
                        siblingButtons.forEach(btn => btn.classList.remove('active'));
                        siblingContents.forEach(content => content.classList.remove('active'));
                        
                        // 클릭된 서브 탭 활성화
                        button.classList.add('active');
                        const targetContent = parentContainer.querySelector(`#${targetSubTab}-content`);
                        if (targetContent) {
                            targetContent.classList.add('active');
                        }
                        
                        // 해당 테이블 인스턴스의 서브탭 전환
                        if (window.npbDashboard && window.npbDashboard.tables) {
                            const tableInstance = Object.values(window.npbDashboard.tables)
                                .find(table => table.container && table.container.id === parentContainerId);
                            
                            if (tableInstance && typeof tableInstance.switchSubTab === 'function') {
                                tableInstance.switchSubTab(targetSubTab);
                            } else if (tableInstance && tableInstance.currentSubTab !== undefined) {
                                tableInstance.currentSubTab = targetSubTab;
                                if (typeof tableInstance.renderCurrentSubTab === 'function') {
                                    tableInstance.renderCurrentSubTab();
                                }
                            }
                        }
                    });
                });
            };
            
            // 초기 업데이트 시간 설정
            updateLastUpdateTime();
            
            // 서브 탭 초기화
            initializeSubTabs();
            
            // 1분마다 업데이트 시간 갱신
            setInterval(updateLastUpdateTime, 60000);
        });
    </script>
</body>
</html>
