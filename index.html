<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="2025å¹´ã‚·ãƒ¼ã‚ºãƒ³æœ€æ–°ã®NPBé †ä½è¡¨ã€‚ã‚»ãƒ»ãƒ‘ä¸¡ãƒªãƒ¼ã‚°ã®å‹ç‡ãƒ»ã‚²ãƒ¼ãƒ å·®ãƒ»æ®‹ã‚Šè©¦åˆãƒ»å„ªå‹ãƒã‚¸ãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼ãƒ»CSé€²å‡ºçŠ¶æ³ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ã€‚">
    <meta name="keywords" content="NPB, NPB é †ä½è¡¨, ãƒ—ãƒ­é‡çƒ, ãƒã‚¸ãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼, å‹ç‡, ã‚²ãƒ¼ãƒ å·®, CSé€²å‡º, ãƒã‚¹ãƒˆã‚·ãƒ¼ã‚ºãƒ³, ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ">
    <meta name="author" content="NPB Statistics">
    <meta name="robots" content="index, follow">
    <meta name="language" content="ja">
    <link id="canonical-link" rel="canonical" href="https://npb-dashboard.com/">
    <link rel="alternate" hreflang="ja" data-hreflang="ja" href="https://npb-dashboard.com/">
    <link rel="alternate" hreflang="ko" data-hreflang="ko" href="https://npb-dashboard.com/?lang=ko">
    <link rel="alternate" hreflang="en" data-hreflang="en" href="https://npb-dashboard.com/?lang=en">
    <link rel="alternate" hreflang="x-default" data-hreflang="x-default" href="https://npb-dashboard.com/">
    <link rel="sitemap" type="application/xml" href="https://npb-dashboard.com/sitemap.xml">
    <meta name="theme-color" content="#333">
    <meta name="application-name" content="NPB Dashboard">
    <meta name="msapplication-TileColor" content="#333">
    <meta name="google-site-verification" content="placeholder-verification-code">
    <meta name="google-adsense-account" content="ca-pub-5508768187151867">
    
    <title>NPB é †ä½è¡¨ 2025ï½œãƒ—ãƒ­é‡çƒ å‹ç‡ãƒ»ã‚²ãƒ¼ãƒ å·®ãƒ»ãƒã‚¸ãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼ãƒ»CSé€²å‡ºçŠ¶æ³</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="favicon.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon.png">
    <link rel="apple-touch-icon" href="favicon.png">
    <link rel="shortcut icon" href="favicon.png">
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://npb-dashboard.com/">
    <meta property="og:title" content="NPBé †ä½è¡¨ 2025ï½œå‹ç‡ãƒ»ã‚²ãƒ¼ãƒ å·®ãƒ»ãƒã‚¸ãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼ãƒ»CSé€²å‡ºçŠ¶æ³">
    <meta property="og:description" content="2025å¹´ã‚·ãƒ¼ã‚ºãƒ³æœ€æ–°ã®NPBé †ä½è¡¨ã€‚ã‚»ãƒ»ãƒ‘ä¸¡ãƒªãƒ¼ã‚°ã®å‹ç‡ãƒ»ã‚²ãƒ¼ãƒ å·®ãƒ»æ®‹ã‚Šè©¦åˆãƒ»å„ªå‹ãƒã‚¸ãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼ãƒ»CSé€²å‡ºçŠ¶æ³ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ã€‚">
    <meta property="og:image" content="https://npb-dashboard.com/images/npb-og-image.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="NPB Statistics">
    <meta property="og:locale" content="ja_JP">
    <meta property="article:publisher" content="https://npb-dashboard.com">
    <meta property="article:section" content="Sports">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://npb-dashboard.com/">
    <meta name="twitter:title" content="NPB é †ä½è¡¨ 2025ï½œãƒã‚¸ãƒƒã‚¯ãƒ»CSé€²å‡ºçŠ¶æ³">
    <meta name="twitter:description" content="2025å¹´ã‚·ãƒ¼ã‚ºãƒ³æœ€æ–°ã®NPBé †ä½è¡¨ã€‚ã‚»ãƒ»ãƒ‘ä¸¡ãƒªãƒ¼ã‚°ã®å‹ç‡ãƒ»ã‚²ãƒ¼ãƒ å·®ãƒ»æ®‹ã‚Šè©¦åˆãƒ»å„ªå‹ãƒã‚¸ãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼ãƒ»CSé€²å‡ºçŠ¶æ³ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ã€‚">
    <meta name="twitter:image" content="https://npb-dashboard.com/images/npb-og-image.jpg">
    <meta name="twitter:site" content="@npb_dashboard">
    <meta name="twitter:creator" content="@npb_dashboard">
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-LFKN46L0P6"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);} 
      gtag('js', new Date());
      gtag('config', 'G-LFKN46L0P6');
    </script>
    
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5508768187151867" crossorigin="anonymous"></script>
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": ["WebApplication", "SportsOrganization"],
      "name": "NPB Statistics Dashboard",
      "description": "NPB(æ—¥æœ¬ãƒ—ãƒ­é‡çƒ)2025å¹´ã‚·ãƒ¼ã‚ºãƒ³ã®é †ä½è¡¨ã¨ãƒã‚¸ãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼æƒ…å ±ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§è¿½è·¡ã™ã‚‹ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰",
      "url": "https://npb-dashboard.com/",
      "applicationCategory": "Sports Statistics",
      "operatingSystem": "Any",
      "browserRequirements": "Modern web browser",
      "sport": "Baseball",
      "foundingDate": "2025",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "featureList": [
        "ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é †ä½è¡¨",
        "ãƒã‚¸ãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼è¨ˆç®—",
        "ãƒ—ãƒ¬ãƒ¼ã‚ªãƒ•é€²å‡ºçŠ¶æ³",
        "å‹ç‡ã‚·ãƒŠãƒªã‚ªåˆ†æ",
        "æ®‹ã‚Šè©¦åˆæ•°çµ±è¨ˆ"
      ],
      "keywords": "æ—¥æœ¬ãƒ—ãƒ­é‡çƒ,NPB,é †ä½è¡¨,ãƒã‚¸ãƒƒã‚¯,å„ªå‹,ãƒ—ãƒ¬ãƒ¼ã‚ªãƒ•,CS,é‡çƒçµ±è¨ˆ",
      "inLanguage": "ja",
      "audience": {
        "@type": "Audience",
        "audienceType": "Baseball fans",
        "geographicArea": {
          "@type": "Country",
          "name": "Japan"
        }
      },
      "about": {
        "@type": "SportsEvent",
        "name": "NPB 2025 Regular Season",
        "startDate": "2025-03-29",
        "endDate": "2025-10-31",
        "sport": "Baseball",
        "location": {
          "@type": "Country",
          "name": "Japan"
        },
        "organizer": {
          "@type": "SportsOrganization",
          "name": "Nippon Professional Baseball",
          "url": "https://npb.jp"
        },
        "subEvent": [
          {
            "@type": "SportsEvent",
            "name": "ã‚»ãƒ³ãƒˆãƒ©ãƒ«ãƒ»ãƒªãƒ¼ã‚°",
            "sport": "Baseball"
          },
          {
            "@type": "SportsEvent", 
            "name": "ãƒ‘ã‚·ãƒ•ã‚£ãƒƒã‚¯ãƒ»ãƒªãƒ¼ã‚°",
            "sport": "Baseball"
          }
        ]
      },
      "provider": {
        "@type": "Organization",
        "name": "NPB Statistics"
      },
      "dateModified": "2025-09-08",
      "isAccessibleForFree": true
    }
    </script>
    
    <style>
        :root {
            --header-height: 64px;
            --nav-height: 50px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: white;
            color: black;
            font-size: 14px;
            line-height: 1.4;
            min-width: 320px;
            margin: 0;
            padding: 0;
        }
        
        .header {
            background: #333;
            color: white;
            padding: 0 20px;
            height: var(--header-height);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 100%;
            gap: 20px;
        }

        .site-name {
            font-size: 16px;
            font-weight: bold;
            color: white;
            text-decoration: none;
        }
        
        .language-selector {
            display: flex;
            gap: 5px;
            align-items: center;
            flex-shrink: 0;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
            min-width: 0;
            flex: 1;
        }

        .header-left h1 {
            font-size: 18px;
            line-height: 1.2;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .lang-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 3px;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        
        .lang-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .lang-btn.active {
            background: #fff;
            color: #333;
            font-weight: bold;
        }
        
        h1 { 
            font-size: 18px; 
            margin: 0; 
            font-weight: bold;
        }
        
        .nav {
            background: #f5f5f5;
            border-bottom: 2px solid #ddd;
            width: 100%;
            position: fixed;
            top: var(--header-height);
            left: 0;
            right: 0;
            z-index: 999;
            height: var(--nav-height);
            display: flex;
            align-items: center;
        }

        .nav-tabs { 
            display: flex; 
            max-width: 1200px; 
            margin: 0 auto;
            justify-content: center;
            flex-wrap: wrap;
            width: 100%;
        }

        .nav-tab {
            cursor: pointer;
            font-size: 13px;
            background: transparent;
            border: none;
            font-family: inherit;
            flex: 1;
            min-width: 120px;
            text-align: center;
            white-space: nowrap;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            position: relative;
            color: #333;
            transition: color 0.2s ease;
        }

        .nav-tab::before {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            bottom: -2px;
            height: 4px;
            background: transparent;
            transition: background 0.2s ease;
        }

        .nav-tab:hover {
            color: #0066cc;
        }

        .nav-tab.active {
            color: #0066cc;
            font-weight: 700;
        }

        .nav-tab.active::before {
            background: #0066cc;
        }

        .nav-tab + .nav-tab {
            border-left: 1px solid #ddd;
        }

        .game-ticker {
            position: fixed;
            top: calc(var(--header-height) + var(--nav-height));
            left: 0;
            right: 0;
            background-color: #fff;
            border-bottom: 1px solid #ddd;
            height: 40px;
            z-index: 998;
            overflow: hidden;
            display: flex;
            align-items: center;
        }

        .game-ticker {
            height: 44px;
            background-color: #fff;
            border-bottom: 1px solid #ddd;
            position: fixed;
            top: calc(var(--header-height) + var(--nav-height));
            left: 0;
            right: 0;
            z-index: 998;
            display: flex;
            justify-content: center;
        }

        .ticker-content {
            display: flex;
            align-items: center;
            max-width: 1200px;
            width: 100%;
            padding: 0 10px;
        }

        .ticker-date-controls {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-shrink: 0;
            background-color: #f8f9fa;
            padding: 4px 12px;
            border-radius: 4px;
            border: 1px solid #ddd;
            margin-left: 15px;
            white-space: nowrap;
        }

        .ticker-date-nav {
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            user-select: none;
            color: #0066cc; /* Highlight navigation buttons */
        }

        .ticker-date {
            font-weight: bold;
            font-size: 13px;
            color: #333;
            white-space: nowrap;
            text-align: center;
            line-height: 1.2;
            cursor: pointer;
            user-select: none;
        }

        .ticker-games-container {
            flex: 1;
            overflow-x: auto;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            -ms-overflow-style: none;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ticker-games-container::-webkit-scrollbar {
            display: none;
        }

        .ticker-games {
            display: inline-flex;
            gap: 15px;
            align-items: center;
            white-space: nowrap;
        }
        .ticker-game {
            position: relative;
        }
        .ticker-game:not(:last-child)::after {
            content: '|';
            position: absolute;
            right: -8px;
            top: 50%;
            transform: translateY(-50%);
            color: #ccc;
            font-size: 12px;
        }

        .ticker-games.scrolling {
            animation: scroll-left 30s linear infinite;
        }

        @keyframes scroll-left {
            0% {
                transform: translateX(100%);
            }
            100% {
                transform: translateX(-100%);
            }
        }

        .ticker-games-container:hover .ticker-games.scrolling {
            animation-play-state: paused;
        }
            padding: 2px 10px 0 10px; /* Ensure games are not cut off */
            height: 100%;
            align-items: flex-start;
            justify-content: center;
            min-width: min-content;
        }

        .ticker-game {
            display: inline-flex;
            flex-direction: column;
            gap: 2px;
            flex-shrink: 0; /* Prevent games from shrinking */
            padding: 0 8px;
            border-right: 1px solid #e0e0e0;
            min-height: 36px;
        }
        .ticker-game:last-child {
            border-right: none;
        }

        .ticker-team {
            display: flex;
            align-items: center;
            gap: 2px;
        }

        .ticker-team-name {
            font-size: 12px;
            font-weight: 600;
        }

        .ticker-score {
            font-weight: bold;
            font-size: 13px;
            margin: 0 2px;
        }
        
        .ticker-status {
            font-size: 11px;
            color: #666;
            white-space: nowrap;
        }

        .ticker-team-logo {
            height: 18px;
            width: 18px;
            object-fit: contain;
            vertical-align: middle;
            margin: 0 1px;
        }
        .ticker-team.winner .ticker-team-name {
            font-weight: bold;
            color: #2e7d32;
        }
        .ticker-team.winner .ticker-score {
            color: #2e7d32;
            font-weight: bold;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            padding-top: 10px;
            width: 100%;
        }
        
        .tab-content {
            display: none;
            scroll-margin-top: calc(var(--header-height) + var(--nav-height) + 20px);
        }

        .tab-content.active {
            display: block;
            padding-top: 0px; /* Reset padding */
            margin-top: 20px; /* Add margin instead of padding */
        }
        
        h2 { 
            font-size: 16px; 
            margin: 15px 0 8px 0; 
            font-weight: bold; 
        }
        
        h3 {
            font-size: 14px;
            margin: 10px 0;
            font-weight: bold;
        }
        
        table { 
            border-collapse: collapse; 
            width: 100%; 
            margin: 10px 0;
            table-layout: fixed;
        }
        
        th, td { 
            border: 1px solid #ddd; 
            padding: 4px 6px; 
            text-align: left; 
            font-size: 13px; 
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            line-height: 1.2;
            height: 30px;
            vertical-align: middle;
        }

        /* ë§ˆë²•/í”Œë ˆì´ì˜¤í”„ í…Œì´ë¸” ì»¬ëŸ¼ í­ */
        .magic-table {
            table-layout: fixed;
            min-width: 940px;
        }

        .magic-table th:nth-child(1),
        .magic-table td:nth-child(1) { width: 32px; }
        .magic-table th:nth-child(2),
        .magic-table td:nth-child(2) {
            width: 172px;
            white-space: nowrap;
            overflow: visible;
            text-align: left;
        }
        .magic-table th:nth-child(3),
        .magic-table td:nth-child(3) { width: 44px; }
        .magic-table th:nth-child(4),
        .magic-table td:nth-child(4) { width: 42px; }
        .magic-table th:nth-child(5),
        .magic-table td:nth-child(5) { width: 42px; }
        .magic-table th:nth-child(6),
        .magic-table td:nth-child(6) { width: 42px; }
        .magic-table th:nth-child(7),
        .magic-table td:nth-child(7) { width: 54px; }
        .magic-table th:nth-child(8),
        .magic-table td:nth-child(8) { width: 54px; }
        .magic-table th:nth-child(9),
        .magic-table td:nth-child(9) { width: 58px; }
        .magic-table th:nth-child(10),
        .magic-table td:nth-child(10) { width: 58px; }
        .magic-table th:nth-child(11),
        .magic-table td:nth-child(11) { width: 68px; }
        .magic-table th:nth-child(12),
        .magic-table td:nth-child(12) { width: 56px; }
        .magic-table th:nth-child(13),
        .magic-table td:nth-child(13) { width: 110px; }
        .magic-table th:nth-child(14),
        .magic-table td:nth-child(14) { width: 120px; }

        /* ìƒì„¸ ìˆœìœ„ í…Œì´ë¸” ê³ ì • í­ */
        .detailed-table {
            table-layout: fixed;
            min-width: 1020px;
        }

        .detailed-table th:nth-child(1),
        .detailed-table td:nth-child(1) { width: 32px; }
        .detailed-table th:nth-child(2),
        .detailed-table td:nth-child(2) {
            width: 175px;
            white-space: nowrap;
            overflow: visible;
            text-overflow: initial;
        }
        .detailed-table th:nth-child(3),
        .detailed-table td:nth-child(3) { width: 46px; }
        .detailed-table th:nth-child(4),
        .detailed-table td:nth-child(4) { width: 40px; }
        .detailed-table th:nth-child(5),
        .detailed-table td:nth-child(5) { width: 40px; }
        .detailed-table th:nth-child(6),
        .detailed-table td:nth-child(6) { width: 40px; }
        .detailed-table th:nth-child(7),
        .detailed-table td:nth-child(7) { width: 60px; }
        .detailed-table th:nth-child(8),
        .detailed-table td:nth-child(8) { width: 58px; }
        .detailed-table th:nth-child(9),
        .detailed-table td:nth-child(9) { width: 58px; }
        .detailed-table th:nth-child(10),
        .detailed-table td:nth-child(10) { width: 60px; }
        .detailed-table th:nth-child(11),
        .detailed-table td:nth-child(11) { width: 64px; }
        .detailed-table th:nth-child(12),
        .detailed-table td:nth-child(12) { width: 64px; }
        .detailed-table th:nth-child(13),
        .detailed-table td:nth-child(13) { width: 58px; }
        .detailed-table th:nth-child(14),
        .detailed-table td:nth-child(14) { width: 64px; }
        .detailed-table th:nth-child(15),
        .detailed-table td:nth-child(15) { width: 58px; }
        .detailed-table th:nth-child(16),
        .detailed-table td:nth-child(16) { width: 52px; }
        .detailed-table th:nth-child(17),
        .detailed-table td:nth-child(17) { width: 52px; }

        th { 
            background: #f5f5f5; 
            font-weight: bold;
            padding: 5px 3px;
        }

        .detailed-table td {
            padding: 5px 3px;
        }
        
        tr:nth-child(even) { 
            background: #f9f9f9; 
        }
        
        .leagues { 
            display: grid; 
            /* Always stack leagues vertically (Central above Pacific) */
            grid-template-columns: 1fr; 
            gap: 30px; 
            margin: 20px 0; 
        }
        
        .center { 
            text-align: center; 
        }
        
        .right { 
            text-align: right; 
        }
        
        .rank1 { 
            background: #e8f1ff; 
        }
        
        .rank2 { 
            background: #f0f0f0; 
        }
        
        .rank3 { 
            background: #f3f8ff; 
        }
        
        .win { 
            color: #0066cc; 
        }
        
        .loss { 
            color: #cc0000; 
        }
        
        .pct { 
            font-weight: bold; 
        }
        
        .info { 
            font-size: 13px; 
            color: #333; 
            margin: 10px 0;
            text-align: center;
        }

        #meta-bar {
            display: none;
        }
        
        .loading { 
            text-align: center; 
            padding: 20px; 
            color: #444; 
        }
        
        .magic-number { 
            font-size: 15px; 
            font-weight: bold; 
            color: #0066cc; 
        }
        
        .eliminated { 
            color: #cc0000; 
        }
        
        .clinched { 
            color: #00aa00; 
        }

        .row-eliminated {
            background: #ececec !important;
        }

        .row-eliminated td {
            background: transparent;
        }

        .scroll-table { 
            overflow-x: auto; 
        }

        
        /* Progress Tab Styles */
        .league-progress {
            background: #fff;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #ddd;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .team-progress-item {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-bottom: 8px;
            padding: 12px;
            border-radius: 8px;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            transition: background-color 0.2s ease;
        }

        .team-progress-item:hover {
            background: #e9ecef;
        }

        .team-progress-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }

        .team-progress-name {
            font-weight: 600;
            font-size: 14px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 6px;
            flex: 1;
        }

        .team-progress-bar {
            width: 100%;
            height: 18px;
            background: #e0e0e0;
            border-radius: 9px;
            overflow: hidden;
            border: 1px solid #ccc;
        }

        .team-progress-fill {
            height: 100%;
            transition: width 0.8s ease;
            border-radius: 8px;
            background: linear-gradient(90deg, currentColor, currentColor);
        }

        .team-progress-text {
            font-size: 14px;
            font-weight: 700;
            color: #333;
            text-align: right;
            white-space: nowrap;
        }

        .team-progress-summary {
            display: flex;
            align-items: center;
            gap: 8px;
            width: 100%;
            font-size: 13px;
            color: #444;
            background: #f1f3f5;
            border-radius: 12px;
            padding: 6px 10px;
        }

        .team-progress-summary span {
            flex: 1;
            font-weight: 600;
        }

        .team-progress-summary .summary-completed {
            text-align: left;
            color: #2e7d32;
        }

        .team-progress-summary .summary-remaining {
            text-align: center;
            color: #ff6f00;
        }

        .team-progress-summary .summary-total {
            text-align: right;
            color: #333;
        }

        .streak-win {
            color: #2e7d32;
            font-weight: 700;
        }

        .streak-loss {
            color: #c62828;
            font-weight: 700;
        }

        .streak-draw {
            color: #555;
            font-weight: 600;
        }
        
        .stat-card {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 18px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
        }
        
        .stat-title {
            font-size: 13px;
            color: #666;
            margin-bottom: 8px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #2e7d32;
            line-height: 1.2;
        }
        .league-tag {
            display: inline-block;
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 10px;
            border: 1px solid #bbb;
            background: #f7f7f7;
        }
        .league-central { background: #e8f2ff; border-color: #b7d3ff; }
        .league-pacific { background: #e9fff0; border-color: #b9efcd; }

        /* Toggle */
        .schedule-toggle { margin-top: 8px; }
        .toggle-group {
            display: inline-flex;
            border: 1px solid #ddd;
            border-radius: 999px;
            overflow: hidden;
            background: #fafafa;
        }
        .toggle-btn {
            padding: 6px 12px;
            font-size: 13px;
            border: none;
            background: transparent;
            cursor: pointer;
        }
        .toggle-btn.active {
            background: white;
            color: #000;
            font-weight: bold;
        }
        
        @media (max-width: 768px) {
            .leagues {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .container {
                padding: 10px;
            }

            .nav-tabs {
                flex-direction: column;
            }

            .nav {
                top: 39px; /* Adjust for mobile header height */
            }

            /* Progress tab mobile layout */
            #progress .grid-3col {
                grid-template-columns: 1fr !important;
                gap: 10px !important;
            }

            #progress .ad-center {
                order: 2;
                margin: 10px 0 !important;
            }

            .nav-tab {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #ddd;
            }
            
            .games-grid {
                grid-template-columns: 1fr;
            }
            
            .game-row span:first-child,
            .game-row span:last-child {
                max-width: 40%;
                font-size: 12px;
            }
            
            table { 
                font-size: 12px; 
            }
            
            th, td { 
                padding: 4px 6px; 
            }
            
            .nav-tab { 
                padding: 8px 10px; 
                font-size: 12px; 
                white-space: nowrap;
            }
            
            .scroll-table {
                width: 100%;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .scroll-table table {
                min-width: 600px;
            }

            .games-grid { grid-template-columns: 1fr; }
        }

        /* Layout: sticky footer without JS (flex column) */
        html, body { height: 100%; }
        body { display: flex; flex-direction: column; min-height: 100vh; }
        main { flex: 1 0 auto; padding-top: calc(var(--header-height) + var(--nav-height) + 40px); }
        
        /* Simple site footer (flow layout; pushed to bottom by flex) */
        .site-footer {
            margin-top: auto;
            background: #ffffff; border-top: 1px solid #cfcfcf;
            box-shadow: 0 -2px 8px rgba(0,0,0,0.06);
        }
        .site-footer .footer-content {
            max-width: 1200px; margin: 0 auto; padding: 12px 20px;
            color: #222; font-size: 13px; line-height: 1.5;
            display: flex; justify-content: space-between; align-items: center; gap: 8px; flex-wrap: wrap;
        }
        .site-footer a { color: #0066cc; text-decoration: none; }
        .site-footer a:hover { text-decoration: underline; }
        .site-footer { padding-bottom: env(safe-area-inset-bottom); }
        .today-date { color: #444; }

        /* Team logo before name */
        .team-logo {
            height: 1.2em;
            width: auto;
            vertical-align: text-bottom;
            margin-right: 0.35em;
        }

        /* Remaining games matrix styles */
        .matrix-container {
            overflow-x: auto;
            margin: 20px auto;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            display: inline-block;
            max-width: 100%;
        }

        .remaining-matrix {
            display: grid;
            gap: 0;
            background: white;
            font-size: 13px;
            min-width: fit-content;
            margin: 0 auto;
        }

        .matrix-cell {
            background: white;
            padding: 6px;
            text-align: center;
            border: 1px solid #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .matrix-header-team {
            background: #f8f9fa;
            font-weight: bold;
            padding: 8px 10px;
            text-align: left;
            white-space: nowrap;
            justify-content: flex-start;
            position: sticky;
            left: 0;
            z-index: 1;
            border-right: 2px solid #ddd;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 180px;
        }

        .matrix-header-opponent {
            background: #f8f9fa;
            font-weight: bold;
            padding: 8px 6px;
            text-align: center;
            white-space: nowrap;
            border-bottom: 2px solid #ddd;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 13px;
            min-width: 100px;
        }
        
        .matrix-header-opponent .team-logo {
            height: 0.9em;
            width: auto;
            margin-right: 2px;
        }

        .matrix-data-cell {
            font-weight: normal;
            font-size: 14px;
            min-width: 100px;
        }

        .matrix-data-cell.zero {
            color: #ccc;
            background: #fafafa;
        }

        .matrix-data-cell.has-games {
            background: #e3f2fd;
            color: #1565c0;
            font-weight: bold;
        }

        .matrix-total-cell {
            background: #fff3e0;
            font-weight: bold;
            color: #e65100;
            border: 1px solid #ffcc80;
        }

        .matrix-corner {
            background: #37474f;
            color: white;
            font-size: 13px;
            font-weight: bold;
        }

        /* Responsive adjustments for matrix */
        @media (max-width: 768px) {
            .remaining-matrix {
                font-size: 12px;
            }
            
            .matrix-cell {
                padding: 6px;
            }
            
            .matrix-header-team {
                padding: 8px 6px;
            }
            
            .matrix-header-opponent {
                min-height: 100px;
                padding: 6px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="header-left">
                <a href="#" class="site-name" onclick="location.reload(); return false;">NPB Dashboard</a>
                <h1 data-i18n="main-title">NPB 2025ã‚·ãƒ¼ã‚ºãƒ³ é †ä½è¡¨ãƒ»ãƒã‚¸ãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼ãƒ»CSé€²å‡ºç¢ºç‡</h1>
            </div>
            <div class="language-selector">
                <button class="lang-btn active" onclick="changeLanguage('ja')" data-lang="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</button>
                <button class="lang-btn" onclick="changeLanguage('ko')" data-lang="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</button>
                <button class="lang-btn" onclick="changeLanguage('en')" data-lang="en">ğŸ‡ºğŸ‡¸ English</button>
            </div>
        </div>
    </div>
    
    <div class="nav">
        <div class="nav-tabs">
            <div class="nav-tab" onclick="showTab('magic-regular', this)" data-i18n="nav-magic-regular">æ­£è¦ã‚·ãƒ¼ã‚ºãƒ³å„ªå‹ãƒã‚¸ãƒƒã‚¯</div>
            <div class="nav-tab" onclick="showTab('magic-playoff', this)" data-i18n="nav-magic-playoff">ãƒã‚¹ãƒˆã‚·ãƒ¼ã‚ºãƒ³ãƒã‚¸ãƒƒã‚¯</div>
            <div class="nav-tab" onclick="showTab('progress', this)" data-i18n="nav-progress">é€²è¡ŒçŠ¶æ³</div>
            <div class="nav-tab" onclick="showTab('scenarios', this)" data-i18n="nav-scenarios">çµŒè·¯ã®æ•°</div>
            <div class="nav-tab" onclick="showTab('standings', this)" data-i18n="nav-standings">ãƒãƒ¼ãƒ é †ä½</div>
            <div class="nav-tab" onclick="showTab('remaining', this)" data-i18n="nav-remaining">æ®‹ã‚Šè©¦åˆæ•°</div>
        </div>
    </div>
    <div id="game-ticker" class="game-ticker">
        <div class="ticker-content">
            <div class="ticker-games-container">
                <div id="ticker-games" class="ticker-games"></div>
            </div>
            <div class="ticker-date-controls">
                <span id="ticker-prev-day" class="ticker-date-nav">&lt;</span>
                <span id="ticker-date" class="ticker-date" onclick="goToToday()"></span>
                <span id="ticker-next-day" class="ticker-date-nav">&gt;</span>
            </div>
        </div>
    </div>

    <main role="main">
    <div class="container">
        <!-- Meta info bar -->
        <div class="info" id="meta-bar">
            <span>æœ€çµ‚æ›´æ–°: <span id="last-update">â€”</span></span>
            <span style="margin: 0 6px; color: #aaa;">Â·</span>
            <span>ç·è©¦åˆæ•°: <span id="total-games">â€”è©¦åˆ</span></span>
        </div>


        
        
        <!-- AdSense Ad - Fixed Position (Outside Tabs) -->
        <div style="margin: 20px 0; text-align: center; min-width: 320px;">
            <ins class="adsbygoogle"
                 style="display:block; margin: 20px auto; min-width: 300px;"
                 data-ad-client="ca-pub-5508768187151867"
                 data-ad-slot="7298546648"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
            
        </div>

        <!-- Regular Season Magic Numbers -->
        <div id="magic-regular" class="tab-content active">
            <h2 data-i18n="title-regular-magic">2025å¹´æ­£è¦ã‚·ãƒ¼ã‚ºãƒ³å„ªå‹ãƒã‚¸ãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼ã€ã‚»ãƒªãƒ¼ã‚°ãƒ»ãƒ‘ãƒªãƒ¼ã‚°ã€‘</h2>
            
            <div class="leagues">
                <div>
                    <h3 data-i18n="central-league">ã‚»ãƒ³ãƒˆãƒ©ãƒ«ãƒªãƒ¼ã‚°</h3>
                    <table class="magic-table">
                        <thead>
                            <tr>
                                <th class="center" data-i18n="rank">é †ä½</th>
                                <th data-i18n="team">ãƒãƒ¼ãƒ </th>
                                <th class="center" data-i18n="games-played">è©¦åˆ</th>
                                <th class="center" data-i18n="wins">å‹</th>
                                <th class="center" data-i18n="losses">æ•—</th>
                                <th class="center" data-i18n="draws">åˆ†</th>
                                <th class="center" data-i18n="win-rate">å‹ç‡</th>
                                <th class="center" data-i18n="games-behind">ã‚²ãƒ¼ãƒ å·®</th>
                                <th class="center" data-i18n="remaining-games">æ®‹ã‚Šè©¦åˆ</th>
                                <th class="center" data-i18n="max-wins">æœ€å¤§å‹</th>
                                <th class="center" data-i18n="first-place-condition">1ä½æ¡ä»¶</th>
                                <th class="center" data-i18n="magic">ãƒã‚¸ãƒƒã‚¯</th>
                                <th class="center" data-i18n="eliminate">ã‚¨ãƒªãƒŸãƒãƒ¼ãƒˆ</th>
                                <th class="center" data-i18n="playoff-status">é€²å‡ºçŠ¶æ³</th>
                            </tr>
                        </thead>
                        <tbody id="central-magic-regular">
                            <tr><td colspan="13" class="loading">èª­ã¿è¾¼ã¿ä¸­...</td></tr>
                        </tbody>
                    </table>
                </div>

                <!-- AdSense Ad Between Leagues - Regular Magic -->
                <div style="margin: 20px 0; text-align: center; overflow: hidden; min-width: 320px;">
                    <ins class="adsbygoogle"
                         style="display:block; min-width: 300px;"
                         data-ad-client="ca-pub-5508768187151867"
                         data-ad-slot="7298546648"
                         data-ad-format="auto"
                         data-full-width-responsive="true"></ins>
                </div>

                <div>
                    <h3 data-i18n="pacific-league">ãƒ‘ã‚·ãƒ•ã‚£ãƒƒã‚¯ãƒªãƒ¼ã‚°</h3>
                    <table class="magic-table">
                        <thead>
                            <tr>
                                <th class="center" data-i18n="rank">é †ä½</th>
                                <th data-i18n="team">ãƒãƒ¼ãƒ </th>
                                <th class="center" data-i18n="games-played">è©¦åˆ</th>
                                <th class="center" data-i18n="wins">å‹</th>
                                <th class="center" data-i18n="losses">æ•—</th>
                                <th class="center" data-i18n="draws">åˆ†</th>
                                <th class="center" data-i18n="win-rate">å‹ç‡</th>
                                <th class="center" data-i18n="games-behind">ã‚²ãƒ¼ãƒ å·®</th>
                                <th class="center" data-i18n="remaining-games">æ®‹ã‚Šè©¦åˆ</th>
                                <th class="center" data-i18n="max-wins">æœ€å¤§å‹</th>
                                <th class="center" data-i18n="first-place-condition">1ä½æ¡ä»¶</th>
                                <th class="center" data-i18n="magic">ãƒã‚¸ãƒƒã‚¯</th>
                                <th class="center" data-i18n="eliminate">ã‚¨ãƒªãƒŸãƒãƒ¼ãƒˆ</th>
                                <th class="center" data-i18n="playoff-status">é€²å‡ºçŠ¶æ³</th>
                            </tr>
                        </thead>
                        <tbody id="pacific-magic-regular">
                            <tr><td colspan="13" class="loading">èª­ã¿è¾¼ã¿ä¸­...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="tab-help tab-help-magic-regular" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px; padding: 12px; margin: 15px 0; font-size: 13px; color: #333;">
                <strong>ğŸ“Š ãƒã‚¸ãƒƒã‚¯ / ã‚¨ãƒªãƒŸãƒãƒ¼ã‚·ãƒ§ãƒ³ã®å®šç¾©</strong><br>
                <div style="margin-top: 8px; line-height: 1.5;">
                â€¢ <strong>ç·è©¦åˆæ•°</strong>: NPBã¯å„ãƒãƒ¼ãƒ <strong>143è©¦åˆ</strong><br>
                â€¢ <strong>å‹ç‡</strong>: å‹ / (å‹ + æ•—)ï¼ˆåˆ†ã¯å‹ç‡ã«å«ã‚ãªã„ï¼‰<br>
                â€¢ <strong>å„ªå‹ãƒã‚¸ãƒƒã‚¯</strong>: (2ä½ã®<strong>æœ€å¤§å¯èƒ½å‹æ•°</strong>) âˆ’ (1ä½ã®ç¾åœ¨å‹æ•°) + 1ï¼ˆ0ä»¥ä¸‹ã§âœ“ï¼‰<br>
                â€¢ <strong>ã‚¨ãƒªãƒŸãƒãƒ¼ãƒˆ(E)</strong>: 1ä½å‹æ•° ï¼ ãƒãƒ¼ãƒ æœ€å¤§å¯èƒ½å‹æ•°, ã¾ãŸã¯ <code>(143+1) âˆ’ 1ä½å‹ âˆ’ ãƒãƒ¼ãƒ æ•— â‰¤ 0</code><br>
                â€¢ <strong>è¨˜å·</strong>: <strong>âœ“</strong>ï¼ç¢ºå®š, <strong>E</strong>ï¼ä¸å¯èƒ½, <strong>-</strong>ï¼è©²å½“ãªã—
                </div>
            </div>
        </div>

        <!-- Playoff Magic Numbers -->
        <div id="magic-playoff" class="tab-content">
            <h2 data-i18n="title-playoff-magic">ã‚¯ãƒ©ã‚¤ãƒãƒƒã‚¯ã‚¹ã‚·ãƒªãƒ¼ã‚º(CS)é€²å‡ºãƒã‚¸ãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼ã€2025å¹´æœ€æ–°ã€‘</h2>
            <div class="leagues">
                <div>
                    <h3 data-i18n="central-league-top3">ã‚»ãƒ³ãƒˆãƒ©ãƒ«ãƒªãƒ¼ã‚° (ä¸Šä½3ãƒãƒ¼ãƒ )</h3>
                    <table class="magic-table">
                        <thead>
                            <tr>
                                <th class="center" data-i18n="rank">é †ä½</th>
                                <th data-i18n="team">ãƒãƒ¼ãƒ </th>
                                <th class="center" data-i18n="wins">å‹</th>
                                <th class="center" data-i18n="losses">æ•—</th>
                                <th class="center" data-i18n="draws">åˆ†</th>
                                <th class="center" data-i18n="win-rate">å‹ç‡</th>
                                <th class="center" data-i18n="games-played">è©¦åˆ</th>
                                <th class="center" data-i18n="games-behind">ã‚²ãƒ¼ãƒ å·®</th>
                                <th class="center" data-i18n="remaining-games">æ®‹ã‚Šè©¦åˆ</th>
                                <th class="center" data-i18n="max-wins">æœ€å¤§å‹</th>
                                <th class="center" data-i18n="magic">ãƒã‚¸ãƒƒã‚¯</th>
                                <th class="center" data-i18n="eliminate">ã‚¨ãƒªãƒŸãƒãƒ¼ãƒˆ</th>
                                <th class="center" data-i18n="playoff-status">é€²å‡ºçŠ¶æ³</th>
                            </tr>
                        </thead>
                        <tbody id="central-magic-playoff">
                            <tr><td colspan="13" class="loading">èª­ã¿è¾¼ã¿ä¸­...</td></tr>
                        </tbody>
                    </table>
                </div>

                <!-- AdSense Ad Between Leagues - Playoff Magic -->
                <div style="margin: 20px 0; text-align: center; overflow: hidden; min-width: 320px;">
                    <ins class="adsbygoogle"
                         style="display:block; min-width: 300px;"
                         data-ad-client="ca-pub-5508768187151867"
                         data-ad-slot="7298546648"
                         data-ad-format="auto"
                         data-full-width-responsive="true"></ins>
                </div>

                <div>
                    <h3 data-i18n="pacific-league-top3">ãƒ‘ã‚·ãƒ•ã‚£ãƒƒã‚¯ãƒªãƒ¼ã‚° (ä¸Šä½3ãƒãƒ¼ãƒ )</h3>
                    <table class="magic-table">
                        <thead>
                            <tr>
                                <th class="center" data-i18n="rank">é †ä½</th>
                                <th data-i18n="team">ãƒãƒ¼ãƒ </th>
                                <th class="center" data-i18n="wins">å‹</th>
                                <th class="center" data-i18n="losses">æ•—</th>
                                <th class="center" data-i18n="draws">åˆ†</th>
                                <th class="center" data-i18n="win-rate">å‹ç‡</th>
                                <th class="center" data-i18n="games-played">è©¦åˆ</th>
                                <th class="center" data-i18n="games-behind">ã‚²ãƒ¼ãƒ å·®</th>
                                <th class="center" data-i18n="remaining-games">æ®‹ã‚Šè©¦åˆ</th>
                                <th class="center" data-i18n="max-wins">æœ€å¤§å‹</th>
                                <th class="center" data-i18n="magic">ãƒã‚¸ãƒƒã‚¯</th>
                                <th class="center" data-i18n="eliminate">ã‚¨ãƒªãƒŸãƒãƒ¼ãƒˆ</th>
                                <th class="center" data-i18n="playoff-status">é€²å‡ºçŠ¶æ³</th>
                            </tr>
                        </thead>
                        <tbody id="pacific-magic-playoff">
                            <tr><td colspan="13" class="loading">èª­ã¿è¾¼ã¿ä¸­...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="tab-help tab-help-magic-playoff" style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 4px; padding: 12px; margin: 15px 0; font-size: 13px; color: #533f03;">
                <strong>ğŸ† ã‚¯ãƒ©ã‚¤ãƒãƒƒã‚¯ã‚¹ã‚·ãƒªãƒ¼ã‚º (CS) é€²å‡ºã«ã¤ã„ã¦</strong><br>
                <div style="margin-top: 8px; line-height: 1.5;">
                â€¢ <strong>é€²å‡ºãƒãƒ¼ãƒ </strong>: å„ãƒªãƒ¼ã‚°ï¼ˆã‚»ãƒ»ãƒ‘ï¼‰<strong>ä¸Šä½3ãƒãƒ¼ãƒ </strong>ãŒCSé€²å‡º<br>
                â€¢ <strong>ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã‚¹ãƒ†ãƒ¼ã‚¸</strong>: 2ä½vs3ä½ï¼ˆ3æˆ¦2å‹åˆ¶ï¼‰<br>
                â€¢ <strong>ãƒ•ã‚¡ã‚¤ãƒŠãƒ«ã‚¹ãƒ†ãƒ¼ã‚¸</strong>: 1ä½vsãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã‚¹ãƒ†ãƒ¼ã‚¸å‹è€…ï¼ˆ6æˆ¦4å‹åˆ¶ã€1ä½ã«1å‹ã‚¢ãƒ‰ãƒãƒ³ãƒ†ãƒ¼ã‚¸ï¼‰<br>
                â€¢ <strong>ãƒã‚¸ãƒƒã‚¯</strong>: CSé€²å‡ºç¢ºå®šã¾ã§ã®å¿…è¦å‹æ•°ï¼ˆâœ“ã§ç¢ºå®šï¼‰<br>
                â€¢ <strong>ã‚¨ãƒªãƒŸãƒãƒ¼ãƒˆ(E)</strong>: CSé€²å‡ºã®å¯èƒ½æ€§ãŒæ¶ˆå¤±ï¼ˆæ•°å€¤ã¯æ®‹ã‚Šæ•—æ•°ã®è¨±å®¹å€¤ï¼‰<br>
                â€¢ <strong>é€²å‡ºçŠ¶æ³</strong>: ãƒ•ã‚¡ã‚¤ãƒŠãƒ«ç›´è¡Œï¼ˆ1ä½ï¼‰ / ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã‚¹ãƒ†ãƒ¼ã‚¸ï¼ˆ2ä½ãƒ»3ä½ï¼‰
                </div>
            </div>
        </div>

        <!-- Scenarios -->
        <div id="scenarios" class="tab-content">
            <h2 data-i18n="title-scenarios">çµŒè·¯ã®æ•°ï¼ˆå ´åˆã®æ•°ï¼‰</h2>

            <!-- Central League Scenario Views -->
            <div style="margin-bottom: 20px;">
                <h3 data-i18n="central-league">ã‚»ãƒ³ãƒˆãƒ©ãƒ«ãƒªãƒ¼ã‚°</h3>
                <div class="schedule-toggle" style="margin: 8px 0;">
                    <div class="toggle-group" role="tablist" aria-label="Central Scenario View">
                        <button id="btn-central-matrix" class="toggle-btn active" role="tab" aria-selected="true" data-i18n="matrix">ãƒãƒˆãƒªã‚¯ã‚¹</button>
                        <button id="btn-central-detailed" class="toggle-btn" role="tab" aria-selected="false" data-i18n="detailed">è©³ç´°</button>
                    </div>
                </div>
                <div id="central-scenario-matrix" class="scenario-section" style="display: none;">
                    <div id="central-scenario-content"></div>
                </div>
                <div id="central-scenario-detailed" class="scenario-section" style="display: none;"></div>
            </div>

            <!-- AdSense Ad Between Leagues - Scenarios -->
            <div style="margin: 20px 0; text-align: center; min-width: 320px;">
                <ins class="adsbygoogle"
                     style="display:block; min-width: 300px;"
                     data-ad-client="ca-pub-5508768187151867"
                     data-ad-slot="4067267701"
                     data-ad-format="auto"
                     data-full-width-responsive="true"></ins>
            </div>

            <!-- Pacific League Scenario Views -->
            <div>
                <h3 data-i18n="pacific-league">ãƒ‘ã‚·ãƒ•ã‚£ãƒƒã‚¯ãƒªãƒ¼ã‚°</h3>
                <div class="schedule-toggle" style="margin: 8px 0;">
                    <div class="toggle-group" role="tablist" aria-label="Pacific Scenario View">
                        <button id="btn-pacific-matrix" class="toggle-btn active" role="tab" aria-selected="true" data-i18n="matrix">ãƒãƒˆãƒªã‚¯ã‚¹</button>
                        <button id="btn-pacific-detailed" class="toggle-btn" role="tab" aria-selected="false" data-i18n="detailed">è©³ç´°</button>
                    </div>
                </div>
                <div id="pacific-scenario-matrix" class="scenario-section" style="display: none;">
                    <div id="pacific-scenario-content"></div>
                </div>
                <div id="pacific-scenario-detailed" class="scenario-section" style="display: none;"></div>
            </div>

            <div class="tab-help tab-help-scenarios" style="background: #e7f3ff; border: 1px solid #b3d7ff; border-radius: 4px; padding: 12px; margin: 15px 0; font-size: 13px; color: #003566;">
                <strong>ğŸ“ˆ å‹ç‡åˆ¥ã‚·ãƒŠãƒªã‚ªåˆ†æ</strong><br>
                <div style="margin-top: 8px; line-height: 1.5;">
                â€¢ <strong>ãƒãƒˆãƒªã‚¯ã‚¹</strong>: æ®‹ã‚Šå‹æ•—ã”ã¨ã®æœ€çµ‚å‹ç‡ã‚’æ¨ªæ–­æ¯”è¼ƒ<br>
                â€¢ <strong>è©³ç´°</strong>: ä¸Šä½ãƒãƒ¼ãƒ ã®å…¨æ®‹ã‚Šå‹æ•—çµ„ã¿åˆã‚ã›ã‚’ä¸€è¦§<br>
                â€¢ <strong>èµ¤ã„ä»•åˆ‡ã‚Šç·š</strong>: <u>3ä½ãƒ©ã‚¤ãƒ³</u>ï¼ˆCSé€²å‡ºæ ã®å¢ƒç•Œï¼‰<br>
                â€¢ <strong>è¡¨ç¤ºå¯¾è±¡</strong>: <u>3ä½é€²å‡ºã®å¯èƒ½æ€§ãŒæ®‹ã‚‹ãƒãƒ¼ãƒ ã®ã¿</u>ã‚’è¡¨ç¤ºï¼ˆ3ä½é€²å‡ºè„±è½ãŒç¢ºå®šã—ãŸãƒãƒ¼ãƒ ã¯è‡ªå‹•çš„ã«éè¡¨ç¤ºï¼‰
                </div>
            </div>
        </div>

        <!-- Detailed Standings -->
        <div id="standings" class="tab-content">
            <h2 data-i18n="title-detailed-standings">NPBè©³ç´°é †ä½è¡¨ã€å‹ç‡ãƒ»ã‚²ãƒ¼ãƒ å·®ãƒ»æ®‹ã‚Šè©¦åˆæ•°ã€‘</h2>
            <div class="scroll-table">
                <h3 data-i18n="central-league">ã‚»ãƒ³ãƒˆãƒ©ãƒ«ãƒªãƒ¼ã‚°</h3>
                <table class="detailed-table">
                    <thead>
                        <tr>
                            <th class="center">é †ä½</th>
                            <th>ãƒãƒ¼ãƒ </th>
                            <th class="center">è©¦åˆ</th>
                            <th class="center">å‹</th>
                            <th class="center">æ•—</th>
                            <th class="center">åˆ†</th>
                            <th class="center">å‹ç‡</th>
                            <th class="center">æ®‹ã‚Š</th>
                            <th class="center">å·®</th>
                            <th class="center">é€£å‹/é€£æ•—</th>
                            <th class="center">ç›´è¿‘10</th>
                            <th class="center">ãƒ›ãƒ¼ãƒ </th>
                            <th class="center">ãƒ›ãƒ¼ãƒ ç‡</th>
                            <th class="center">ã‚¢ã‚¦ã‚§ãƒ¼</th>
                            <th class="center">ã‚¢ã‚¦ã‚§ãƒ¼ç‡</th>
                            <th class="center">æœ€é«˜é †ä½</th>
                            <th class="center">æœ€ä½é †ä½</th>
                        </tr>
                    </thead>
                    <tbody id="central-detailed">
                        <tr><td colspan="17" class="loading">èª­ã¿è¾¼ã¿ä¸­...</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- AdSense Ad Between Leagues - Standings -->
            <div style="margin: 20px 0; text-align: center; min-width: 320px;">
                <ins class="adsbygoogle"
                     style="display:block; min-width: 300px;"
                     data-ad-client="ca-pub-5508768187151867"
                     data-ad-slot="4067267701"
                     data-ad-format="auto"
                     data-full-width-responsive="true"></ins>
            </div>

            <div class="scroll-table" style="margin-top: 30px;">
                <h3 data-i18n="pacific-league">ãƒ‘ã‚·ãƒ•ã‚£ãƒƒã‚¯ãƒªãƒ¼ã‚°</h3>
                <table class="detailed-table">
                    <thead>
                        <tr>
                            <th class="center">é †ä½</th>
                            <th>ãƒãƒ¼ãƒ </th>
                            <th class="center">è©¦åˆ</th>
                            <th class="center">å‹</th>
                            <th class="center">æ•—</th>
                            <th class="center">åˆ†</th>
                            <th class="center">å‹ç‡</th>
                            <th class="center">æ®‹ã‚Š</th>
                            <th class="center">å·®</th>
                            <th class="center">é€£å‹/é€£æ•—</th>
                            <th class="center">ç›´è¿‘10</th>
                            <th class="center">ãƒ›ãƒ¼ãƒ </th>
                            <th class="center">ãƒ›ãƒ¼ãƒ ç‡</th>
                            <th class="center">ã‚¢ã‚¦ã‚§ãƒ¼</th>
                            <th class="center">ã‚¢ã‚¦ã‚§ãƒ¼ç‡</th>
                            <th class="center">æœ€é«˜é †ä½</th>
                            <th class="center">æœ€ä½é †ä½</th>
                        </tr>
                    </thead>
                    <tbody id="pacific-detailed">
                        <tr><td colspan="17" class="loading">èª­ã¿è¾¼ã¿ä¸­...</td></tr>
                    </tbody>
                </table>
            </div>
            <div class="tab-help tab-help-standings" style="background: #f1f3f5; border: 1px solid #dee2e6; border-radius: 4px; padding: 10px; margin: 10px 0; font-size: 12px; color: #333;">
                â€¢ <strong>å‹ç‡</strong>= å‹ / (å‹+æ•—), <strong>æ®‹ã‚Š</strong>= 143 âˆ’ è©¦åˆ, <strong>å·®</strong>= é¦–ä½ã‹ã‚‰ã®ã‚²ãƒ¼ãƒ å·®<br>
                â€¢ <strong>åˆ†</strong>ã¯å‹ç‡ã«å«ã¾ã‚Œã¾ã›ã‚“ã€‚è¡¨ç¤ºã¯æœ€æ–°JSONã«åŸºã¥ãã¾ã™ã€‚
            </div>
        </div>

        <!-- Remaining Games -->
        <div id="remaining" class="tab-content">
            <h2 data-i18n="title-remaining-matrix">æ®‹ã‚Šè©¦åˆå¯¾æˆ¦ãƒãƒˆãƒªã‚¯ã‚¹ã€ãƒãƒ¼ãƒ åˆ¥å¯¾æˆ¦äºˆå®šã€‘</h2>
            <div style="margin: 20px 0;">
                <h3 data-i18n="central-league">ã‚»ãƒ³ãƒˆãƒ©ãƒ«ãƒªãƒ¼ã‚°</h3>
                <div class="matrix-container">
                    <div id="central-remaining-matrix" class="remaining-matrix">
                        <div class="loading">èª­ã¿è¾¼ã¿ä¸­...</div>
                    </div>
                </div>
            </div>

            <!-- AdSense Ad Between Leagues - Remaining Games -->
            <div style="margin: 20px 0; text-align: center; min-width: 320px;">
                <ins class="adsbygoogle"
                     style="display:block; min-width: 300px;"
                     data-ad-client="ca-pub-5508768187151867"
                     data-ad-slot="4067267701"
                     data-ad-format="auto"
                     data-full-width-responsive="true"></ins>
            </div>

            <div style="margin: 20px 0;">
                <h3 data-i18n="pacific-league">ãƒ‘ã‚·ãƒ•ã‚£ãƒƒã‚¯ãƒªãƒ¼ã‚°</h3>
                <div class="matrix-container">
                    <div id="pacific-remaining-matrix" class="remaining-matrix">
                        <div class="loading">èª­ã¿è¾¼ã¿ä¸­...</div>
                    </div>
                </div>
            </div>
            <div class="tab-help tab-help-remaining" style="background: #f1f3f5; border: 1px solid #dee2e6; border-radius: 4px; padding: 10px; margin: 10px 0; font-size: 12px; color: #333;">
                â€¢ <strong>ç¸¦è»¸(å·¦å´)</strong>: ãƒ›ãƒ¼ãƒ ãƒãƒ¼ãƒ ã€<strong>æ¨ªè»¸(ä¸Šéƒ¨)</strong>: ã‚¢ã‚¦ã‚§ãƒ¼ãƒãƒ¼ãƒ <br>
                â€¢ <strong>æ•°å­—</strong>: ä»Šå¾Œäºˆå®šã•ã‚Œã¦ã„ã‚‹å¯¾æˆ¦æ•°<br>
                â€¢ <strong>ãƒãƒ¼ãƒ å</strong>: ãƒ­ã‚´ä»˜ãæ—¥æœ¬èªåã§è¡¨ç¤º<br>
                â€¢ <strong>åˆè¨ˆ</strong>: å„ãƒãƒ¼ãƒ ã®æ®‹ã‚Šè©¦åˆæ•°ãŒå³ç«¯ãƒ»ä¸‹éƒ¨ã«è¡¨ç¤º
            </div>
        </div>

        <!-- Progress Tab -->
        <div id="progress" class="tab-content">
            <h2 data-i18n="title-progress">2025å¹´ã‚·ãƒ¼ã‚ºãƒ³é€²è¡ŒçŠ¶æ³ã€æ¶ˆåŒ–è©¦åˆæ•°ãƒ»é€²æ—ç‡ã€‘</h2>
            
            <!-- ì „ì²´ ì†Œí™”ìœ¨ ì„¹ì…˜ -->
            <div style="margin: 20px 0;">
                <h3>ğŸ† ã‚·ãƒ¼ã‚ºãƒ³å…¨ä½“é€²è¡Œç‡</h3>
                <div id="season-progress" style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 15px 0;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <span style="font-size: 18px; font-weight: bold;">å…¨ä½“é€²è¡Œç‡</span>
                        <span id="overall-percentage" style="font-size: 24px; font-weight: bold; color: #2e7d32;">â€”%</span>
                    </div>
                    <div id="overall-progress-bar" style="width: 100%; height: 20px; background: #e0e0e0; border-radius: 10px; overflow: hidden;">
                        <div id="overall-progress-fill" style="height: 100%; background: linear-gradient(90deg, #4caf50, #2e7d32); width: 0%; transition: width 0.5s ease;"></div>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-top: 10px; font-size: 14px; color: #666;">
                        <span>å®Œäº†: <span id="completed-games">â€”</span>è©¦åˆ</span>
                        <span>æ®‹ã‚Š: <span id="remaining-total">â€”</span>è©¦åˆ</span>
                        <span>ç·è©¦åˆæ•°: <span id="total-season-games">â€”</span>è©¦åˆ</span>
                    </div>
                </div>
            </div>

            <!-- AdSense Ad Between Progress Sections -->
            <div style="margin: 20px 0; text-align: center; overflow: hidden; min-width: 320px;">
                <ins class="adsbygoogle"
                     style="display:block; min-width: 300px;"
                     data-ad-client="ca-pub-5508768187151867"
                     data-ad-slot="7298546648"
                     data-ad-format="auto"
                     data-full-width-responsive="true"></ins>
            </div>

            <!-- íŒ€ë³„ ì§„í–‰ë¥  ì„¹ì…˜ -->
            <div style="margin: 20px 0;">
                <h3>ğŸ“Š ãƒãƒ¼ãƒ åˆ¥é€²è¡ŒçŠ¶æ³</h3>
                <div class="grid-3col" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 15px 0; align-items: start;">

                    <!-- ì„¼íŠ¸ëŸ´ë¦¬ê·¸ -->
                    <div>
                        <h4>ã‚»ãƒ³ãƒˆãƒ©ãƒ«ãƒªãƒ¼ã‚°</h4>
                        <div id="central-progress" class="league-progress">
                            <div class="loading">ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ä¸­...</div>
                        </div>
                    </div>

                    <!-- í¼ì‹œí”½ë¦¬ê·¸ -->
                    <div>
                        <h4>ãƒ‘ã‚·ãƒ•ã‚£ãƒƒã‚¯ãƒªãƒ¼ã‚°</h4>
                        <div id="pacific-progress" class="league-progress">
                            <div class="loading">ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ä¸­...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ì¶”ê°€ í†µê³„ ì„¹ì…˜ -->
            <div style="margin: 20px 0;">
                <h3>ğŸ“ˆ è©³ç´°çµ±è¨ˆ</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div class="stat-card">
                        <div class="stat-title">å¹³å‡æ¶ˆåŒ–ç‡</div>
                        <div class="stat-value" id="average-progress">â€”%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">æœ€é«˜é€²è¡Œãƒãƒ¼ãƒ </div>
                        <div class="stat-value" id="highest-team">â€”</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">æœ€ä½é€²è¡Œãƒãƒ¼ãƒ </div>
                        <div class="stat-value" id="lowest-team">â€”</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">é€²è¡Œå·®</div>
                        <div class="stat-value" id="progress-gap">â€”è©¦åˆ</div>
                    </div>
                </div>
            </div>

            <div class="tab-help" style="background: #f1f3f5; border: 1px solid #dee2e6; border-radius: 4px; padding: 10px; margin: 10px 0; font-size: 12px; color: #333;">
                â€¢ <strong>é€²è¡Œç‡</strong>: ê°ãƒãƒ¼ãƒ ãŒæ¶ˆåŒ–ã—ãŸè©¦åˆæ•° / 143è©¦åˆ Ã— 100%<br>
                â€¢ <strong>å…¨ä½“é€²è¡Œç‡</strong>: ì „ãƒãƒ¼ãƒ å¹³å‡ã®é€²è¡ŒçŠ¶æ³<br>
                â€¢ <strong>æ®‹ã‚Šè©¦åˆ</strong>: 143 - í˜„ì¬ã®æ¶ˆåŒ–è©¦åˆæ•°<br>
                â€¢ ë°ì´í„°ã¯ìµœæ–°ã®é †ä½è¡¨ã«åŸºã¥ã„ã¦ìë™æ›´æ–°ã•ã‚Œã¾ã™
            </div>
        </div>
        </section>
    </main>

    <script>
        // ===== ë‹¤êµ­ì–´ ë²ˆì—­ ë°ì´í„° =====
        const translations = {
            ja: {
                // ë©”ì¸ í—¤ë”
                'main-title': 'NPB 2025ã‚·ãƒ¼ã‚ºãƒ³ é †ä½è¡¨ãƒ»ãƒã‚¸ãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼ãƒ»CSé€²å‡ºç¢ºç‡',
                
                // ë„¤ë¹„ê²Œì´ì…˜ íƒ­
                'nav-magic-regular': 'å„ªå‹ãƒã‚¸ãƒƒã‚¯',
                'nav-magic-playoff': 'ãƒã‚¹ãƒˆã‚·ãƒ¼ã‚ºãƒ³ãƒã‚¸ãƒƒã‚¯', 
                'nav-scenarios': 'çµŒè·¯ã®æ•°',
                'nav-standings': 'ãƒãƒ¼ãƒ é †ä½',
                'nav-remaining': 'æ®‹ã‚Šè©¦åˆæ•°',
                'nav-progress': 'é€²è¡ŒçŠ¶æ³',
                
                // ì„¹ì…˜ ì œëª©
                'title-regular-magic': '2025å¹´æ­£è¦ã‚·ãƒ¼ã‚ºãƒ³å„ªå‹ãƒã‚¸ãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼ã€ã‚»ãƒªãƒ¼ã‚°ãƒ»ãƒ‘ãƒªãƒ¼ã‚°ã€‘',
                'title-playoff-magic': 'ã‚¯ãƒ©ã‚¤ãƒãƒƒã‚¯ã‚¹ã‚·ãƒªãƒ¼ã‚º(CS)é€²å‡ºãƒã‚¸ãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼ã€2025å¹´æœ€æ–°ã€‘',
                'title-detailed-standings': 'NPBè©³ç´°é †ä½è¡¨ã€å‹ç‡ãƒ»ã‚²ãƒ¼ãƒ å·®ãƒ»æ®‹ã‚Šè©¦åˆæ•°ã€‘',
                'title-remaining-matrix': 'æ®‹ã‚Šè©¦åˆå¯¾æˆ¦ãƒãƒˆãƒªã‚¯ã‚¹ã€ãƒãƒ¼ãƒ åˆ¥å¯¾æˆ¦äºˆå®šã€‘',
                'title-progress': '2025å¹´ã‚·ãƒ¼ã‚ºãƒ³é€²è¡ŒçŠ¶æ³ã€æ¶ˆåŒ–è©¦åˆæ•°ãƒ»é€²æ—ç‡ã€‘',
                'title-scenarios': 'çµŒè·¯ã®æ•°ï¼ˆå ´åˆã®æ•°ï¼‰',
                
                // ë¦¬ê·¸ëª…
                'central-league': 'ã‚»ãƒ³ãƒˆãƒ©ãƒ«ãƒªãƒ¼ã‚°',
                'pacific-league': 'ãƒ‘ã‚·ãƒ•ã‚£ãƒƒã‚¯ãƒªãƒ¼ã‚°',
                'central-league-top3': 'ã‚»ãƒ³ãƒˆãƒ©ãƒ«ãƒªãƒ¼ã‚° (ä¸Šä½3ãƒãƒ¼ãƒ )',
                'pacific-league-top3': 'ãƒ‘ã‚·ãƒ•ã‚£ãƒƒã‚¯ãƒªãƒ¼ã‚° (ä¸Šä½3ãƒãƒ¼ãƒ )',
                
                // í…Œì´ë¸” í—¤ë”
                'rank': 'é †ä½',
                'team': 'ãƒãƒ¼ãƒ ',
                'games-played': 'è©¦åˆ',
                'wins': 'å‹',
                'losses': 'æ•—',
                'draws': 'åˆ†',
                'win-rate': 'å‹ç‡',
                'games-behind': 'ã‚²ãƒ¼ãƒ å·®',
                'remaining-games': 'æ®‹ã‚Šè©¦åˆ',
                'max-wins': 'æœ€å¤§å‹',
                'first-place-condition': '1ä½æ¡ä»¶',
                'magic': 'ãƒã‚¸ãƒƒã‚¯',
                'eliminate': 'ã‚¨ãƒªãƒŸãƒãƒ¼ãƒˆ',
                'playoff-status': 'é€²å‡ºçŠ¶æ³',
                'clinch': 'ã‚¯ãƒªãƒ³ãƒ',
                'runs-scored': 'å¾—ç‚¹',
                'runs-allowed': 'å¤±ç‚¹',
                'run-differential': 'å¾—å¤±ç‚¹å·®',
                
                // ë²„íŠ¼
                'today': 'ä»Šæ—¥',
                'tomorrow': 'æ˜æ—¥',
                'matrix': 'ãƒãƒˆãƒªã‚¯ã‚¹',
                'detailed': 'è©³ç´°',
                
                // ë„ì›€ë§ ë° ì„¤ëª…
                'help-regular-magic': '<strong>ğŸ† æ­£è¦ã‚·ãƒ¼ã‚ºãƒ³å„ªå‹ãƒã‚¸ãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼</strong><br>å„ãƒãƒ¼ãƒ ãŒå„ªå‹ã‚’ç¢ºå®šã™ã‚‹ãŸã‚ã«å¿…è¦ãªæœ€å°‘å‹åˆ©æ•°ã§ã™ã€‚ä»–ãƒãƒ¼ãƒ ã®çµæœã«é–¢ä¿‚ãªãã€ã“ã®æ•°ã ã‘å‹ã¦ã°å„ªå‹ãŒæ±ºå®šã—ã¾ã™ã€‚ã€Œâœ“ã€ã¯æ—¢ã«å„ªå‹ç¢ºå®šæ¸ˆã¿ã‚’ç¤ºã—ã¾ã™ã€‚',
                'help-playoff-magic': '<strong>ğŸ† ã‚¯ãƒ©ã‚¤ãƒãƒƒã‚¯ã‚¹ã‚·ãƒªãƒ¼ã‚º (CS) é€²å‡ºã«ã¤ã„ã¦</strong><br>ã‚»ãƒªãƒ¼ã‚°ãƒ»ãƒ‘ãƒªãƒ¼ã‚°ã¨ã‚‚ã«ä¸Šä½3ãƒãƒ¼ãƒ ãŒCSé€²å‡ºã€‚3ä½ä»¥å†…ç¢ºå®šã«å¿…è¦ãªæœ€å°‘å‹åˆ©æ•°ã‚’è¡¨ç¤ºã€‚é †ä½ç¢ºå®šæ¸ˆã¿ã¯ã€Œâœ“ã€ã§è¡¨ç¤ºã€‚',
                'help-scenarios': '<strong>ğŸ“Š ã‚·ãƒŠãƒªã‚ªåˆ†æã«ã¤ã„ã¦</strong><br>å„ãƒãƒ¼ãƒ ãŒç‰¹å®šé †ä½ã«ãªã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹å ´åˆã®æ•°ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚è¨ˆç®—ã¯æ®‹ã‚Šè©¦åˆã®å…¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è€ƒæ…®ã—ã¾ã™ã€‚',
                'help-standings': '<strong>ğŸ“‹ é †ä½è¡¨ã«ã¤ã„ã¦</strong><br>ç¾åœ¨ã®å„ãƒãƒ¼ãƒ æˆç¸¾ã¨é †ä½ã§ã™ã€‚å‹ç‡ã¯å¼•ãåˆ†ã‘ã‚’é™¤å¤–ã—ã¦è¨ˆç®—ã•ã‚Œã¾ã™ã€‚',
                'help-remaining': '<strong>ğŸ—“ æ®‹ã‚Šè©¦åˆã«ã¤ã„ã¦</strong><br>å„ãƒãƒ¼ãƒ é–“ã®æ®‹ã‚Šå¯¾æˆ¦æ•°ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚æ•°å­—ã¯æ®‹ã‚Šå¯¾æˆ¦å›æ•°ã‚’ç¤ºã—ã¾ã™ã€‚',
                'help-progress': '<strong>ğŸ“ˆ é€²è¡ŒçŠ¶æ³ã«ã¤ã„ã¦</strong><br>ã‚·ãƒ¼ã‚ºãƒ³å…¨ä½“ãŠã‚ˆã³å„ãƒãƒ¼ãƒ ã®æ¶ˆåŒ–è©¦åˆæ•°ã¨é€²æ—ç‡ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚',
                
                // ìƒíƒœ ë©”ì‹œì§€
                'championship-decided': 'å„ªå‹æ±ºå®š',
                'playoff-secured': 'CSç¢ºå®š',
                'eliminated': 'åœå¤–ç¢ºå®š',
                'still-possible': 'å¯èƒ½æ€§ã‚ã‚Š',
                
                // NPB íŒ€ëª… (ì¼ë³¸ì–´)
                'giants': 'èª­å£²ã‚¸ãƒ£ã‚¤ã‚¢ãƒ³ãƒ„',
                'tigers': 'é˜ªç¥ã‚¿ã‚¤ã‚¬ãƒ¼ã‚¹', 
                'dragons': 'ä¸­æ—¥ãƒ‰ãƒ©ã‚´ãƒ³ã‚º',
                'carp': 'åºƒå³¶æ±æ´‹ã‚«ãƒ¼ãƒ—',
                'swallows': 'æ±äº¬ãƒ¤ã‚¯ãƒ«ãƒˆã‚¹ãƒ¯ãƒ­ãƒ¼ã‚º',
                'baystars': 'æ¨ªæµœDeNAãƒ™ã‚¤ã‚¹ã‚¿ãƒ¼ã‚º',
                'hawks': 'ã‚½ãƒ•ãƒˆãƒãƒ³ã‚¯ãƒ›ãƒ¼ã‚¯ã‚¹',
                'eagles': 'æ±åŒ—æ¥½å¤©ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¤ãƒ¼ã‚°ãƒ«ã‚¹',
                'lions': 'åŸ¼ç‰è¥¿æ­¦ãƒ©ã‚¤ã‚ªãƒ³ã‚º',
                'marines': 'åƒè‘‰ãƒ­ãƒƒãƒ†ãƒãƒªãƒ¼ãƒ³ã‚º',
                'fighters': 'åŒ—æµ·é“æ—¥æœ¬ãƒãƒ ãƒ•ã‚¡ã‚¤ã‚¿ãƒ¼ã‚º',
                'buffaloes': 'ã‚ªãƒªãƒƒã‚¯ã‚¹ãƒãƒ•ã‚¡ãƒ­ãƒ¼ã‚º',
                
                // íŒ€ëª… ì¤„ì„ë§
                'giants-short': 'ã‚¸ãƒ£ã‚¤ã‚¢ãƒ³ãƒ„',
                'tigers-short': 'ã‚¿ã‚¤ã‚¬ãƒ¼ã‚¹',
                'dragons-short': 'ãƒ‰ãƒ©ã‚´ãƒ³ã‚º',
                'carp-short': 'ã‚«ãƒ¼ãƒ—',
                'swallows-short': 'ã‚¹ãƒ¯ãƒ­ãƒ¼ã‚º',
                'baystars-short': 'ãƒ™ã‚¤ã‚¹ã‚¿ãƒ¼ã‚º',
                'hawks-short': 'ãƒ›ãƒ¼ã‚¯ã‚¹',
                'eagles-short': 'ã‚¤ãƒ¼ã‚°ãƒ«ã‚¹',
                'lions-short': 'ãƒ©ã‚¤ã‚ªãƒ³ã‚º',
                'marines-short': 'ãƒãƒªãƒ¼ãƒ³ã‚º',
                'fighters-short': 'ãƒ•ã‚¡ã‚¤ã‚¿ãƒ¼ã‚º',
                'buffaloes-short': 'ãƒãƒ•ã‚¡ãƒ­ãƒ¼ã‚º',
                
                // ì¡°ê±´ ë©”ì‹œì§€
                'wins-needed': 'å‹å¿…è¦',
                'championship-secured': 'å„ªå‹ç¢ºå®šæ¸ˆã¿',
                'playoff-advancement-secured': 'CSé€²å‡ºç¢ºå®š',
                'eliminated-short': 'E',
                'no-remaining-games': 'æ®‹ã‚Šè©¦åˆãªã—',
                
                // ì§„í–‰ ìƒí™© í…ìŠ¤íŠ¸
                'games-completed': 'å®Œäº†',
                'games-remaining': 'æ®‹ã‚Š',
                'games-unit': 'è©¦åˆ',
                'progress-gap': 'è©¦åˆå·®'
            },
            ko: {
                // ë©”ì¸ í—¤ë”
                'main-title': 'NPB 2025ì‹œì¦Œ ìˆœìœ„í‘œÂ·ë§¤ì§ë„˜ë²„Â·CSì§„ì¶œí™•ë¥ ',
                
                // ë„¤ë¹„ê²Œì´ì…˜ íƒ­
                'nav-magic-regular': 'ì •ê·œì‹œì¦Œ ìš°ìŠ¹ ë§¤ì§',
                'nav-magic-playoff': 'í”Œë ˆì´ì˜¤í”„ ë§¤ì§',
                'nav-scenarios': 'ê²½ë¡œì˜ ìˆ˜',
                'nav-standings': 'íŒ€ ìˆœìœ„',
                'nav-remaining': 'ë‚¨ì€ ê²½ê¸°ìˆ˜',
                'nav-progress': 'ì§„í–‰ ìƒí™©',
                
                // ì„¹ì…˜ ì œëª©
                'title-regular-magic': '2025ë…„ ì •ê·œì‹œì¦Œ ìš°ìŠ¹ ë§¤ì§ë„˜ë²„ã€ì„¼íŠ¸ëŸ´Â·í¼ì‹œí”½ ë¦¬ê·¸ã€‘',
                'title-playoff-magic': 'í´ë¼ì´ë§¥ìŠ¤ ì‹œë¦¬ì¦ˆ(CS) ì§„ì¶œ ë§¤ì§ë„˜ë²„ã€2025ë…„ ìµœì‹ ã€‘',
                'title-detailed-standings': 'NPB ìƒì„¸ ìˆœìœ„í‘œã€ìŠ¹ë¥ Â·ê²Œì„ì°¨Â·ë‚¨ì€ê²½ê¸°ìˆ˜ã€‘',
                'title-remaining-matrix': 'ë‚¨ì€ ê²½ê¸° ëŒ€ì „ ë§¤íŠ¸ë¦­ìŠ¤ã€íŒ€ë³„ ëŒ€ì „ ì˜ˆì •ã€‘',
                'title-progress': '2025ë…„ ì‹œì¦Œ ì§„í–‰ ìƒí™©ã€ì†Œí™”ê²½ê¸°ìˆ˜Â·ì§„í–‰ë¥ ã€‘',
                'title-scenarios': 'ê²½ë¡œì˜ ìˆ˜ï¼ˆê²½ìš°ì˜ ìˆ˜ï¼‰',
                
                // ë¦¬ê·¸ëª…
                'central-league': 'ì„¼íŠ¸ëŸ´ë¦¬ê·¸',
                'pacific-league': 'í¼ì‹œí”½ë¦¬ê·¸',
                'central-league-top3': 'ì„¼íŠ¸ëŸ´ë¦¬ê·¸ (ìƒìœ„ 3íŒ€)',
                'pacific-league-top3': 'í¼ì‹œí”½ë¦¬ê·¸ (ìƒìœ„ 3íŒ€)',
                
                // í…Œì´ë¸” í—¤ë”
                'rank': 'ìˆœìœ„',
                'team': 'íŒ€',
                'games-played': 'ê²½ê¸°',
                'wins': 'ìŠ¹',
                'losses': 'íŒ¨',
                'draws': 'ë¬´',
                'win-rate': 'ìŠ¹ë¥ ',
                'games-behind': 'ê²Œì„ì°¨',
                'remaining-games': 'ë‚¨ì€ê²½ê¸°',
                'max-wins': 'ìµœëŒ€ìŠ¹ìˆ˜',
                'first-place-condition': '1ìœ„ì¡°ê±´',
                'magic': 'ë§¤ì§',
                'eliminate': 'ì—˜ë¦¬ë¯¸ë„¤ì´íŠ¸',
                'playoff-status': 'ì§„ì¶œìƒí™©',
                'clinch': 'í´ë¦°ì¹˜',
                'runs-scored': 'ë“ì ',
                'runs-allowed': 'ì‹¤ì ',
                'run-differential': 'ë“ì‹¤ì ì°¨',
                
                // ë²„íŠ¼
                'today': 'ì˜¤ëŠ˜',
                'tomorrow': 'ë‚´ì¼',
                'matrix': 'ë§¤íŠ¸ë¦­ìŠ¤',
                'detailed': 'ìƒì„¸',
                'table': 'í•„ìš”ìŠ¹ìˆ˜í‘œ',
                
                // ë„ì›€ë§ ë° ì„¤ëª…
                'help-regular-magic': '<strong>ğŸ† ì •ê·œì‹œì¦Œ ìš°ìŠ¹ ë§¤ì§ë„˜ë²„</strong><br>ê° íŒ€ì´ ìš°ìŠ¹ì„ í™•ì •í•˜ê¸° ìœ„í•´ í•„ìš”í•œ ìµœì†Œ ìŠ¹ë¦¬ìˆ˜ì…ë‹ˆë‹¤. ë‹¤ë¥¸ íŒ€ì˜ ê²°ê³¼ì— ê´€ê³„ì—†ì´ ì´ ìˆ˜ë§Œí¼ ìŠ¹ë¦¬í•˜ë©´ ìš°ìŠ¹ì´ ê²°ì •ë©ë‹ˆë‹¤. ã€Œâœ“ã€ëŠ” ì´ë¯¸ ìš°ìŠ¹ì´ í™•ì •ë¨ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.',
                'help-playoff-magic': '<strong>ğŸ† í´ë¼ì´ë§¥ìŠ¤ ì‹œë¦¬ì¦ˆ (CS) ì§„ì¶œì— ëŒ€í•´</strong><br>ì„¼íŠ¸ëŸ´Â·í¼ì‹œí”½ë¦¬ê·¸ ëª¨ë‘ ìƒìœ„ 3íŒ€ì´ CS ì§„ì¶œ. 3ìœ„ ì´ë‚´ í™•ì •ì— í•„ìš”í•œ ìµœì†Œ ìŠ¹ë¦¬ìˆ˜ë¥¼ í‘œì‹œ. ìˆœìœ„ í™•ì •ì‹œ ã€Œâœ“ã€ë¡œ í‘œì‹œ.',
                'help-scenarios': '<strong>ğŸ“Š ì‹œë‚˜ë¦¬ì˜¤ ë¶„ì„ì— ëŒ€í•´</strong><br>ê° íŒ€ì´ íŠ¹ì • ìˆœìœ„ê°€ ë  ê°€ëŠ¥ì„±ì´ ìˆëŠ” ê²½ìš°ì˜ ìˆ˜ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤. ê³„ì‚°ì€ ë‚¨ì€ ê²½ê¸°ì˜ ëª¨ë“  íŒ¨í„´ì„ ê³ ë ¤í•©ë‹ˆë‹¤.',
                'help-standings': '<strong>ğŸ“‹ ìˆœìœ„í‘œì— ëŒ€í•´</strong><br>í˜„ì¬ ê° íŒ€ì˜ ì„±ì ê³¼ ìˆœìœ„ì…ë‹ˆë‹¤. ìŠ¹ë¥ ì€ ë¬´ìŠ¹ë¶€ë¥¼ ì œì™¸í•˜ê³  ê³„ì‚°ë©ë‹ˆë‹¤.',
                'help-remaining': '<strong>ğŸ—“ ë‚¨ì€ ê²½ê¸°ì— ëŒ€í•´</strong><br>ê° íŒ€ ê°„ì˜ ë‚¨ì€ ëŒ€ì „ìˆ˜ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤. ìˆ«ìëŠ” ë‚¨ì€ ëŒ€ì „ íšŸìˆ˜ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.',
                'help-progress': '<strong>ğŸ“ˆ ì§„í–‰ ìƒí™©ì— ëŒ€í•´</strong><br>ì‹œì¦Œ ì „ì²´ ë° ê° íŒ€ì˜ ì†Œí™” ê²½ê¸°ìˆ˜ì™€ ì§„í–‰ë¥ ì„ í‘œì‹œí•©ë‹ˆë‹¤.',
                
                // ìƒíƒœ ë©”ì‹œì§€
                'championship-decided': 'ìš°ìŠ¹ ê²°ì •',
                'playoff-secured': 'CS í™•ì •',
                'eliminated': 'ê¶Œì™¸ í™•ì •',
                'still-possible': 'ê°€ëŠ¥ì„± ìˆìŒ',
                
                // NPB íŒ€ëª… (í•œêµ­ì–´)
                'giants': 'ìš”ë¯¸ìš°ë¦¬ ìì´ì–¸ì¸ ',
                'tigers': 'í•œì‹  íƒ€ì´ê±°ìŠ¤',
                'dragons': 'ì£¼ë‹ˆì¹˜ ë“œë˜ê³¤ìŠ¤',
                'carp': 'íˆë¡œì‹œë§ˆ ë„ìš” ì¹´í”„',
                'swallows': 'ë„ì¿„ ì•¼ì¿ ë¥´íŠ¸ ìŠ¤ì™ˆë¡œì¦ˆ',
                'baystars': 'ìš”ì½”í•˜ë§ˆ DeNA ë² ì´ìŠ¤íƒ€ìŠ¤',
                'hawks': 'ì†Œí”„íŠ¸ë±…í¬ í˜¸í¬ìŠ¤',
                'eagles': 'í† í˜¸ì¿  ë¼ì¿ í… ê³¨ë“ ì´ê¸€ìŠ¤',
                'lions': 'ì‚¬ì´íƒ€ë§ˆ ì„¸ì´ë¶€ ë¼ì´ì˜¨ìŠ¤',
                'marines': 'ì¹˜ë°” ë¡¯ë° ë§ˆë¦°ìŠ¤',
                'fighters': 'í™‹ì¹´ì´ë„ ë‹›í°í–„ íŒŒì´í„°ìŠ¤',
                'buffaloes': 'ì˜¤ë¦­ìŠ¤ ë²„íŒ”ë¡œìŠ¤',
                
                // íŒ€ëª… ì¤„ì„ë§
                'giants-short': 'ìì´ì–¸ì¸ ',
                'tigers-short': 'íƒ€ì´ê±°ìŠ¤',
                'dragons-short': 'ë“œë˜ê³¤ìŠ¤',
                'carp-short': 'ì¹´í”„',
                'swallows-short': 'ìŠ¤ì™ˆë¡œì¦ˆ',
                'baystars-short': 'ë² ì´ìŠ¤íƒ€ìŠ¤',
                'hawks-short': 'í˜¸í¬ìŠ¤',
                'eagles-short': 'ì´ê¸€ìŠ¤',
                'lions-short': 'ë¼ì´ì˜¨ìŠ¤',
                'marines-short': 'ë§ˆë¦°ìŠ¤',
                'fighters-short': 'íŒŒì´í„°ìŠ¤',
                'buffaloes-short': 'ë²„íŒ”ë¡œìŠ¤',
                
                // ì¡°ê±´ ë©”ì‹œì§€
                'wins-needed': 'ìŠ¹ í•„ìš”',
                'championship-secured': 'ìš°ìŠ¹ í™•ì •',
                'playoff-advancement-secured': 'CS ì§„ì¶œ í™•ì •',
                'eliminated-short': 'E',
                'no-remaining-games': 'ë‚¨ì€ ê²½ê¸° ì—†ìŒ',
                
                // ì§„í–‰ ìƒí™© í…ìŠ¤íŠ¸
                'games-completed': 'ì™„ë£Œ',
                'games-remaining': 'ë‚¨ì€',
                'games-unit': 'ê²½ê¸°',
                'progress-gap': 'ê²½ê¸°ì°¨'
            },
            en: {
                // ë©”ì¸ í—¤ë”
                'main-title': 'NPB 2025 Season Standings Â· Magic Numbers Â· CS Playoff Probability',
                
                // ë„¤ë¹„ê²Œì´ì…˜ íƒ­
                'nav-magic-regular': 'Regular Season Magic',
                'nav-magic-playoff': 'Playoff Magic',
                'nav-scenarios': 'Path Count',
                'nav-standings': 'Team Standings',
                'nav-remaining': 'Remaining Games',
                'nav-progress': 'Season Progress',
                
                // ì„¹ì…˜ ì œëª©
                'title-regular-magic': '2025 Regular Season Championship Magic Numbersã€Centralãƒ»Pacific Leagueã€‘',
                'title-playoff-magic': 'Climax Series (CS) Advancement Magic Numbersã€2025 Latestã€‘',
                'title-detailed-standings': 'NPB Detailed Standingsã€Win Rateãƒ»Games Behindãƒ»Remaining Gamesã€‘',
                'title-remaining-matrix': 'Remaining Games Matrixã€Team vs Team Scheduleã€‘',
                'title-progress': '2025 Season Progressã€Games Playedãƒ»Progress Rateã€‘',
                'title-scenarios': 'Path Count (Number of Cases)',
                
                // ë¦¬ê·¸ëª…
                'central-league': 'Central League',
                'pacific-league': 'Pacific League',
                'central-league-top3': 'Central League (Top 3 Teams)',
                'pacific-league-top3': 'Pacific League (Top 3 Teams)',
                
                // í…Œì´ë¸” í—¤ë”
                'rank': 'Rank',
                'team': 'Team',
                'games-played': 'GP',
                'wins': 'W',
                'losses': 'L',
                'draws': 'T',
                'win-rate': 'PCT',
                'games-behind': 'GB',
                'remaining-games': 'Remaining',
                'max-wins': 'Max Wins',
                'first-place-condition': '1st Place Condition',
                'magic': 'Magic',
                'eliminate': 'Eliminate',
                'playoff-status': 'Playoff Status',
                'clinch': 'Clinch',
                'runs-scored': 'RS',
                'runs-allowed': 'RA',
                'run-differential': 'Diff',
                
                // ë²„íŠ¼
                'today': 'Today',
                'tomorrow': 'Tomorrow',
                'matrix': 'Matrix',
                'detailed': 'Detailed',
                'table': 'Win Requirements',
                
                // ë„ì›€ë§ ë° ì„¤ëª…
                'help-regular-magic': '<strong>ğŸ† Regular Season Championship Magic Numbers</strong><br>The minimum number of wins each team needs to secure the championship. Regardless of other teams\' results, winning this many games guarantees the championship. \"âœ“\" indicates championship already secured.',
                'help-playoff-magic': '<strong>ğŸ† About Climax Series (CS) Advancement</strong><br>Top 3 teams from both Central and Pacific leagues advance to CS. Shows minimum wins needed to secure top 3 position. \"âœ“\" indicates position already secured.',
                'help-scenarios': '<strong>ğŸ“Š About Scenario Analysis</strong><br>Shows the number of possible cases where each team can finish at specific rankings. Calculations consider all possible patterns of remaining games.',
                'help-standings': '<strong>ğŸ“‹ About Standings</strong><br>Current performance and rankings of each team. Win percentage is calculated excluding ties.',
                'help-remaining': '<strong>ğŸ—“ About Remaining Games</strong><br>Shows remaining matchups between each team. Numbers indicate remaining games to be played.',
                'help-progress': '<strong>ğŸ“ˆ About Season Progress</strong><br>Shows games played and progress rate for the entire season and each team.',
                
                // ìƒíƒœ ë©”ì‹œì§€
                'championship-decided': 'Championship Decided',
                'playoff-secured': 'CS Secured',
                'eliminated': 'Eliminated',
                'still-possible': 'Still Possible',
                
                // NPB íŒ€ëª… (ì˜ì–´)
                'giants': 'Yomiuri Giants',
                'tigers': 'Hanshin Tigers',
                'dragons': 'Chunichi Dragons',
                'carp': 'Hiroshima Toyo Carp',
                'swallows': 'Tokyo Yakult Swallows',
                'baystars': 'Yokohama DeNA BayStars',
                'hawks': 'SoftBank Hawks',
                'eagles': 'Tohoku Rakuten Golden Eagles',
                'lions': 'Saitama Seibu Lions',
                'marines': 'Chiba Lotte Marines',
                'fighters': 'Hokkaido Nippon-Ham Fighters',
                'buffaloes': 'Orix Buffaloes',
                
                // íŒ€ëª… ì¤„ì„ë§
                'giants-short': 'Giants',
                'tigers-short': 'Tigers',
                'dragons-short': 'Dragons',
                'carp-short': 'Carp',
                'swallows-short': 'Swallows',
                'baystars-short': 'BayStars',
                'hawks-short': 'Hawks',
                'eagles-short': 'Eagles',
                'lions-short': 'Lions',
                'marines-short': 'Marines',
                'fighters-short': 'Fighters',
                'buffaloes-short': 'Buffaloes',
                
                // ì¡°ê±´ ë©”ì‹œì§€
                'wins-needed': 'Wins Needed',
                'championship-secured': 'Championship Secured',
                'playoff-advancement-secured': 'CS Secured',
                'eliminated-short': 'E',
                'no-remaining-games': 'No Games Left',
                
                // ì§„í–‰ ìƒí™© í…ìŠ¤íŠ¸
                'games-completed': 'Completed',
                'games-remaining': 'Remaining',
                'games-unit': 'Games',
                'progress-gap': 'Games Gap'
            }
        };

        // ===== ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•° =====
        let standingsData = null;      // é †ä½è¡¨ãƒ‡ãƒ¼ã‚¿
        let seasonConfig = null;       // ã‚·ãƒ¼ã‚ºãƒ³è¨­å®šãƒ‡ãƒ¼ã‚¿  
        let gamesData = null;          // å…¨è©¦åˆï¼ˆå®Œäº†åˆ†ï¼‰ãƒ‡ãƒ¼ã‚¿
        let lastTenRecordsByTeam = {}; // ãƒãƒ¼ãƒ åˆ¥ç›´è¿‘10è©¦åˆæˆç¸¾
        let upcomingGamesData = null;  // æ®‹ã‚Šè©¦åˆãƒ‡ãƒ¼ã‚¿
        let homeAwayRemainingByTeam = {}; // { team_id: { home: n, away: n, opponents: {} } }
        let TOTAL_GAMES = 143;         // NPB æ­£è¦ã‚·ãƒ¼ã‚ºãƒ³: 1ãƒãƒ¼ãƒ 143è©¦åˆ

        // ê¸°ì¡´ ë°ì´í„° í˜•ì‹ì„ ìƒˆ ê³„ì‚° í•¨ìˆ˜ìš©ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” í—¬í¼
        function convertTeamDataForMagic(teams) {
            return teams.map(team => ({
                id: team.team_id || team.team_name,
                W: team.wins,
                L: team.losses,
                T: team.draws || 0
            }));
        }

        // ===== NPB ë§¤ì§/íŠ¸ë˜ì§ ë„˜ë²„ ê³„ì‚° ê³µí†µ ìœ í‹¸ í•¨ìˆ˜ë“¤ =====
        function calcR(team, season=143) {
            return season - (team.W + team.L + team.T);
        }
        function winPct(team, R) { // í˜„ì¬ ìŠ¹ë¥ 
            const denom = team.W + team.L;
            return denom > 0 ? team.W / denom : 0;
        }
        function pMax(team, R) { // ë‚¨ì€ ì „ìŠ¹
            const denom = team.W + team.L + R;
            return denom > 0 ? (team.W + R) / denom : 0;
        }
        function pMin(team, R) { // ë‚¨ì€ ì „íŒ¨
            const denom = team.W + team.L + R;
            return denom > 0 ? (team.W) / denom : 0;
        }
        function clamp(v, lo, hi) { return Math.max(lo, Math.min(hi, v)); }
        function round3(x){ return Number(x.toFixed(3)); }

        // ===== NPB ì •ê·œì‹œì¦Œ ë§¤ì§/íŠ¸ë˜ì§ ê³„ì‚° ë¼ì´ë¸ŒëŸ¬ë¦¬ =====
        // í˜„ì¬ ìˆœìœ„í‘œ(ìŠ¹ë¥  ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ). ë¬´ìŠ¹ë¶€ëŠ” ë¶„ëª¨ ì œì™¸
        function sortStandings(teams, season=143) {
            return [...teams].map(t => {
                const R = calcR(t, season);
                return { ...t, R, winPct: winPct(t, R) };
            }).sort((a,b)=> b.winPct - a.winPct);
        }

        // ëª¨ë“œ 1) ê³µì‹ ë°©ì‹: í˜„ì¬ 1ìœ„ vs í˜„ì¬ 2ìœ„
        function officialLeaderMagicTragic(teams, season=143) {
            const table = sortStandings(teams, season);
            const leader = table[0];
            const runner = table[1];

            const R1 = leader.R;
            const D1 = leader.W + leader.L + R1;          // ìµœì¢… ë¶„ëª¨(ë¬´ìŠ¹ë¶€ ì œì™¸)
            const R2 = runner.R;
            const D2 = runner.W + runner.L + R2;

            // 1ìœ„ í™•ì •(ë§¤ì§): (W1 + x) / D1  >  (W2 + R2) / D2  (strict) / â‰¥ (tieOK)
            const K1_official = (runner.W + R2) / D2;      // 2ìœ„ì˜ ìµœëŒ€ ê°€ëŠ¥ ìŠ¹ë¥ 
            const needWins_rhs = K1_official * D1 - leader.W;
            const x_strict = Math.max(0, Math.floor(needWins_rhs) + 1);
            const x_tieOK  = Math.max(0, Math.ceil(needWins_rhs));
            const x_strict_c = clamp(x_strict, 0, R1);
            const x_tieOK_c  = clamp(x_tieOK,  0, R1);

            // 1ìœ„ íƒˆë½(íŠ¸ë˜ì§): (W1 + R1 - y) / D1  â‰¤  (W2) / D2  (strict) / < (tieOK)
            const K1min_official = (runner.W) / D2;        // 2ìœ„ì˜ ìµœì†Œ ê°€ëŠ¥ ìŠ¹ë¥ 
            const lose_rhs = leader.W + R1 - K1min_official * D1;
            const y_strict = Math.max(0, Math.ceil(lose_rhs));
            const y_tieOK  = Math.max(0, Math.floor(lose_rhs) + 1);
            const y_strict_c = clamp(y_strict, 0, R1);
            const y_tieOK_c  = clamp(y_tieOK,  0, R1);

            return {
                leader: { id: leader.id, W: leader.W, L: leader.L, T: leader.T, R: leader.R, winPct: round3(leader.winPct) },
                runnerUp: { id: runner.id, W: runner.W, L: runner.L, T: runner.T, R: runner.R, winPct: round3(runner.winPct) },
                K1_official: round3(K1_official),
                K1min_official: round3(K1min_official),
                x_strict: x_strict_c,   // ë™ë¥  ë¶ˆí—ˆ
                x_tieOK:  x_tieOK_c,    // ë™ë¥  í—ˆìš©
                y_strict: y_strict_c,   // ë™ë¥  ë¶ˆí—ˆ
                y_tieOK:  y_tieOK_c     // ë™ë¥  í—ˆìš©
            };
        }

        // ëª¨ë“œ 2) ë³´ìˆ˜ ë°©ì‹: ì „ íŒ€ ê¸°ì¤€(ìµœëŒ“/ìµœì†Ÿ ìŠ¹ë¥ )
        function conservativeAllTeamsMagicTragic(teams, season=143) {
            return teams.map(t => {
                const Ri = calcR(t, season);
                const Di = t.W + t.L + Ri;

                // ë‹¤ë¥¸ íŒ€ë“¤ì˜ ìµœëŒ€ ê°€ëŠ¥ ìŠ¹ë¥ ì˜ ìµœëŒ“ê°’ (ë‚´ê°€ ë„˜ì–´ì•¼ í•  ê¸°ì¤€)
                let K1_max = 0;
                // ë‹¤ë¥¸ íŒ€ë“¤ì˜ ìµœì†Œ ê°€ëŠ¥ ìŠ¹ë¥ ì˜ ìµœëŒ“ê°’ (ë‚´ê°€ ëª» ë¯¸ì¹˜ë©´ íƒˆë½ ë³´ì¥)
                let K1_min = 0;

                for (const u of teams) {
                    if (u.id === t.id) continue;
                    const Ru = calcR(u, season);
                    K1_max = Math.max(K1_max, pMax(u, Ru));
                    K1_min = Math.max(K1_min, pMin(u, Ru));
                }

                // ë§¤ì§ë„˜ë²„(1ìœ„ í™•ì •): (Wi + x)/Di > K1_max (strict) / â‰¥ (tieOK)
                const needWins_rhs = K1_max * Di - t.W;
                const x_strict = Math.max(0, Math.floor(needWins_rhs) + 1);
                const x_tieOK  = Math.max(0, Math.ceil(needWins_rhs));

                // íŠ¸ë˜ì§ë„˜ë²„(1ìœ„ íƒˆë½): (Wi + Ri - y)/Di â‰¤ K1_min (strict) / < (tieOK)
                const lose_rhs = t.W + Ri - K1_min * Di;
                const y_strict = Math.max(0, Math.ceil(lose_rhs));
                const y_tieOK  = Math.max(0, Math.floor(lose_rhs) + 1);

                return {
                    team: t.id,
                    W: t.W, L: t.L, T: t.T, R: Ri,
                    winPct: round3(winPct(t, Ri)),
                    K1_max: round3(K1_max),
                    K1_min: round3(K1_min),
                    x_strict: clamp(x_strict, 0, Ri),
                    x_tieOK:  clamp(x_tieOK,  0, Ri),
                    y_strict: clamp(y_strict, 0, Ri),
                    y_tieOK:  clamp(y_tieOK,  0, Ri)
                };
            });
        }

        // í†µí•© ì—”íŠ¸ë¦¬ í•¨ìˆ˜
        function npbRank1MagicTragic(teams, season=143) {
            const official = officialLeaderMagicTragic(teams, season);     // í˜„ì¬ 1ìœ„ ì „ìš©(2ìœ„ë§Œ ë¹„êµ)
            const conservative = conservativeAllTeamsMagicTragic(teams, season); // ì „ íŒ€ ë³´ìˆ˜ ê³„ì‚°
            const leaderInfo = sortStandings(teams, season)[0];
            return {
                leader: { id: leaderInfo.id, W: leaderInfo.W, L: leaderInfo.L, T: leaderInfo.T, R: leaderInfo.R, winPct: round3(leaderInfo.winPct) },
                official: { onlyLeader: official },
                conservative: { rows: conservative }
            };
        }

        // ===== NPB í”„ë ˆì´ì˜¤í”„(ìƒìœ„ 3ìœ„) ë§¤ì§/íŠ¸ë˜ì§ ê³„ì‚° ë¼ì´ë¸ŒëŸ¬ë¦¬ =====
        function pNow(team) { // í˜„ì¬ ìŠ¹ë¥  (ë¬´ìŠ¹ë¶€ ì œì™¸)
            const denom = team.W + team.L;
            return denom > 0 ? team.W / denom : 0;
        }

        function kthLargest(arr, k) {
            if (!arr.length || k < 1) return 0;
            const sorted = [...arr].sort((a, b) => b - a);
            return sorted[k - 1] ?? 0;
        }

        function kBenchmarksForTeam(i, teams, season, k) {
            const maxList = [];
            const minList = [];
            for (const t of teams) {
                if (t.id === i.id) continue;
                const R = calcR(t, season);
                maxList.push(pMax(t, R));
                minList.push(pMin(t, R));
            }
            return {
                Kk_max: kthLargest(maxList, k),
                Kk_min: kthLargest(minList, k)
            };
        }

        function magicTragicForK(team, season, k, Kk_max, Kk_min) {
            const Ri = calcR(team, season);
            const Di = team.W + team.L + Ri;

            // Magic (í™•ì •)
            const rhsMagic = Kk_max * Di - team.W;
            const x_strict = Math.max(0, Math.floor(rhsMagic) + 1); // >
            const x_tieOK  = Math.max(0, Math.ceil(rhsMagic));      // â‰¥

            // Tragic (íƒˆë½)
            const rhsTr = team.W + Ri - Kk_min * Di;
            const y_strict = Math.max(0, Math.ceil(rhsTr));         // â‰¤
            const y_tieOK  = Math.max(0, Math.floor(rhsTr) + 1);    // <

            return {
                R: Ri,
                x_strict: clamp(x_strict, 0, Ri),
                x_tieOK:  clamp(x_tieOK,  0, Ri),
                y_strict: clamp(y_strict, 0, Ri),
                y_tieOK:  clamp(y_tieOK,  0, Ri)
            };
        }

        function npbPlayoffMagicTragic(teams, season = 143, ks = [1, 2, 3]) {
            return teams.map(team => {
                const Ri = calcR(team, season);
                const row = {
                    team: team.id,
                    W: team.W, L: team.L, T: team.T, R: Ri,
                    winPct: round3(pNow(team))
                };

                for (const k of ks) {
                    const { Kk_max, Kk_min } = kBenchmarksForTeam(team, teams, season, k);
                    const res = magicTragicForK(team, season, k, Kk_max, Kk_min);
                    row[`K${k}_max`] = round3(Kk_max);
                    row[`K${k}_min`] = round3(Kk_min);
                    row[`x${k}_strict`] = res.x_strict;
                    row[`x${k}_tieOK`]  = res.x_tieOK;
                    row[`y${k}_strict`] = res.y_strict;
                    row[`y${k}_tieOK`]  = res.y_tieOK;
                }
                return row;
            });
        }

        // ===== ãƒãƒ¼ãƒ ãƒ­ã‚´ï¼ˆç•¥ç§°â†’ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ï¼‰ =====
        const TEAM_LOGOS = {
            YOG: 'assets/npb-logos/svg/yomiuri-giants.svg',
            HAN: 'assets/npb-logos/svg/hanshin-tigers.svg',
            CHU: 'assets/npb-logos/svg/chunichi-dragons.svg',
            HIR: 'assets/npb-logos/svg/hiroshima-toyo-carp.svg',
            YDB: 'assets/npb-logos/svg/yokohama-dena-baystars.svg',
            YAK: 'assets/npb-logos/svg/tokyo-yakult-swallows.svg',
            SOF: 'assets/npb-logos/svg/fukuoka-softbank-hawks.svg',
            LOT: 'assets/npb-logos/svg/chiba-lotte-marines.svg',
            SEI: 'assets/npb-logos/svg/saitama-seibu-lions.svg',
            ORI: 'assets/npb-logos/svg/orix-buffaloes.svg',
            NIP: 'assets/npb-logos/svg/hokkaido-nippon-ham-fighters.svg',
            RAK: 'assets/npb-logos/svg/tohoku-rakuten-golden-eagles.svg'
        };

        function renderTeamLabel(abbr, name, shortName = false) {
            const src = TEAM_LOGOS[abbr] || '';
            let safeName = name || abbr || '';
            
            // íŒ€ëª… ë²ˆì—­ ì ìš©
            safeName = translateTeamName(safeName, shortName);
            
            const img = src ? `<img class="team-logo" src="${src}" alt="${safeName}" loading="lazy">` : '';
            return `${img}${safeName}`;
        }

        // ===== ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½ =====
        function showTab(tabId, el) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
                tab.setAttribute('aria-hidden', 'true');
            });

            // Reset all nav buttons
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
                tab.setAttribute('aria-selected', 'false');
            });

            // Show selected tab
            const selectedTab = document.getElementById(tabId);
            if (!selectedTab) {
                return;
            }
            selectedTab.classList.add('active');
            selectedTab.setAttribute('aria-hidden', 'false');

            // Activate nav button
            if (el) {
                el.classList.add('active');
                el.setAttribute('aria-selected', 'true');
            } else {
                // If no element provided, find and activate the correct nav button
                document.querySelectorAll('.nav-tab').forEach(tab => {
                    if (tab.getAttribute('onclick') && tab.getAttribute('onclick').includes(`'${tabId}'`)) {
                        tab.classList.add('active');
                        tab.setAttribute('aria-selected', 'true');
                    }
                });
            }

            // Update URL hash without triggering default jump
            const hash = `#${tabId}`;
            if (window.history && window.history.replaceState) {
                window.history.replaceState(null, '', hash);
            } else {
                window.location.hash = tabId;
            }

            // Ensure newly shown tab content is aligned below the fixed header
            requestAnimationFrame(() => {
                selectedTab.scrollIntoView({ behavior: 'smooth', block: 'start' });
            });

            // Refresh AdSense ads in the newly visible tab
            setTimeout(() => {
                try {
                    const activeTab = document.querySelector('.tab-content.active');
                    if (activeTab) {
                        const ads = activeTab.querySelectorAll('.adsbygoogle');
                        ads.forEach(ad => {
                            // If the ad slot is empty (no iframe) and it's visible
                            if (ad.offsetParent !== null && ad.innerHTML.trim() === '') {
                                // Clear any previous state attributes
                                ad.removeAttribute('data-ad-status');
                                ad.removeAttribute('data-adsbygoogle-status');
                                ad.removeAttribute('style'); // Reset style in case AdSense added display:none
                                ad.style.display = 'block';
                                ad.style.minWidth = '300px';
                                
                                // Re-initialize the ad
                                (adsbygoogle = window.adsbygoogle || []).push({});
                            }
                        });
                    }
                } catch (e) {
                    console.error('AdSense refresh error in showTab:', e);
                }
            }, 150); // Increased delay slightly
        }

        // Safe ad initialization function
        function initializeAdsAfterLoad() {
            try {
                setTimeout(() => {
                    document.querySelectorAll('.adsbygoogle').forEach(ad => {
                        if (ad.offsetParent !== null && ad.innerHTML.trim() === '') {
                            (adsbygoogle = window.adsbygoogle || []).push({});
                        }
                    });
                }, 250); 
            } catch (e) {
                console.error('AdSense initialization error:', e);
            }
        }


        // ===== æ­£è¦ã‚·ãƒ¼ã‚ºãƒ³å„ªå‹ãƒã‚¸ãƒƒã‚¯æ›´æ–° =====
        function updateMagicRegular() {
            updateMagicTable('central-magic-regular', standingsData.central_league?.standings || [], true);
            updateMagicTable('pacific-magic-regular', standingsData.pacific_league?.standings || [], true);
        }

        // ===== ãƒã‚¹ãƒˆã‚·ãƒ¼ã‚ºãƒ³ãƒã‚¸ãƒƒã‚¯æ›´æ–° =====
        function updateMagicPlayoff() {
            updateMagicTable('central-magic-playoff', standingsData.central_league?.standings || [], false);
            updateMagicTable('pacific-magic-playoff', standingsData.pacific_league?.standings || [], false);
        }

        // ===== ãƒã‚¸ãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–°ï¼ˆå…±é€šé–¢æ•°ï¼‰ =====
        function updateMagicTable(id, teams, isRegular) {
            const tbody = document.getElementById(id);
            if (!teams.length) {
                tbody.innerHTML = '<tr><td colspan="13" class="loading">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>';
                return;
            }

            // ë§¤ì§ë„˜ë²„ ê³„ì‚°ì„ ìœ„í•œ ë°ì´í„° ì¤€ë¹„
            let magicResults = null;
            let useConservativeMode = false;
            let allowTies = true;
            
            if (isRegular) {
                // ì •ê·œì‹œì¦Œ: ìƒˆë¡œìš´ ë§¤ì§/íŠ¸ë˜ì§ ê³„ì‚° ë¡œì§ ì‚¬ìš©
                const convertedTeams = convertTeamDataForMagic(teams);
                magicResults = npbRank1MagicTragic(convertedTeams, TOTAL_GAMES);
                
                // UI í‘œì‹œ ëª¨ë“œ ì„¤ì • (ë¼ë””ì˜¤ ë²„íŠ¼ì—ì„œ ì½ì–´ì˜´)
                useConservativeMode = document.querySelector('input[name="magic-mode"]:checked')?.value === 'conservative' || false;
                allowTies = document.querySelector('input[name="tie-mode"]:checked')?.value === 'allow' || true;
            }

            const leader = teams[0];
            const thirdPlace = teams[2] || {};
            
            tbody.innerHTML = teams.map(team => {
                const rankClass = team.position_rank === 1 ? 'rank1' :
                                 team.position_rank === 2 ? 'rank2' :
                                 team.position_rank === 3 ? 'rank3' : '';

                const remainingGames = TOTAL_GAMES - team.games_played;
                const maxWins = team.wins + remainingGames;
                let magic = '-';
                let clinch = '-';
                let csConfirmed = '-';  // í”Œë ˆì´ì˜¤í”„ìš© CSí™•ì • ë³€ìˆ˜
                let eliminate = '-';
                let condition = '-';
                
                if (isRegular) {
                    // æ­£è¦ã‚·ãƒ¼ã‚ºãƒ³å„ªå‹ãƒã‚¸ãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼è¨ˆç®—
                    if (team.position_rank === 1) {
                        const secondPlace = teams[1];
                        if (secondPlace && remainingGames > 0) {
                            // ãƒã‚¸ãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼ = ï¼ˆ2ä½ãƒãƒ¼ãƒ ã®æœ€å¤§å¯èƒ½å‹æ•°ï¼‰ - ï¼ˆ1ä½ãƒãƒ¼ãƒ ã®ç¾åœ¨å‹æ•°ï¼‰ + 1
                            const secondPlaceRemaining = TOTAL_GAMES - secondPlace.games_played;
                            const secondPlaceMaxWins = secondPlace.wins + secondPlaceRemaining;
                            const magicNumber = secondPlaceMaxWins - team.wins + 1;
                            
                            if (magicNumber <= 0) {
                                magic = 'âœ“'; // å„ªå‹ç¢ºå®šæ¸ˆ
                                clinch = 'å„ªå‹';
                                condition = 'ç¢ºå®š';
                            } else {
                                magic = magicNumber;
                                condition = `${magicNumber}å‹å¿…è¦`;
                            }
                        } else if (remainingGames === 0) {
                            magic = 'âœ“'; // ã‚·ãƒ¼ã‚ºãƒ³çµ‚äº†
                            clinch = 'ç¢ºå®š';
                            condition = 'ç¢ºå®š';
                        }
                    } else {
                        // 2ä½ä»¥ä¸‹ãƒãƒ¼ãƒ ã®å„ªå‹æ¡ä»¶: 1ä½ãƒãƒ¼ãƒ ãŒä½•å‹ä»¥ä¸‹ã§çµ‚ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹ã‹
                        const teamMaxWins = team.wins + remainingGames;
                        const leaderCurrentWins = leader.wins;
                        const leaderRemaining = TOTAL_GAMES - leader.games_played;
                        
                        if (teamMaxWins <= leaderCurrentWins) {
                            condition = 'ä¸å¯èƒ½';
                        } else {
                            // ã“ã®ãƒãƒ¼ãƒ ãŒ1ä½ã«ãªã‚‹ãŸã‚ã«1ä½ãƒãƒ¼ãƒ ãŒæœ€å¤§ä½•å‹ã¾ã§ã«æŠ‘ãˆã‚‹å¿…è¦ãŒã‚ã‚‹ã‹
                            const leaderMaxAllowed = teamMaxWins - 1;
                            if (leaderMaxAllowed < leaderCurrentWins) {
                                condition = 'ä¸å¯èƒ½';
                            } else {
                                condition = `1ä½${leaderMaxAllowed}å‹ä»¥ä¸‹`;
                            }
                        }
                    }
                    
                    // ìƒˆë¡œìš´ íŠ¸ë˜ì§ë„˜ë²„ ê³„ì‚° (ì œê³µë°›ì€ ë¡œì§ ì‚¬ìš©)
                    if (team.position_rank === 1) {
                        // 1ìœ„íŒ€ì€ ìš°ìŠ¹ íƒˆë½ì´ ì—†ìœ¼ë¯€ë¡œ ì—˜ë¦¬ë¯¸ë„¤ì´ì…˜ í‘œì‹œ ì•ˆí•¨
                        eliminate = '-';
                    } else {
                        // 2ìœ„ ì´í•˜ íŒ€ë“¤ì˜ ìš°ìŠ¹ íƒˆë½ ê³„ì‚°
                        if (useConservativeMode) {
                            const teamResult = magicResults.conservative.rows.find(r => r.team === (team.team_id || team.team_name));
                            if (teamResult) {
                                const tragicValue = allowTies ? teamResult.y_tieOK : teamResult.y_strict;
                                eliminate = tragicValue === 0 ? 'E' : (tragicValue >= teamResult.R ? 'E' : tragicValue);
                            }
                        } else {
                            // ê¸°ì¡´ MLB ìŠ¤íƒ€ì¼ ê³„ì‚° ìœ ì§€ (í•˜ìœ„ í˜¸í™˜ì„±)
                            const teamMaxWins = team.wins + remainingGames;
                            const alreadyEliminated = leader.wins > teamMaxWins;
                            if (alreadyEliminated) {
                                eliminate = 'E';
                            } else {
                                const combo = (TOTAL_GAMES + 1) - leader.wins - team.losses;
                                eliminate = combo <= 0 ? 'E' : combo;
                            }
                        }
                    }
                } else {
                    // ìƒˆë¡œìš´ í”„ë ˆì´ì˜¤í”„ ë§¤ì§/íŠ¸ë˜ì§ ê³„ì‚° ë¡œì§ ì‚¬ìš©
                    const convertedTeams = convertTeamDataForMagic(teams);
                    const playoffResults = npbPlayoffMagicTragic(convertedTeams, TOTAL_GAMES, [1, 2, 3]);
                    
                    // í˜„ì¬ íŒ€ì˜ ê²°ê³¼ ì°¾ê¸°
                    const teamResult = playoffResults.find(r => r.team === (team.team_id || team.team_name));
                    
                    if (teamResult) {
                        // ë‹¨ìˆœí•˜ê²Œ ê³„ì‚° ê²°ê³¼ë§Œ í‘œê¸°
                        const x3_magic = teamResult.x3_tieOK; // 3ìœ„ í™•ì • ë§¤ì§ë„˜ë²„
                        const x2_magic = teamResult.x2_tieOK; // 2ìœ„ í™•ì • ë§¤ì§ë„˜ë²„  
                        const x1_magic = teamResult.x1_tieOK; // 1ìœ„ í™•ì • ë§¤ì§ë„˜ë²„
                        
                        // ë§¤ì§ë„˜ë²„ í‘œì‹œ
                        if (x3_magic === 0) {
                            clinch = 'âœ“';
                        } else {
                            clinch = x3_magic;
                        }
                        
                        // ã‚¯ãƒ©ã‚¤ãƒãƒƒã‚¯ã‚¹ã‚·ãƒªãƒ¼ã‚ºé€²å‡ºçŠ¶æ…‹è¡¨ç¤º
                        if (x1_magic === 0) {
                            csConfirmed = 'ãƒ•ã‚¡ã‚¤ãƒŠãƒ«ç›´è¡Œ';
                            condition = 'ãƒ•ã‚¡ã‚¤ãƒŠãƒ«ç›´è¡Œ';
                        } else if (x2_magic === 0) {
                            csConfirmed = 'ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã‚¹ãƒ†ãƒ¼ã‚¸';
                            condition = 'ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã‚¹ãƒ†ãƒ¼ã‚¸';
                        } else if (x3_magic === 0) {
                            csConfirmed = 'ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã‚¹ãƒ†ãƒ¼ã‚¸';
                            condition = 'ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã‚¹ãƒ†ãƒ¼ã‚¸';
                        } else {
                            condition = `CSé€²å‡ºã¾ã§${x3_magic}å‹`;
                        }
                    }
                    
                    // (ê¸°ì¡´ CS í™•ì • íŒì • ë¡œì§ ì œê±°ë¨ - ìƒˆë¡œìš´ ë¡œì§ì´ ì´ë¯¸ ì²˜ë¦¬)
                    
                    // ì—˜ë¦¬ë¯¸ë„¤ì´ì…˜ ê³„ì‚° (ë‹¨ìˆœí•˜ê²Œ)
                    if (teamResult) {
                        const y3_tragic = teamResult.y3_tieOK; // 3ìœ„ íƒˆë½ íŠ¸ë˜ì§ë„˜ë²„
                        if (y3_tragic === 0) {
                            eliminate = 'E';
                        } else {
                            eliminate = y3_tragic;
                        }
                    }
                }
                
                const eliminatedRow = eliminate === 'E' || eliminate === 0 || eliminate === '0';
                const rowClassNames = [rankClass];
                if (eliminatedRow) rowClassNames.push('row-eliminated');
                const rowClassAttr = rowClassNames.filter(Boolean).join(' ');

                if (isRegular) {
                    // ì •ê·œì‹œì¦Œ: é †ä½ ãƒãƒ¼ãƒ  å‹ æ•— åˆ† å‹ç‡ ã‚²ãƒ¼ãƒ å·® æ®‹ã‚Šè©¦åˆ æœ€å¤§å‹ 1ä½æ¡ä»¶ ãƒã‚¸ãƒƒã‚¯ ã‚¨ãƒªãƒŸãƒãƒ¼ãƒˆ é€²ì¶œçŠ¶æ³
                    const firstPlaceBorder = team.position_rank === 1 ? 'style="border: 3px solid #FF0000;"' : '';
                    return `
                        <tr class="${rowClassAttr}" ${firstPlaceBorder}>
                            <td class="center">${team.position_rank}</td>
                            <td>${renderTeamLabel(team.team_abbreviation, team.team_name)}</td>
                            <td class="center">${team.games_played}</td>
                            <td class="center win">${team.wins}</td>
                            <td class="center loss">${team.losses}</td>
                            <td class="center">${team.draws || 0}</td>
                            <td class="center pct">0.${team.win_percentage.toFixed(3).split('.')[1]}</td>
                            <td class="center">${team.games_behind > 0 ? team.games_behind.toFixed(1) : '-'}</td>
                            <td class="center">${remainingGames}</td>
                            <td class="center">${maxWins}</td>
                            <td class="center" style="font-size: 12px;">${translateCondition(condition)}</td>
                            <td class="center ${magic === 'âœ“' ? 'clinched' : 'magic-number'}">${magic}</td>
                            <td class="center ${eliminate === 'E' ? 'eliminated' : ''}">${eliminate}</td>
                            <td class="center ${clinch !== '-' ? 'clinched' : ''}" style="font-size: 12px;">${clinch}</td>
                        </tr>
                    `;
                } else {
                    // í”Œë ˆì´ì˜¤í”„: é †ä½ ãƒãƒ¼ãƒ  å‹ æ•— åˆ† å‹ç‡ ã‚²ãƒ¼ãƒ å·® æ®‹ã‚Šè©¦åˆ æœ€å¤§å‹ 3ìœ„æ¡ä»¶ ãƒã‚¸ãƒƒã‚¯ ã‚¨ãƒªãƒŸãƒãƒ¼ãƒˆ é€²å‡ºçŠ¶æ³
                    let playoffBorder = '';
                    // 1-3ìœ„ ê·¸ë£¹ ë°•ìŠ¤ë¥¼ ìœ„í•œ í…Œë‘ë¦¬ ì„¤ì •
                    if (team.position_rank === 1) {
                        playoffBorder = 'style="border: 3px solid #FF0000; border-bottom: none;"'; // ì²« ë²ˆì§¸ í–‰: ìœ„,ì¢Œ,ìš° í…Œë‘ë¦¬
                    } else if (team.position_rank === 2) {
                        playoffBorder = 'style="border-left: 3px solid #FF0000; border-right: 3px solid #FF0000;"'; // ì¤‘ê°„ í–‰: ì¢Œ,ìš° í…Œë‘ë¦¬
                    } else if (team.position_rank === 3) {
                        playoffBorder = 'style="border: 3px solid #FF0000; border-top: none;"'; // ë§ˆì§€ë§‰ í–‰: ì•„ë˜,ì¢Œ,ìš° í…Œë‘ë¦¬
                    }

                    return `
                        <tr class="${rowClassAttr}" ${playoffBorder}>
                            <td class="center">${team.position_rank}</td>
                            <td>${renderTeamLabel(team.team_abbreviation, team.team_name)}</td>
                            <td class="center">${team.games_played}</td>
                            <td class="center win">${team.wins}</td>
                            <td class="center loss">${team.losses}</td>
                            <td class="center">${team.draws || 0}</td>
                            <td class="center pct">0.${team.win_percentage.toFixed(3).split('.')[1]}</td>
                            <td class="center">${team.games_behind > 0 ? team.games_behind.toFixed(1) : '-'}</td>
                            <td class="center">${remainingGames}</td>
                            <td class="center">${maxWins}</td>
                            <td class="center ${clinch === 'âœ“' ? 'clinched' : 'magic-number'}">${clinch}</td>
                            <td class="center ${eliminate === 'E' ? 'eliminated' : ''}">${eliminate}</td>
                            <td class="center ${csConfirmed !== '-' ? 'clinched' : ''}" style="font-size: 12px;">${csConfirmed}</td>
                        </tr>
                    `;
                }
            }).join('');
        }

        // ===== è©³ç´°é †ä½è¡¨æ›´æ–° =====
        function updateDetailedStandings() {
            updateDetailedTable('central-detailed', standingsData.central_league?.standings || []);
            updateDetailedTable('pacific-detailed', standingsData.pacific_league?.standings || []);
        }

        // ===== è©³ç´°é †ä½ãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–°ï¼ˆå…±é€šé–¢æ•°ï¼‰ =====
        function updateDetailedTable(id, teams) {
            const tbody = document.getElementById(id);
            if (!teams.length) {
                tbody.innerHTML = '<tr><td colspan="17" class="loading">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>';
                return;
            }

            tbody.innerHTML = teams.map(team => {
                const rankClass = team.position_rank === 1 ? 'rank1' : 
                                 team.position_rank === 2 ? 'rank2' : 
                                 team.position_rank === 3 ? 'rank3' : '';
                
                const remainingGames = TOTAL_GAMES - team.games_played;
                const lastTenInfo = lastTenRecordsByTeam[String(team.team_id)] || null;
                const lastTenDisplay = (lastTenInfo && lastTenInfo.games > 0) ? lastTenInfo.record : 'â€”';
                const streakInfo = lastTenInfo?.streak || { type: 'none', count: 0 };
                let streakDisplay = 'â€”';
                let streakClass = '';
                if (streakInfo.type === 'win' && streakInfo.count > 0) {
                    streakDisplay = `${streakInfo.count}é€£å‹`;
                    streakClass = 'streak-win';
                } else if (streakInfo.type === 'loss' && streakInfo.count > 0) {
                    streakDisplay = `${streakInfo.count}é€£æ•—`;
                    streakClass = 'streak-loss';
                } else if (streakInfo.type === 'draw' && streakInfo.count > 0) {
                    streakDisplay = `${streakInfo.count}åˆ†`;
                    streakClass = 'streak-draw';
                }
                
                // ãƒ›ãƒ¼ãƒ /ã‚¢ã‚¦ã‚§ã‚¤åˆ†å‰²ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆï¼ˆå®Ÿãƒ‡ãƒ¼ã‚¿ãªã—ã®å ´åˆã®ä»®è¨ˆç®—ï¼‰
                const homeAdvantage = seasonConfig?.display_config?.home_advantage || 0.55;
                const homeGames = Math.floor(team.games_played / 2);
                const awayGames = team.games_played - homeGames;
                const homeWins = Math.floor(team.wins * homeAdvantage); // ãƒ›ãƒ¼ãƒ ã‚¢ãƒ‰ãƒãƒ³ãƒ†ãƒ¼ã‚¸è¨ˆç®—
                const awayWins = team.wins - homeWins;
                const homeLosses = homeGames - homeWins;
                const awayLosses = awayGames - awayWins;
                const homeWinPct = homeGames > 0 ? '0.' + (homeWins / homeGames).toFixed(3).split('.')[1] : '0.000';
                const awayWinPct = awayGames > 0 ? '0.' + (awayWins / awayGames).toFixed(3).split('.')[1] : '0.000';
                
                // æœ€é«˜/æœ€ä½é †ä½å¯èƒ½æ€§è¨ˆç®—
                const maxWins = team.wins + remainingGames;  // ã“ã®ãƒãƒ¼ãƒ ã®æœ€å¤§å¯èƒ½å‹æ•°
                const minWins = team.wins;                   // ã“ã®ãƒãƒ¼ãƒ ã®æœ€å°å¯èƒ½å‹æ•°ï¼ˆç¾åœ¨å‹æ•°ï¼‰
                
                // æœ€é«˜é †ä½è¨ˆç®—: ä»–ãƒãƒ¼ãƒ ãŒæœ€æ‚ªæˆç¸¾ã§çµ‚ã‚ã£ãŸå ´åˆ
                let bestRank = 1;
                teams.forEach(other => {
                    if (other.team_id !== team.team_id) {
                        const otherMinWins = other.wins; // ä»–ãƒãƒ¼ãƒ ã®æœ€å°å‹æ•°ï¼ˆç¾åœ¨å‹æ•°ï¼‰
                        if (otherMinWins > maxWins) {
                            bestRank++; // ã“ã®ãƒãƒ¼ãƒ ã‚ˆã‚Šä¸Šä½ç¢ºå®š
                        }
                    }
                });
                
                // æœ€ä½é †ä½è¨ˆç®—: ä»–ãƒãƒ¼ãƒ ãŒæœ€é«˜æˆç¸¾ã§çµ‚ã‚ã£ãŸå ´åˆ  
                let worstRank = 1;
                teams.forEach(other => {
                    if (other.team_id !== team.team_id) {
                        const otherMaxWins = other.wins + (TOTAL_GAMES - other.games_played);
                        if (otherMaxWins > minWins) {
                            worstRank++; // ã“ã®ãƒãƒ¼ãƒ ã‚ˆã‚Šä¸Šä½å¯èƒ½
                        }
                    }
                });
                
                // CSé€²å‡º/è„±è½çŠ¶æ³ã‚’ç”¨ã„ãŸç¾å®Ÿçš„ãªç¯„å›²è£œæ­£ï¼ˆç°¡æ˜“ï¼‰
                // 4ä½ã®æœ€å¤§å¯èƒ½å‹æ•°ï¼ˆå…¨ãƒãƒ¼ãƒ ã®æœ€å¤§å¯èƒ½å‹æ•°ã®4ç•ªç›®ï¼‰
                const allMaxWins = teams
                    .map(t => t.wins + (TOTAL_GAMES - t.games_played))
                    .sort((a, b) => b - a);
                const fourthHighestMaxWins = allMaxWins[3] ?? 0;
                const thirdPlace = teams[2];
                
                // CSç¢ºå®šãªã‚‰æœ€ä½é †ä½ã¯3ä½ä»¥å†…
                if (team.wins > fourthHighestMaxWins) {
                    worstRank = Math.min(worstRank, 3);
                }
                // 3ä½ã®ç¾åœ¨å‹æ•°ã«æœ€å¤§ã§ã‚‚å±Šã‹ãªã„ãªã‚‰æœ€é«˜é †ä½ã¯4ä½ä»¥ä¸‹
                if (thirdPlace && (team.wins + remainingGames) < thirdPlace.wins) {
                    bestRank = Math.max(bestRank, 4);
                }

                // é †ä½ã¯1-6ä½ã«åˆ¶é™
                bestRank = Math.min(bestRank, 6);
                worstRank = Math.min(worstRank, 6);
                
                return `
                    <tr class="${rankClass}">
                        <td class="center">${team.position_rank}</td>
                        <td>${renderTeamLabel(team.team_abbreviation, team.team_name)}</td>
                        <td class="center">${team.games_played}</td>
                        <td class="center win">${team.wins}</td>
                        <td class="center loss">${team.losses}</td>
                        <td class="center">${team.draws || 0}</td>
                        <td class="center pct">0.${team.win_percentage.toFixed(3).split('.')[1]}</td>
                        <td class="center">${remainingGames}</td>
                        <td class="center">${team.games_behind > 0 ? team.games_behind.toFixed(1) : '-'}</td>
                        <td class="center${streakClass ? ' ' + streakClass : ''}">${streakDisplay}</td>
                        <td class="center">${lastTenDisplay}</td>
                        <td class="center">${homeWins}-${homeLosses}</td>
                        <td class="center">${homeWinPct}</td>
                        <td class="center">${awayWins}-${awayLosses}</td>
                        <td class="center">${awayWinPct}</td>
                        <td class="center">${bestRank}</td>
                        <td class="center">${worstRank}</td>
                    </tr>
                `;
            }).join('');
        }

        // ===== å‹ç‡ã‚·ãƒŠãƒªã‚ªåˆ†ææ›´æ–° =====
        function updateScenarios() {
            // Table references have been removed, only update matrix and detailed views
            renderScenarioMatrixFor('central');
            renderScenarioMatrixFor('pacific');
        }

        // ===== å‹ç‡ã‚·ãƒŠãƒªã‚ªãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–°ï¼ˆå…±é€šé–¢æ•°ï¼‰ =====
        function updateScenariosTable(id, teams) {
            // This function is no longer needed since we removed the table view
            return;

            // Filter: show only teams still able to reach 3ä½ (CS)
            let displayTeams = teams;
            if (teams.length >= 3) {
                const thirdWins = teams[2]?.wins || 0;
                displayTeams = teams.filter(t => (t.wins + (TOTAL_GAMES - t.games_played)) >= thirdWins);
            }

            // Create NPB-style 4-row header
            if (header) {
                let headerHTML = `
                    <tr>
                        <td rowspan="4" style="background: #f8f9fa; font-weight: bold; vertical-align: middle; width: 60px;">ìµœì¢…ìŠ¹ë¥ </td>`;
                
                // Row 1: Team rankings
                displayTeams.forEach(team => {
                    headerHTML += `<td class="center" style="background: #f0f0f0; font-weight: bold; padding: 4px;">${team.position_rank}ìœ„</td>`;
                });
                headerHTML += `</tr><tr>`;
                
                // Row 2: Team names with logos
                displayTeams.forEach(team => {
                    headerHTML += `<td class="center" style="background: #f8f9fa; font-weight: bold; padding: 4px;">${renderTeamLabel(team.team_abbreviation, team.team_name)}</td>`;
                });
                headerHTML += `</tr><tr>`;
                
                // Row 3: Current records + games played
                displayTeams.forEach(team => {
                    headerHTML += `<td class="center" style="background: #f0f0f0; font-size: 12px; padding: 4px;">${team.wins}-${team.losses}-${team.draws || 0} (è©¦åˆ${team.games_played})</td>`;
                });
                headerHTML += `</tr><tr>`;
                
                // Row 4: Remaining games
                displayTeams.forEach(team => {
                    const remaining = TOTAL_GAMES - team.games_played;
                    headerHTML += `<td class="center" style="background: #f8f9fa; font-size: 12px; padding: 4px;">ì”ì—¬${remaining}</td>`;
                });
                headerHTML += `</tr>`;
                
                header.innerHTML = headerHTML;
            }

            // è¡¨ç¤ºã™ã‚‹å‹ç‡ã‚¿ãƒ¼ã‚²ãƒƒãƒˆï¼ˆé«˜ã„é †ã‹ã‚‰ï¼‰ - å‹•çš„è¨­å®š
            const winRateTargets = seasonConfig?.scenario_config?.win_rate_targets || [0.700, 0.650, 0.600, 0.550, 0.500, 0.450, 0.400, 0.350, 0.300];
            
            tbody.innerHTML = winRateTargets.map(targetRate => {
                let row = `<td class="center" style="background: #f8f9fa; font-weight: bold; padding: 4px; font-size: 12px;">${(targetRate * 100).toFixed(0)}%</td>`;
                
                displayTeams.forEach(team => {
                    const remainingGames = TOTAL_GAMES - team.games_played;
                    const currentWins = team.wins;
                    const currentLosses = team.losses;
                    const currentDraws = team.draws || 0;
                    
                    // ç›®æ¨™å‹ç‡é”æˆã«å¿…è¦ãªæ®‹ã‚Šæˆç¸¾è¨ˆç®—
                    const totalGamesMinusDraws = TOTAL_GAMES - currentDraws;
                    const requiredTotalWins = Math.ceil(targetRate * totalGamesMinusDraws);
                    const requiredWins = Math.max(0, requiredTotalWins - currentWins);
                    const requiredLosses = remainingGames - requiredWins;
                    
                    let cellContent = '';
                    let cellStyle = 'text-align: center; padding: 4px; font-size: 10px; min-width: 40px;';
                    
                    if (requiredWins > remainingGames) {
                        // é”æˆä¸å¯èƒ½
                        cellContent = '-';
                        cellStyle += 'background: #ffebee; color: #c62828;';
                    } else if (requiredWins <= 0) {
                        // æ—¢ã«é”æˆã¾ãŸã¯å®¹æ˜“
                        const finalRate = (currentWins / (TOTAL_GAMES - currentDraws)) * 100;
                        if (finalRate >= targetRate * 100) {
                            cellContent = 'âœ“';
                            cellStyle += 'background: #e3f2fd; color: #0d47a1; font-weight: bold;';
                        } else {
                            cellContent = `${requiredWins}-${requiredLosses}`;
                            cellStyle += 'background: #e3f2fd; color: #0d47a1;';
                        }
                    } else {
                        // å¿…è¦æˆç¸¾è¡¨ç¤º: å‹-æ•—
                        cellContent = `${requiredWins}-${requiredLosses}`;
                        
                        // æœ€çµ‚å‹ç‡ã‚’0.500ã¨æ¯”è¼ƒã—ã¦è‰²åˆ†ã‘
                        const finalRate = (currentWins + requiredWins) / (TOTAL_GAMES - currentDraws);
                        if (finalRate > 0.500) {
                            cellStyle += 'background: #e3f2fd; color: #0d47a1;'; // Blue - above .500
                        } else if (finalRate === 0.500) {
                            cellStyle += 'background: #eceff1; color: #37474f;'; // Blue-gray - exactly .500
                        } else {
                            cellStyle += 'background: #ffebee; color: #c62828;'; // Red - below .500
                        }
                    }
                    
                    row += `<td style="${cellStyle}">${cellContent}</td>`;
                });
                
                return `<tr>${row}</tr>`;
            }).join('');
        }

        // ====== ã‚·ãƒŠãƒªã‚ªãƒ»ãƒãƒˆãƒªã‚¯ã‚¹ï¼ˆå ´åˆã®æ•°ï¼‰æ©Ÿèƒ½ ======
        const NPB_TEAM_META = {
            YOG: { shortName: 'å·¨äºº',  fullName: 'èª­å£²ã‚¸ãƒ£ã‚¤ã‚¢ãƒ³ãƒ„',     color: '#FF6600' },
            HAN: { shortName: 'é˜ªç¥',  fullName: 'é˜ªç¥ã‚¿ã‚¤ã‚¬ãƒ¼ã‚¹',       color: '#F6B300' },
            CHU: { shortName: 'ä¸­æ—¥',  fullName: 'ä¸­æ—¥ãƒ‰ãƒ©ã‚´ãƒ³ã‚º',       color: '#0067C0' },
            HIR: { shortName: 'åºƒå³¶',  fullName: 'åºƒå³¶æ±æ´‹ã‚«ãƒ¼ãƒ—',       color: '#C70025' },
            YDB: { shortName: 'DeNA', fullName: 'æ¨ªæµœDeNAãƒ™ã‚¤ã‚¹ã‚¿ãƒ¼ã‚º', color: '#0056B8' },
            YAK: { shortName: 'ãƒ¤ã‚¯',  fullName: 'æ±äº¬ãƒ¤ã‚¯ãƒ«ãƒˆã‚¹ãƒ¯ãƒ­ãƒ¼ã‚º', color: '#1B9132' },
            SOF: { shortName: 'SB',   fullName: 'ç¦å²¡ã‚½ãƒ•ãƒˆãƒãƒ³ã‚¯ãƒ›ãƒ¼ã‚¯ã‚¹', color: '#FFCA08' },
            LOT: { shortName: 'ãƒ­ãƒƒãƒ†',fullName: 'åƒè‘‰ãƒ­ãƒƒãƒ†ãƒãƒªãƒ¼ãƒ³ã‚º',   color: '#1D1D1B' },
            SEI: { shortName: 'è¥¿æ­¦', fullName: 'åŸ¼ç‰è¥¿æ­¦ãƒ©ã‚¤ã‚ªãƒ³ã‚º',     color: '#003E91' },
            ORI: { shortName: 'ã‚ªãƒª', fullName: 'ã‚ªãƒªãƒƒã‚¯ã‚¹ãƒãƒ•ã‚¡ãƒ­ãƒ¼ã‚º', color: '#002E5D' },
            NIP: { shortName: 'æ—¥ãƒãƒ ', fullName: 'åŒ—æµ·é“æ—¥æœ¬ãƒãƒ ãƒ•ã‚¡ã‚¤ã‚¿ãƒ¼ã‚º', color: '#0077C8' },
            RAK: { shortName: 'æ¥½å¤©', fullName: 'æ±åŒ—æ¥½å¤©ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¤ãƒ¼ã‚°ãƒ«ã‚¹', color: '#7F001C' },
        };

        function getLeagueScenarioTeams(league) {
            const teams = league === 'central'
                ? (standingsData?.central_league?.standings || [])
                : (standingsData?.pacific_league?.standings || []);
            return teams.map(t => ({
                team: t.team_abbreviation,
                teamName: t.team_name,
                rank: t.position_rank,
                displayRank: t.position_rank,
                wins: t.wins,
                losses: t.losses,
                draws: t.draws || 0,
                winRate: t.win_percentage,
                remainingGames: Math.max(0, TOTAL_GAMES - (t.games_played || (t.wins + t.losses + (t.draws || 0))))
            })).sort((a,b) => a.rank - b.rank);
        }

        function setScenarioView(league, view) {
            const prefix = league === 'central' ? 'central' : 'pacific';
            const btnMatrix = document.getElementById(`btn-${prefix}-matrix`);
            const btnDetailed = document.getElementById(`btn-${prefix}-detailed`);
            const elMatrix = document.getElementById(`${prefix}-scenario-matrix`);
            const elDetailed = document.getElementById(`${prefix}-scenario-detailed`);

            // Toggle buttons
            btnMatrix?.classList.toggle('active', view === 'matrix');
            btnMatrix?.setAttribute('aria-selected', String(view === 'matrix'));
            btnDetailed?.classList.toggle('active', view === 'detailed');
            btnDetailed?.setAttribute('aria-selected', String(view === 'detailed'));

            // Toggle sections
            if (elMatrix) elMatrix.style.display = (view === 'matrix') ? 'block' : 'none';
            if (elDetailed) elDetailed.style.display = (view === 'detailed') ? 'block' : 'none';

            // Render when needed
            if (view === 'matrix') {
                renderScenarioMatrixFor(league);
            } else if (view === 'detailed') {
                renderDetailedScenariosFor(league);
            }
        }

        function renderScenarioMatrixFor(league) {
            const teams = getLeagueScenarioTeams(league);
            // Show only teams still in contention for 3rd place (CS)
            let contenders = teams;
            if (teams.length >= 3) {
                const thirdWins = teams[2]?.wins || 0;
                contenders = teams.filter(t => (t.wins + t.remainingGames) >= thirdWins);
            }
            const top = contenders.slice(0, Math.min(6, contenders.length));
            const html = generateScenarioMatrixV2(top);
            const targetId = league === 'central' ? 'central-scenario-content' : 'pacific-scenario-content';
            const container = document.getElementById(targetId);
            if (container) container.innerHTML = html;
        }

        function renderDetailedScenariosFor(league) {
            const teams = getLeagueScenarioTeams(league);
            // Show only teams still in contention for 3rd place (CS)
            let contenders = teams;
            if (teams.length >= 3) {
                const thirdWins = teams[2]?.wins || 0;
                contenders = teams.filter(t => (t.wins + t.remainingGames) >= thirdWins);
            }
            const top = contenders.slice(0, Math.min(6, contenders.length));
            const html = generateDetailedScenarios(top);
            const targetId = league === 'central' ? 'central-scenario-detailed' : 'pacific-scenario-detailed';
            const container = document.getElementById(targetId);
            if (container) container.innerHTML = html;
        }

        function bindScenarioViewToggles() {
            // Central
            document.getElementById('btn-central-matrix')?.addEventListener('click', () => setScenarioView('central','matrix'));
            document.getElementById('btn-central-detailed')?.addEventListener('click', () => setScenarioView('central','detailed'));
            // Pacific
            document.getElementById('btn-pacific-matrix')?.addEventListener('click', () => setScenarioView('pacific','matrix'));
            document.getElementById('btn-pacific-detailed')?.addEventListener('click', () => setScenarioView('pacific','detailed'));
        }

        function generateScenarioMatrix(topTeams) {
            let html = `
                <div class="scenario-matrix-container" style="
                    overflow-x: auto; overflow-y: auto; border-radius: 12px; border: 1px solid #e0e0e0; box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                    max-height: 80vh; width: 100%; position: relative;">
                    <table class="scenario-matrix-table" style="width: 100%; border-collapse: collapse; font-size: 0.75rem; background: white; min-width: ${window.innerWidth <= 768 ? '700px' : Math.max(900, 6 * (70 + 85) + 70 + 140) + 'px'};">
                        <thead style="position: sticky; top: 0; z-index: 100;">
                          <tr style="background: #1E88E5; color: white;">
                            <th style="position: sticky; left: 0; z-index: 110; min-width: 70px; width: 70px; padding: 4px 6px; text-align: center; font-weight: 600; border-right: 2px solid rgba(255,255,255,0.4); background: #1E88E5; font-size: 0.7rem;">å‹ç‡</th>`;

            // Header team columns
            topTeams.forEach((team, index) => {
                const isLast = index === topTeams.length - 1;
                const teamMeta = NPB_TEAM_META[team.team];
                const teamColor = teamMeta?.color || '#333';
                const totalColumnWidth = '140px';
                const logo = TEAM_LOGOS[team.team] ? `<img class=\"team-logo\" src=\"${TEAM_LOGOS[team.team]}\" alt=\"${teamMeta?.fullName || team.team}\" loading=\"lazy\">` : '';
                html += `<th colspan="2" style="min-width: ${totalColumnWidth}; width: ${totalColumnWidth}; padding: 6px 4px 3px 4px; text-align: center; font-weight: 700; background: #F0F2F5; color: ${teamColor}; ${index === 2 ? 'border-right: 4px solid #FF6B35;' : (!isLast ? 'border-right: 2px solid rgba(255,255,255,0.5);' : '')} font-size: 0.8rem; white-space: nowrap; line-height: 1.2;"> 
                    <div style="font-size: 0.85rem; font-weight: 800; color: ${teamColor};">${team.displayRank || team.rank}ä½ ${logo}${teamMeta?.shortName || team.team}</div>
                </th>`;
            });

            // Current record row
            html += `</tr><tr style="background: #1E88E5; color: white;">
                <th style="position: sticky; left: 0; z-index: 110; min-width: 70px; width: 70px; padding: 4px 6px; text-align: center; font-weight: 600; border-right: 2px solid rgba(255,255,255,0.4); background: #1E88E5; font-size: 0.7rem;">æˆç¸¾</th>`;
            topTeams.forEach((team, index) => {
                const isLast = index === topTeams.length - 1;
                html += `<th colspan="2" style="min-width: 140px; width: 140px; padding: 4px; text-align: center; font-weight: 600; background: rgba(255,255,255,0.9); color: #333; ${index === 2 ? 'border-right: 4px solid #FF6B35;' : (!isLast ? 'border-right: 2px solid rgba(255,255,255,0.5);' : '')} font-size: 0.7rem;">${team.wins}å‹ ${team.losses}æ•— ${team.draws || 0}åˆ† (0.${(team.winRate ?? (team.wins/(team.wins+team.losses))).toFixed(3).split('.')[1]})</th>`;
            });

            // Remaining row
            html += `</tr><tr style="background: #1E88E5; color: white;">
                <th style="position: sticky; left: 0; z-index: 110; min-width: 70px; width: 70px; padding: 4px 6px; text-align: center; font-weight: 600; border-right: 2px solid rgba(255,255,255,0.4); background: #1E88E5; font-size: 0.7rem;">æ®‹ã‚Š</th>`;
            topTeams.forEach((team, index) => {
                const isLast = index === topTeams.length - 1;
                html += `<th colspan="2" style="min-width: 140px; width: 140px; padding: 4px; text-align: center; font-weight: 600; background: rgba(255,255,255,0.9); color: #333; ${index === 2 ? 'border-right: 4px solid #FF6B35;' : (!isLast ? 'border-right: 2px solid rgba(255,255,255,0.5);' : '')} font-size: 0.7rem;">æ®‹ã‚Š: ${team.remainingGames}è©¦åˆ</th>`;
            });

            // Column split row
            html += `</tr><tr style="background: #1E88E5; color: white;">
                <th style="position: sticky; left: 0; z-index: 110; min-width: 70px; width: 70px; padding: 4px 6px; text-align: center; font-weight: 600; border-right: 2px solid rgba(255,255,255,0.4); background: #1E88E5; font-size: 0.7rem;">å‹ç‡</th>`;
            topTeams.forEach((team, index) => {
                const isLast = index === topTeams.length - 1;
                html += `
                    <th style="width: 70px; min-width: 70px; font-size: 0.7rem; padding: 2px 1px; background: rgba(255,255,255,0.1); border-right: 1px solid rgba(255,255,255,0.3); text-align: center; font-weight: 600;">æ®‹ã‚Šæˆç¸¾<br><span style=\"font-size: 0.6rem;\">(å‹-æ•—/å‹ç‡)</span></th>
                    <th style="width: 85px; min-width: 85px; font-size: 0.7rem; padding: 2px 1px; background: rgba(255,255,255,0.1); ${index === 2 ? 'border-right: 4px solid #FF6B35;' : (!isLast ? 'border-right: 2px solid rgba(255,255,255,0.5);' : '')} text-align: center; font-weight: 600;">æœ€çµ‚æˆç¸¾<br><span style=\"font-size: 0.6rem;\">(å‹-æ•—-åˆ†/å‹ç‡)</span></th>`;
            });

            html += `</tr></thead><tbody>`;

            const allScenarios = [];
            topTeams.forEach(team => {
                for (let wins = team.remainingGames; wins >= 0; wins--) {
                    const losses = team.remainingGames - wins;
                    const finalWins = team.wins + wins;
                    const finalLosses = team.losses + losses;
                    const finalWinRate = finalWins / (finalWins + finalLosses);
                    allScenarios.push({ team: team.team, wins, losses, finalWinRate, remainingWinRate: wins / (wins + losses) || 0 });
                }
            });

            const winRateGroups = {};
            allScenarios.forEach(s => {
                const key = s.finalWinRate.toFixed(3);
                (winRateGroups[key] ||= []).push(s);
            });

            Object.keys(winRateGroups).sort((a,b) => parseFloat(b) - parseFloat(a)).forEach(rateKey => {
                const scenarios = winRateGroups[rateKey];
                const winRate = parseFloat(rateKey);
                html += `<tr class="scenario-row">
                    <td style="font-size: 0.8rem; padding: 3px 2px; font-weight: 700; background: white; color: #2E7D32; border: 1px solid #dee2e6; text-align: center; position: sticky; left: 0; z-index: 5; width: 60px; box-shadow: 2px 0 4px rgba(0,0,0,0.1); line-height: 1.2;">0.${winRate.toFixed(3).split('.')[1]}</td>`;
                topTeams.forEach((team, teamIndex) => {
                    const isLast = teamIndex === topTeams.length - 1;
                    const teamScenario = scenarios.find(s => s.team === team.team);
                    if (teamScenario) {
                        const remainingWinRate = teamScenario.wins === 0 && teamScenario.losses > 0 ? 0.0 :
                                                 teamScenario.losses === 0 && teamScenario.wins > 0 ? 1.0 :
                                                 (teamScenario.wins / (teamScenario.wins + teamScenario.losses) || 0);
                        const finalWins = team.wins + teamScenario.wins;
                        const finalLosses = team.losses + teamScenario.losses;
                        const finalDraws = team.draws || 0;
                        const finalBg = getWinRateBackgroundColor(teamScenario.finalWinRate);
                        const finalFg = getWinRateTextColor(teamScenario.finalWinRate);
                        const remainBg = getWinRateBackgroundColor(remainingWinRate);
                        const remainFg = getWinRateTextColor(remainingWinRate);

                        html += `<td style="padding: 2px 0px; text-align: center; border: 1px solid #dee2e6; width: 70px; min-width: 70px; line-height: 1.1; background: ${remainBg}; color: ${remainFg};">
                            <div style="font-size: 0.8rem; font-weight: 600;">${teamScenario.wins}å‹ ${teamScenario.losses}æ•—</div>
                            <div style="font-size: 0.7rem;">${remainingWinRate === 1.0 ? '1.000' : '0.' + remainingWinRate.toFixed(3).split('.')[1]}</div>
                        </td>`;
                        html += `<td style="padding: 2px 1px; text-align: center; border: 1px solid #dee2e6; width: 85px; min-width: 85px; line-height: 1.1; white-space: nowrap; background: ${finalBg}; color: ${finalFg}; ${teamIndex === 2 ? 'border-right: 4px solid #FF6B35;' : (!isLast ? 'border-right: 2px solid #dee2e6;' : '')}"> 
                            <div style="font-size: 0.8rem; font-weight: 600;">${finalWins}å‹ ${finalLosses}æ•— ${finalDraws}åˆ†</div>
                            <div style="font-size: 0.7rem;">0.${teamScenario.finalWinRate.toFixed(3).split('.')[1]}</div>
                        </td>`;
                    } else {
                        html += `<td style="background: #f8f9fa; border: 1px solid #dee2e6;"></td><td style="background: #f8f9fa; border: 1px solid #dee2e6; ${teamIndex === 2 ? 'border-right: 4px solid #FF6B35;' : (!isLast ? 'border-right: 2px solid #dee2e6;' : '')}"></td>`;
                    }
                });
                html += `</tr>`;
            });

            html += `</tbody></table></div>`;
            return html;
        }

        // V2: Same as generateScenarioMatrix but with 3ä½ã‚«ãƒƒãƒˆãƒ©ã‚¤ãƒ³ after index 2
        function generateScenarioMatrixV2(topTeams) {
            const cutoffIndex = 2; // 0-based: after 3rd place
            let html = `
                <div class="scenario-matrix-container" style="
                    overflow-x: auto; overflow-y: auto; border-radius: 12px; border: 1px solid #e0e0e0; box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                    max-height: 80vh; width: 100%; position: relative;">
                    <table class="scenario-matrix-table" style="width: 100%; border-collapse: collapse; font-size: 0.75rem; background: white; min-width: ${window.innerWidth <= 768 ? '700px' : Math.max(900, 6 * (70 + 85) + 70 + 140) + 'px'};">
                        <thead style="position: sticky; top: 0; z-index: 100;">
                          <tr style="background: #1E88E5; color: white;">
                            <th style="position: sticky; left: 0; z-index: 110; min-width: 70px; width: 70px; padding: 4px 6px; text-align: center; font-weight: 600; border-right: 2px solid rgba(255,255,255,0.4); background: #1E88E5; font-size: 0.7rem;">å‹ç‡</th>`;

            // Header team columns
            topTeams.forEach((team, index) => {
                const isLast = index === topTeams.length - 1;
                const teamMeta = NPB_TEAM_META[team.team];
                const teamColor = teamMeta?.color || '#333';
                const totalColumnWidth = '140px';
                const logo = TEAM_LOGOS[team.team] ? `<img class=\"team-logo\" src=\"${TEAM_LOGOS[team.team]}\" alt=\"${teamMeta?.fullName || team.team}\" loading=\"lazy\">` : '';
                html += `<th colspan="2" style="min-width: ${totalColumnWidth}; width: ${totalColumnWidth}; padding: 6px 4px 3px 4px; text-align: center; font-weight: 700; background: #F0F2F5; color: ${teamColor}; ${index === cutoffIndex ? 'border-right: 4px solid #FF6B35;' : (!isLast ? 'border-right: 2px solid rgba(255,255,255,0.5);' : '')} font-size: 0.8rem; white-space: nowrap; line-height: 1.2;"> 
                    <div style="font-size: 0.85rem; font-weight: 800; color: ${teamColor};">${team.displayRank || team.rank}ä½ ${logo}${teamMeta?.shortName || team.team}</div>
                </th>`;
            });

            // Current record row
            html += `</tr><tr style="background: #1E88E5; color: white;">
                <th style="position: sticky; left: 0; z-index: 110; min-width: 70px; width: 70px; padding: 4px 6px; text-align: center; font-weight: 600; border-right: 2px solid rgba(255,255,255,0.4); background: #1E88E5; font-size: 0.7rem;">æˆç¸¾</th>`;
            topTeams.forEach((team, index) => {
                const isLast = index === topTeams.length - 1;
                html += `<th colspan="2" style="min-width: 140px; width: 140px; padding: 4px; text-align: center; font-weight: 600; background: rgba(255,255,255,0.9); color: #333; ${index === cutoffIndex ? 'border-right: 4px solid #FF6B35;' : (!isLast ? 'border-right: 2px solid rgba(255,255,255,0.5);' : '')} font-size: 0.7rem;">${team.wins}å‹ ${team.losses}æ•— ${team.draws || 0}åˆ† (0.${(team.winRate ?? (team.wins/(team.wins+team.losses))).toFixed(3).split('.')[1]})</th>`;
            });

            // Remaining row
            html += `</tr><tr style="background: #1E88E5; color: white;">
                <th style="position: sticky; left: 0; z-index: 110; min-width: 70px; width: 70px; padding: 4px 6px; text-align: center; font-weight: 600; border-right: 2px solid rgba(255,255,255,0.4); background: #1E88E5; font-size: 0.7rem;">æ®‹ã‚Š</th>`;
            topTeams.forEach((team, index) => {
                const isLast = index === topTeams.length - 1;
                html += `<th colspan="2" style="min-width: 140px; width: 140px; padding: 4px; text-align: center; font-weight: 600; background: rgba(255,255,255,0.9); color: #333; ${index === cutoffIndex ? 'border-right: 4px solid #FF6B35;' : (!isLast ? 'border-right: 2px solid rgba(255,255,255,0.5);' : '')} font-size: 0.7rem;">æ®‹ã‚Š: ${team.remainingGames}è©¦åˆ</th>`;
            });

            // Column split row
            html += `</tr><tr style="background: #1E88E5; color: white;">
                <th style="position: sticky; left: 0; z-index: 110; min-width: 70px; width: 70px; padding: 4px 6px; text-align: center; font-weight: 600; border-right: 2px solid rgba(255,255,255,0.4); background: #1E88E5; font-size: 0.7rem;">å‹ç‡</th>`;
            topTeams.forEach((team, index) => {
                const isLast = index === topTeams.length - 1;
                html += `
                    <th style="width: 70px; min-width: 70px; font-size: 0.7rem; padding: 2px 1px; background: rgba(255,255,255,0.1); border-right: 1px solid rgba(255,255,255,0.3); text-align: center; font-weight: 600;">æ®‹ã‚Šæˆç¸¾<br><span style=\"font-size: 0.6rem;\">(å‹-æ•—/å‹ç‡)</span></th>
                    <th style="width: 85px; min-width: 85px; font-size: 0.7rem; padding: 2px 1px; background: rgba(255,255,255,0.1); ${index === cutoffIndex ? 'border-right: 4px solid #FF6B35;' : (!isLast ? 'border-right: 2px solid rgba(255,255,255,0.5);' : '')} text-align: center; font-weight: 600;">æœ€çµ‚æˆç¸¾<br><span style=\"font-size: 0.6rem;\">(å‹-æ•—-åˆ†/å‹ç‡)</span></th>`;
            });

            html += `</tr></thead><tbody>`;

            const allScenarios = [];
            topTeams.forEach(team => {
                for (let wins = team.remainingGames; wins >= 0; wins--) {
                    const losses = team.remainingGames - wins;
                    const finalWins = team.wins + wins;
                    const finalLosses = team.losses + losses;
                    const finalWinRate = finalWins / (finalWins + finalLosses);
                    allScenarios.push({ team: team.team, wins, losses, finalWinRate, remainingWinRate: wins / (wins + losses) || 0 });
                }
            });

            const winRateGroups = {};
            allScenarios.forEach(s => {
                const key = s.finalWinRate.toFixed(3);
                (winRateGroups[key] ||= []).push(s);
            });

            Object.keys(winRateGroups).sort((a,b) => parseFloat(b) - parseFloat(a)).forEach(rateKey => {
                const scenarios = winRateGroups[rateKey];
                const winRate = parseFloat(rateKey);
                html += `<tr class="scenario-row">
                    <td style="font-size: 0.8rem; padding: 3px 2px; font-weight: 700; background: white; color: #2E7D32; border: 1px solid #dee2e6; text-align: center; position: sticky; left: 0; z-index: 5; width: 60px; box-shadow: 2px 0 4px rgba(0,0,0,0.1); line-height: 1.2;">0.${winRate.toFixed(3).split('.')[1]}</td>`;
                topTeams.forEach((team, teamIndex) => {
                    const isLast = teamIndex === topTeams.length - 1;
                    const teamScenario = scenarios.find(s => s.team === team.team);
                    if (teamScenario) {
                        const remainingWinRate = teamScenario.wins === 0 && teamScenario.losses > 0 ? 0.0 :
                                                 teamScenario.losses === 0 && teamScenario.wins > 0 ? 1.0 :
                                                 (teamScenario.wins / (teamScenario.wins + teamScenario.losses) || 0);
                        const finalWins = team.wins + teamScenario.wins;
                        const finalLosses = team.losses + teamScenario.losses;
                        const finalDraws = team.draws || 0;
                        const finalBg = getWinRateBackgroundColor(teamScenario.finalWinRate);
                        const finalFg = getWinRateTextColor(teamScenario.finalWinRate);
                        const remainBg = getWinRateBackgroundColor(remainingWinRate);
                        const remainFg = getWinRateTextColor(remainingWinRate);

                        html += `<td style="padding: 2px 0px; text-align: center; border: 1px solid #dee2e6; width: 70px; min-width: 70px; line-height: 1.1; background: ${remainBg}; color: ${remainFg};">
                            <div style="font-size: 0.8rem; font-weight: 600;">${teamScenario.wins}å‹ ${teamScenario.losses}æ•—</div>
                            <div style="font-size: 0.7rem;">${remainingWinRate === 1.0 ? '1.000' : '0.' + remainingWinRate.toFixed(3).split('.')[1]}</div>
                        </td>`;
                        html += `<td style="padding: 2px 1px; text-align: center; border: 1px solid #dee2e6; width: 85px; min-width: 85px; line-height: 1.1; white-space: nowrap; background: ${finalBg}; color: ${finalFg}; ${teamIndex === cutoffIndex ? 'border-right: 4px solid #FF6B35;' : (!isLast ? 'border-right: 2px solid #dee2e6;' : '')}">
                            <div style="font-size: 0.8rem; font-weight: 600;">${finalWins}å‹ ${finalLosses}æ•— ${finalDraws}åˆ†</div>
                            <div style="font-size: 0.7rem;">0.${teamScenario.finalWinRate.toFixed(3).split('.')[1]}</div>
                        </td>`;
                    } else {
                        html += `<td style="background: #f8f9fa; border: 1px solid #dee2e6;"></td><td style="background: #f8f9fa; border: 1px solid #dee2e6; ${teamIndex === cutoffIndex ? 'border-right: 4px solid #FF6B35;' : (!isLast ? 'border-right: 2px solid #dee2e6;' : '')}"></td>`;
                    }
                });
                html += `</tr>`;
            });

            html += `</tbody></table></div>`;
            return html;
        }

        function generateDetailedScenarios(topTeams) {
            let html = `
                <div style="margin-bottom: 15px;">
                    <h5 style="color: #2E7D32; margin-bottom: 10px;">ğŸ† è©³ç´°ã‚·ãƒŠãƒªã‚ªåˆ†æ</h5>
                    <p style="font-size: 0.9rem; color: #666; margin-bottom: 15px;">CSé€²å‡ºå¯èƒ½æ€§ã®ã‚ã‚‹å…¨ãƒãƒ¼ãƒ ã®æ®‹ã‚Šè©¦åˆã®å‹æ•—ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã€ãã‚Œãã‚Œã®æœ€çµ‚æˆç¸¾ãƒ»å‹ç‡ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚</p>
                </div>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">`;

            topTeams.forEach((team, index) => {
                const colors = ['#e3f2fd', '#e8f5e8', '#fff3e0', '#f3e5f5', '#fce4ec'];
                const bgColor = colors[index] || '#f8f9fa';
                const meta = NPB_TEAM_META[team.team] || {};
                const logo = TEAM_LOGOS[team.team] ? `<img class=\"team-logo\" src=\"${TEAM_LOGOS[team.team]}\" alt=\"${meta.fullName || team.team}\">` : '';
                html += `
                    <div style="background: ${bgColor}; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px;">
                        <h6 style="margin: 0 0 10px 0; color: #333; text-align: center; font-size: 1.1rem; font-weight: bold;">${team.rank}ä½ ${logo}${meta.fullName || team.team}</h6>
                        <div style="text-align: center; margin-bottom: 10px; font-size: 0.9rem; color: #666;">
                            ç¾åœ¨: ${team.wins}å‹ ${team.losses}æ•— ${team.draws || 0}åˆ† 0.${(team.winRate ?? (team.wins/(team.wins+team.losses))).toFixed(3).split('.')[1]}<br>
                            æ®‹ã‚Š: ${team.remainingGames}è©¦åˆ
                        </div>
                        <table style="width: 100%; border-collapse: collapse; font-size: 0.8rem;">
                            <thead>
                                <tr style="background: rgba(0,0,0,0.05);">
                                    <th style="padding: 2px; border: 1px solid #ccc; width: 25px; text-align: center;">å‹</th>
                                    <th style="padding: 2px; border: 1px solid #ccc; width: 25px; text-align: center;">æ•—</th>
                                    <th style="padding: 2px; border: 1px solid #ccc; width: 80px; text-align: center;">æœ€çµ‚æˆç¸¾</th>
                                    <th style="padding: 2px; border: 1px solid #ccc; width: 50px; text-align: center;">æœ€çµ‚å‹ç‡</th>
                                </tr>
                            </thead>
                            <tbody>`;

                for (let wins = team.remainingGames; wins >= 0; wins--) {
                    const losses = team.remainingGames - wins;
                    const finalWins = team.wins + wins;
                    const finalLosses = team.losses + losses;
                    const finalGames = finalWins + finalLosses + (team.draws || 0);
                    const finalWinRate = finalWins / finalGames;
                    const rowBg = getWinRateColor(finalWinRate);
                    html += `
                        <tr style="background: ${rowBg};">
                            <td style="padding: 2px; border: 1px solid #ccc; text-align: center; width: 25px;">${wins}</td>
                            <td style="padding: 2px; border: 1px solid #ccc; text-align: center; width: 25px;">${losses}</td>
                            <td style="padding: 2px; border: 1px solid #ccc; text-align: center; width: 80px; font-size: 0.75rem;">${finalWins}-${finalLosses}-${team.draws || 0}</td>
                            <td style="padding: 2px; border: 1px solid #ccc; text-align: center; font-weight: 600; width: 50px;">0.${(finalWinRate).toFixed(3).split('.')[1]}</td>
                        </tr>`;
                }

                html += `
                            </tbody>
                        </table>
                    </div>`;
            });

            html += `</div>`;
            return html;
        }

        function getWinRateColor(winRate) {
            // Light blue tones for higher win rates, light red for lower
            if (winRate >= 0.700) return '#BBDEFB';
            if (winRate >= 0.650) return '#CDE5FD';
            if (winRate >= 0.600) return '#E3F2FD';
            if (winRate >= 0.550) return '#F1F8FF';
            if (winRate >= 0.500) return '#F6FAFF';
            if (winRate >= 0.450) return '#FFECEC';
            if (winRate >= 0.400) return '#FFE3E3';
            return '#FFD9D9';
        }

        function getWinRateBackgroundColor(winRate) {
            // Solid colors for readability (no gradients)
            if (winRate > 0.5) return '#E3F2FD';   // light blue
            if (winRate < 0.5) return '#FFEBEE';   // light red
            return '#ECEFF1';                      // blue-gray for exactly .500
        }

        function getWinRateTextColor(winRate) {
            if (winRate > 0.5) return '#0D47A1';  // dark blue text on light blue
            if (winRate < 0.5) return '#C62828';  // dark red text on light red
            return '#37474F';                    // blue-gray text on neutral
        }

        // ===== æ®‹ã‚Šè©¦åˆæ•°æ›´æ–° =====
        function updateRemainingGames() {
            updateRemainingMatrix('central-remaining-matrix', standingsData.central_league?.standings || [], 'central');
            updateRemainingMatrix('pacific-remaining-matrix', standingsData.pacific_league?.standings || [], 'pacific');
        }

        // ===== ã‚·ãƒ¼ã‚ºãƒ³é€²è¡ŒçŠ¶æ³æ›´æ–° =====
        function updateProgress() {
            updateOverallProgress();
            updateTeamProgress('central-progress', standingsData.central_league?.standings || []);
            updateTeamProgress('pacific-progress', standingsData.pacific_league?.standings || []);
            updateProgressStats();
        }

        function updateOverallProgress() {
            const allTeams = [
                ...(standingsData.central_league?.standings || []),
                ...(standingsData.pacific_league?.standings || [])
            ];
            
            if (!allTeams.length) return;
            
            // ì‹¤ì œ ì‹œì¦Œ ì´ ê²½ê¸° ìˆ˜: ê° íŒ€ 143ê²½ê¸° Ã— 12íŒ€ Ã· 2 (ê° ê²½ê¸°ëŠ” 2íŒ€ ì°¸ì—¬)
            const totalSeasonGames = (allTeams.length * TOTAL_GAMES) / 2;  // 858ê²½ê¸°
            
            // í˜„ì¬ê¹Œì§€ ì™„ë£Œëœ ê²½ê¸° ìˆ˜: ëª¨ë“  íŒ€ì˜ ê²½ê¸° ìˆ˜ í•©ê³„ Ã· 2
            const totalGamesPlayed = allTeams.reduce((sum, team) => sum + (team.games_played || 0), 0) / 2;
            
            const progressPercentage = (totalGamesPlayed / totalSeasonGames) * 100;
            const remainingGames = totalSeasonGames - totalGamesPlayed;
            
            // UI ì—…ë°ì´íŠ¸
            const percentageEl = document.getElementById('overall-percentage');
            const progressFillEl = document.getElementById('overall-progress-fill');
            const completedEl = document.getElementById('completed-games');
            const remainingEl = document.getElementById('remaining-total');
            const totalEl = document.getElementById('total-season-games');
            
            if (percentageEl) percentageEl.textContent = `${progressPercentage.toFixed(1)}%`;
            if (progressFillEl) progressFillEl.style.width = `${progressPercentage}%`;
            if (completedEl) completedEl.textContent = totalGamesPlayed.toLocaleString();
            if (remainingEl) remainingEl.textContent = remainingGames.toLocaleString();
            if (totalEl) totalEl.textContent = totalSeasonGames.toLocaleString();
        }

        function updateTeamProgress(containerId, teams) {
            const container = document.getElementById(containerId);
            if (!container || !teams.length) return;
            
            let html = '';
            
            // íŒ€ì„ ì§„í–‰ë¥  ìˆœìœ¼ë¡œ ì •ë ¬
            const sortedTeams = teams.slice().sort((a, b) => (b.games_played || 0) - (a.games_played || 0));
            
            sortedTeams.forEach(team => {
                const gamesPlayed = team.games_played || 0;
                const progressPercentage = (gamesPlayed / TOTAL_GAMES) * 100;
                const remaining = TOTAL_GAMES - gamesPlayed;

                const teamMeta = NPB_TEAM_META[team.team_abbreviation] || {};
                let barColor = teamMeta.color || '#4caf50';
                if (!teamMeta.color) {
                    if (progressPercentage < 50) {
                        barColor = '#ff9800';
                    } else if (progressPercentage < 70) {
                        barColor = '#ffeb3b';
                    } else if (progressPercentage > 90) {
                        barColor = '#2e7d32';
                    }
                }
                
                html += `
                    <div class="team-progress-item">
                        <div class="team-progress-header">
                            <div class="team-progress-name" style="color: ${barColor};">${renderTeamLabel(team.team_abbreviation, team.team_name, true)}</div>
                            <div class="team-progress-text" style="color: ${barColor};">${progressPercentage.toFixed(1)}%</div>
                        </div>
                        <div class="team-progress-bar">
                            <div class="team-progress-fill" style="width: ${progressPercentage}%; background: ${barColor};"></div>
                        </div>
                        <div class="team-progress-summary">
                            <span class="summary-completed">å®Œäº†: ${gamesPlayed.toLocaleString()}è©¦åˆ</span>
                            <span class="summary-remaining">æ®‹ã‚Š: ${remaining.toLocaleString()}è©¦åˆ</span>
                            <span class="summary-total">ç·è©¦åˆæ•°: ${TOTAL_GAMES.toLocaleString()}è©¦åˆ</span>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function updateProgressStats() {
            const allTeams = [
                ...(standingsData.central_league?.standings || []),
                ...(standingsData.pacific_league?.standings || [])
            ];
            
            if (!allTeams.length) return;
            
            const progressRates = allTeams.map(team => (team.games_played || 0) / TOTAL_GAMES * 100);
            const averageProgress = progressRates.reduce((sum, rate) => sum + rate, 0) / progressRates.length;
            
            const maxProgress = Math.max(...progressRates);
            const minProgress = Math.min(...progressRates);
            
            const highestTeam = allTeams.find(team => (team.games_played || 0) / TOTAL_GAMES * 100 === maxProgress);
            const lowestTeam = allTeams.find(team => (team.games_played || 0) / TOTAL_GAMES * 100 === minProgress);
            
            const maxGames = Math.max(...allTeams.map(team => team.games_played || 0));
            const minGames = Math.min(...allTeams.map(team => team.games_played || 0));
            const progressGap = maxGames - minGames;
            
            // UI ì—…ë°ì´íŠ¸
            const averageEl = document.getElementById('average-progress');
            const highestEl = document.getElementById('highest-team');
            const lowestEl = document.getElementById('lowest-team');
            const gapEl = document.getElementById('progress-gap');
            
            if (averageEl) averageEl.textContent = `${averageProgress.toFixed(1)}%`;
            if (highestEl) highestEl.innerHTML = renderTeamLabel(highestTeam?.team_abbreviation, highestTeam?.team_name, true) || 'â€”';
            if (lowestEl) lowestEl.innerHTML = renderTeamLabel(lowestTeam?.team_abbreviation, lowestTeam?.team_name, true) || 'â€”';
            if (gapEl) gapEl.textContent = `${progressGap}è©¦åˆ`;
        }

        // ===== æ®‹ã‚Šè©¦åˆãƒãƒˆãƒªã‚¯ã‚¹æ›´æ–°ï¼ˆå…±é€šé–¢æ•°ï¼‰ =====
        function updateRemainingMatrix(containerId, teams, leagueType) {
            const container = document.getElementById(containerId);
            if (!teams.length) {
                container.innerHTML = '<div class="loading">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }

            // ãƒãƒ¼ãƒ é †åºã‚’é †ä½é †ã«ã‚½ãƒ¼ãƒˆ
            const sortedTeams = [...teams].sort((a, b) => a.rank - b.rank);
            const teamCount = sortedTeams.length;

            // ã‚°ãƒªãƒƒãƒ‰ã®ã‚«ãƒ©ãƒ æ•°ã‚’è¨­å®š (ãƒãƒ¼ãƒ å + å„ãƒãƒ¼ãƒ  + åˆè¨ˆ)
            const gridColumns = teamCount + 2;
            container.style.gridTemplateColumns = `180px repeat(${teamCount}, 100px) 80px`;

            let matrixHTML = '';

            // ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œ - ç›¸æ‰‹ãƒãƒ¼ãƒ å (ã‚¢ã‚¦ã‚§ãƒ¼ãƒãƒ¼ãƒ )
            matrixHTML += '<div class="matrix-cell matrix-corner">ãƒ›ãƒ¼ãƒ ï¼¼ã‚¢ã‚¦ã‚§ãƒ¼</div>';
            sortedTeams.forEach(team => {
                const teamLabel = renderTeamLabel(team.team_abbreviation, team.team_name, true);
                matrixHTML += `<div class="matrix-cell matrix-header-opponent">${teamLabel}</div>`;
            });
            matrixHTML += '<div class="matrix-cell matrix-corner">åˆè¨ˆ</div>';

            // æ®‹ã‚Šè©¦åˆãƒãƒˆãƒªã‚¯ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’æ§‹ç¯‰
            const matrixData = {};
            if (upcomingGamesData && Array.isArray(upcomingGamesData)) {
                upcomingGamesData.forEach(game => {
                    if (game.game_status !== 'scheduled') return;
                    
                    const homeAbbr = game.home_team_abbr;
                    const awayAbbr = game.away_team_abbr;
                    
                    if (!matrixData[homeAbbr]) matrixData[homeAbbr] = {};
                    if (!matrixData[homeAbbr][awayAbbr]) matrixData[homeAbbr][awayAbbr] = 0;
                    matrixData[homeAbbr][awayAbbr]++;
                });
            }

            // ãƒ‡ãƒ¼ã‚¿è¡Œ
            sortedTeams.forEach(homeTeam => {
                // ãƒãƒ¼ãƒ åï¼ˆãƒ›ãƒ¼ãƒ ï¼‰
                const teamLabel = renderTeamLabel(homeTeam.team_abbreviation, homeTeam.team_name, true);
                matrixHTML += `<div class="matrix-cell matrix-header-team">${teamLabel}</div>`;

                let rowTotal = 0;

                // å„ç›¸æ‰‹ãƒãƒ¼ãƒ ã¨ã®å¯¾æˆ¦æ•°
                sortedTeams.forEach(awayTeam => {
                    if (homeTeam.team_abbreviation === awayTeam.team_abbreviation) {
                        // è‡ªãƒãƒ¼ãƒ 
                        matrixHTML += '<div class="matrix-cell matrix-data-cell" style="background: #f5f5f5; color: #999;">-</div>';
                    } else {
                        // æ®‹ã‚Šè©¦åˆæ•°ã‚’å–å¾—
                        const remainingGames = matrixData[homeTeam.team_abbreviation]?.[awayTeam.team_abbreviation] || 0;
                        
                        const cellClass = remainingGames > 0 ? 'has-games' : 'zero';
                        matrixHTML += `<div class="matrix-cell matrix-data-cell ${cellClass}">${remainingGames}</div>`;
                        rowTotal += remainingGames;
                    }
                });

                // è¡Œã®åˆè¨ˆï¼ˆãƒ›ãƒ¼ãƒ è©¦åˆæ•°ï¼‰
                matrixHTML += `<div class="matrix-cell matrix-total-cell">${rowTotal}</div>`;
            });

            // æœ€çµ‚è¡Œ: å„åˆ—ã®åˆè¨ˆï¼ˆã‚¢ã‚¦ã‚§ãƒ¼è©¦åˆæ•°ï¼‰
            matrixHTML += '<div class="matrix-cell matrix-corner">åˆè¨ˆ</div>';
            sortedTeams.forEach(awayTeam => {
                let columnTotal = 0;
                sortedTeams.forEach(homeTeam => {
                    if (homeTeam.team_abbreviation !== awayTeam.team_abbreviation) {
                        columnTotal += matrixData[homeTeam.team_abbreviation]?.[awayTeam.team_abbreviation] || 0;
                    }
                });
                matrixHTML += `<div class="matrix-cell matrix-total-cell">${columnTotal}</div>`;
            });
            
            // ç·åˆè¨ˆ
            let grandTotal = 0;
            sortedTeams.forEach(team => {
                grandTotal += TOTAL_GAMES - team.games_played;
            });
            matrixHTML += `<div class="matrix-cell matrix-corner" style="font-weight: bold;">${Math.floor(grandTotal/2)}</div>`;

            container.innerHTML = matrixHTML;
        }

        // ===== ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºæ©Ÿèƒ½ =====
        function showError(errorMsg = 'ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ') {
            const errorHtml = `<tr><td colspan="15" class="loading">âŒ ${errorMsg}</td></tr>`;
            document.querySelectorAll('tbody').forEach(tbody => {
                tbody.innerHTML = errorHtml;
            });
            
            // ì—ëŸ¬ ìƒì„¸ ì •ë³´ í‘œì‹œ
            const errorDetail = document.createElement('div');
            errorDetail.style.cssText = 'position: fixed; top: 10px; right: 10px; background: #ffebee; color: #c62828; padding: 10px; border: 1px solid #e57373; border-radius: 4px; z-index: 1000; max-width: 300px;';
            errorDetail.innerHTML = `
                <strong>ã‚¨ãƒ©ãƒ¼è©³ç´°:</strong><br>
                ${errorMsg}<br>
                <small>ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«(F12)ã§è©³ç´°ã‚’ç¢ºèªã—ã¦ãã ã•ã„</small>
                <button onclick="this.parentNode.remove()" style="float: right; margin-left: 10px;">Ã—</button>
            `;
            document.body.appendChild(errorDetail);
            
            // 5ç§’ í›„ ìë™ ì œê±°
            setTimeout(() => {
                if (errorDetail.parentNode) {
                    errorDetail.remove();
                }
            }, 5000); // 5ç§’å¾Œã«è‡ªå‹•é™¤å»
        }
        
        // ===== ãƒ‡ãƒ¼ã‚¿ãƒ‘ã‚¹å–å¾—ï¼ˆGitHub Pageså¯¾å¿œï¼‰ =====
        function getDataPath() {
            const hostname = window.location.hostname;
            const isGitHubPages = hostname.endsWith('.github.io') || hostname.includes('github');
            
            if (isGitHubPages) {
                // GitHub Pages: ì ˆëŒ€ ê²½ë¡œ ì‚¬ìš©
                const basePath = window.location.pathname.replace('/index.html', '').replace('/', '');
                return basePath ? `/${basePath}/data/standings.json` : '/data/standings.json';
            } else {
                // ë¡œì»¬: ìƒëŒ€ ê²½ë¡œ ì‚¬ìš©  
                return './data/standings.json';
            }
        }
        
        // ===== ãƒ‡ãƒ¼ã‚¿å‹æ­£è¦åŒ–å‡¦ç† =====
        function normalizeStandingsData(data) {
            if (!data) return data;
            
            // ê° ë¦¬ê·¸ì˜ íŒ€ ë°ì´í„° ì •ê·œí™”
            ['central_league', 'pacific_league'].forEach(league => {
                if (data[league]?.standings) {
                    data[league].standings = data[league].standings.map(team => ({
                        ...team,
                        // ë¬¸ìì—´ì„ ìˆ«ìë¡œ ë³€í™˜
                        win_percentage: parseFloat(team.win_percentage) || 0,
                        games_behind: parseFloat(team.games_behind) || 0,
                        wins: parseInt(team.wins) || 0,
                        losses: parseInt(team.losses) || 0,
                        draws: parseInt(team.draws) || 0,
                        games_played: parseInt(team.games_played) || 0,
                        runs_scored: parseInt(team.runs_scored) || 0,
                        runs_allowed: parseInt(team.runs_allowed) || 0,
                        run_differential: parseInt(team.run_differential) || 0
                    }));
                }
            });
            
            return data;
        }
        
        // ===== Home/Away ì”ì—¬ ê³„ì‚° (ì‹¤ì œ ìŠ¤ì¼€ì¤„ ë°ì´í„° ì‚¬ìš©) =====
        function computeHomeAwayRemaining() {
            homeAwayRemainingByTeam = {};
            if (!standingsData) return;

            const allTeams = [...(standingsData.central_league?.standings || []), ...(standingsData.pacific_league?.standings || [])];
            const teamIds = allTeams.map(t => t.team_id);

            // ê¸°ë³¸ê°’: 0ìœ¼ë¡œ ì´ˆê¸°í™”
            teamIds.forEach(id => { homeAwayRemainingByTeam[id] = { home: 0, away: 0, opponents: {} }; });

            // ì‹¤ì œ ìŠ¤ì¼€ì¤„ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì‚¬ìš©
            if (upcomingGamesData && Array.isArray(upcomingGamesData)) {
                upcomingGamesData.forEach(game => {
                    if (game.game_status !== 'scheduled') return;
                    
                    const homeId = game.home_team_id;
                    const awayId = game.away_team_id;
                    
                    // í™ˆíŒ€ ì”ì—¬ í™ˆ ê²Œì„ ì¦ê°€
                    if (homeAwayRemainingByTeam[homeId]) {
                        homeAwayRemainingByTeam[homeId].home++;
                        // ìƒëŒ€íŒ€ ì •ë³´ ì¶”ê°€
                        const opponentAbbr = game.away_team_abbr;
                        homeAwayRemainingByTeam[homeId].opponents[opponentAbbr] = (homeAwayRemainingByTeam[homeId].opponents[opponentAbbr] || 0) + 1;
                    }
                    
                    // ì›ì •íŒ€ ì”ì—¬ ì›ì • ê²Œì„ ì¦ê°€
                    if (homeAwayRemainingByTeam[awayId]) {
                        homeAwayRemainingByTeam[awayId].away++;
                        // ìƒëŒ€íŒ€ ì •ë³´ ì¶”ê°€
                        const opponentAbbr = game.home_team_abbr;
                        homeAwayRemainingByTeam[awayId].opponents[opponentAbbr] = (homeAwayRemainingByTeam[awayId].opponents[opponentAbbr] || 0) + 1;
                    }
                });
            } else {
                // ìŠ¤ì¼€ì¤„ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ê· ë“± ë¶„ë°°ë¡œ í´ë°±
                allTeams.forEach(t => {
                    const remaining = Math.max(0, TOTAL_GAMES - t.games_played);
                    const home = Math.floor(remaining / 2);
                    const away = remaining - home;
                    homeAwayRemainingByTeam[t.team_id] = { home, away, opponents: {} };
                });
            }
        }

        function calculateCurrentStreak(entries) {
            if (!Array.isArray(entries) || !entries.length) {
                return { type: 'none', count: 0 };
            }

            const latestResult = entries[entries.length - 1]?.result;
            if (latestResult === 'W' || latestResult === 'L') {
                let count = 0;
                for (let i = entries.length - 1; i >= 0; i--) {
                    if (entries[i].result === latestResult) {
                        count++;
                    } else {
                        break;
                    }
                }
                return { type: latestResult === 'W' ? 'win' : 'loss', count };
            }

            if (latestResult === 'D') {
                let draws = 0;
                for (let i = entries.length - 1; i >= 0; i--) {
                    if (entries[i].result === 'D') {
                        draws++;
                    } else {
                        break;
                    }
                }
                return { type: 'draw', count: draws };
            }

            return { type: 'none', count: 0 };
        }

        function computeLastTenRecords() {
            lastTenRecordsByTeam = {};
            if (!Array.isArray(gamesData) || !gamesData.length) return;

            const resultsByTeam = {};

            gamesData.forEach(game => {
                const status = (game.game_status || game.status || '').toLowerCase();
                if (status !== 'completed') return;

                const homeId = game.home_team_id;
                const awayId = game.away_team_id;
                if (!homeId || !awayId) return;

                const homeScore = Number(game.home_score);
                const awayScore = Number(game.away_score);
                if (!Number.isFinite(homeScore) || !Number.isFinite(awayScore)) return;

                const rawDate = game.game_date || game.date || '';
                let timestamp = Date.parse(rawDate);
                if (Number.isNaN(timestamp) && rawDate) {
                    timestamp = Date.parse(`${rawDate}T00:00:00`);
                }
                if (Number.isNaN(timestamp)) {
                    timestamp = 0;
                }

                const homeKey = String(homeId);
                const awayKey = String(awayId);
                if (!resultsByTeam[homeKey]) resultsByTeam[homeKey] = [];
                if (!resultsByTeam[awayKey]) resultsByTeam[awayKey] = [];

                let homeResult = 'D';
                let awayResult = 'D';
                if (homeScore > awayScore) {
                    homeResult = 'W';
                    awayResult = 'L';
                } else if (homeScore < awayScore) {
                    homeResult = 'L';
                    awayResult = 'W';
                }

                resultsByTeam[homeKey].push({ ts: timestamp, result: homeResult });
                resultsByTeam[awayKey].push({ ts: timestamp, result: awayResult });
            });

            Object.entries(resultsByTeam).forEach(([teamId, entries]) => {
                entries.sort((a, b) => a.ts - b.ts);
                const recent = entries.slice(-10);
                let wins = 0;
                let losses = 0;
                let draws = 0;
                recent.forEach(entry => {
                    if (entry.result === 'W') wins++;
                    else if (entry.result === 'L') losses++;
                    else draws++;
                });
                const record = `${wins} - ${losses} - ${draws}`;
                const streak = calculateCurrentStreak(entries);
                lastTenRecordsByTeam[teamId] = { record, wins, losses, draws, games: recent.length, streak };
            });
        }

        // ===== ãƒ¡ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å‡¦ç† =====
        async function loadDataEnhanced() {
            try {
                
                // ìˆœìœ„ ë°ì´í„° ë¡œë”© (cache-busting)
                const basePath = getDataPath();
                const cacheBust = `v=${Date.now()}`;
                const dataUrl = basePath + (basePath.includes('?') ? '&' : '?') + cacheBust;
                const response = await fetch(dataUrl, { cache: 'no-store' });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${dataPath}`);
                }
                
                const rawData = await response.json();
                
                // ì‹œì¦Œ ì„¤ì • ë°ì´í„° ë¡œë”© (dashboard.json, cache-busting ë™ì¼ ì ìš©)
                try {
                    const dashboardBase = basePath.replace('standings.json', 'dashboard.json');
                    const dashboardUrl = dashboardBase + (dashboardBase.includes('?') ? '&' : '?') + cacheBust;
                    const dashboardResponse = await fetch(dashboardUrl, { cache: 'no-store' });
                    if (dashboardResponse.ok) {
                        seasonConfig = await dashboardResponse.json();
                        // NPB ì •ê·œì‹œì¦Œì€ íŒ€ë‹¹ 143è©¦åˆ. ëŒ€ì‹œë³´ë“œê°€ ìˆë”ë¼ë„ TOTAL_GAMESëŠ” 143ìœ¼ë¡œ ê³ ì •.
                        if (seasonConfig.season_stats) {
                            const allTeams = [...(rawData.central_league?.standings || []), ...(rawData.pacific_league?.standings || [])];
                            const maxGamesPlayed = Math.max(...allTeams.map(t => t.games_played));
                            TOTAL_GAMES = 143;
                        }
                    }
                } catch (dashboardError) {
                    // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ãªã—ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ä½¿ç”¨
                }
                
                // ê²½ê¸° ë°ì´í„° ë¡œë”© (home/away ì”ì—¬ ê³„ì‚°ìš©)
                try {
                    const gamesBase = basePath.replace('standings.json', 'games.json');
                    const gamesUrl = gamesBase + (gamesBase.includes('?') ? '&' : '?') + cacheBust;
                    const gamesResp = await fetch(gamesUrl, { cache: 'no-store' });
                    if (gamesResp.ok) {
                        gamesData = await gamesResp.json();
                    }
                } catch (gamesError) {}

                // ì”ì—¬ ê²½ê¸° ë°ì´í„° ë¡œë”©
                try {
                    const upcomingBase = basePath.replace('standings.json', 'upcoming.json');
                    const upcomingUrl = upcomingBase + (upcomingBase.includes('?') ? '&' : '?') + cacheBust;
                    const upcomingResp = await fetch(upcomingUrl, { cache: 'no-store' });
                    if (upcomingResp.ok) {
                        upcomingGamesData = await upcomingResp.json();
                    }
                } catch (upcomingError) {}

                // ë°ì´í„° íƒ€ì… ì •ê·œí™”
                standingsData = normalizeStandingsData(rawData);

                if (standingsData.updated_at) {
                    const updated = new Date(standingsData.updated_at).toLocaleString('ja-JP', {
                        timeZone: 'Asia/Tokyo', year: 'numeric', month: '2-digit', day: '2-digit',
                        hour: '2-digit', minute: '2-digit', second: '2-digit'
                    });
                    const lastEl = document.getElementById('last-update');
                    if (lastEl) lastEl.textContent = `${updated} JST`;
                }


                // ì‹¤ì œ í†µê³„ ë°ì´í„° í‘œì‹œ
                if (seasonConfig && seasonConfig.season_stats) {
                    const stats = seasonConfig.season_stats;
                    if (typeof stats.total_games === 'number') {
                        document.getElementById('total-games').textContent = `${stats.total_games}è©¦åˆ`;
                    }
                    // ì˜¤ëŠ˜ ê²½ê¸° ìˆ˜ëŠ” í—¤ë”(ä»Šæ—¥ã®è©¦åˆ) ì˜†ì—ë§Œ í‘œê¸°
                    // dashboardì˜ today_gamesëŠ” ë¬´ì‹œ - ì‹¤ì œ ê³„ì‚°ê°’ ì‚¬ìš©
                }
                
                computeLastTenRecords();
                computeHomeAwayRemaining();
                updateMagicRegular();
                updateMagicPlayoff();
                updateScenarios();
                updateDetailedStandings();
                updateRemainingGames();
                updateProgress();
                // Initialize 'çµŒè·¯ã®æ•°' sub-views (matrix/detailed/table) and default to matrix
                bindScenarioViewToggles();
                setScenarioView('central','matrix');
                setScenarioView('pacific','matrix');
                
            } catch (error) {
                showError(`ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }
        
        // ===== ãƒšãƒ¼ã‚¸çŠ¶æ…‹ã®ä¿å­˜ã¨å¾©å…ƒ =====
        function savePageState() {
            // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã‚’ä¿å­˜
            sessionStorage.setItem('npb-scroll-position', window.scrollY.toString());
        }

        function restorePageState() {
            // ä¿å­˜ã•ã‚ŒãŸã‚¿ãƒ–ãŒã‚ã‚Œã°å¾©å…ƒ
            const savedTab = sessionStorage.getItem('npb-current-tab');
            if (savedTab) {
                const tabElement = document.querySelector(`[data-tab="${savedTab}"]`);
                if (tabElement) {
                    showTab(savedTab, tabElement);
                }
            }

            // ä¿å­˜ã•ã‚ŒãŸã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ãŒã‚ã‚Œã°å¾©å…ƒ
            const savedScrollPosition = sessionStorage.getItem('npb-scroll-position');
            if (savedScrollPosition) {
                const scrollPosition = parseInt(savedScrollPosition, 10);
                // DOMãŒå®Œå…¨ã«èª­ã¿è¾¼ã¾ã‚ŒãŸå¾Œã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
                setTimeout(() => {
                    window.scrollTo(0, scrollPosition);
                }, 100);
            }
        }

        // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã‚’å®šæœŸçš„ã«ä¿å­˜
        let scrollSaveTimer;
        window.addEventListener('scroll', () => {
            clearTimeout(scrollSaveTimer);
            scrollSaveTimer = setTimeout(savePageState, 200);
        });

        // ãƒšãƒ¼ã‚¸é›¢è„±æ™‚ã«çŠ¶æ…‹ã‚’ä¿å­˜
        window.addEventListener('beforeunload', savePageState);

        // Handle browser back/forward buttons
        window.addEventListener('hashchange', () => {
            const hash = window.location.hash.slice(1);
            const validTabs = ['magic-regular', 'magic-playoff', 'progress', 'scenarios', 'standings', 'remaining'];
            if (hash && validTabs.includes(hash)) {
                showTab(hash);
            }
        });

        document.addEventListener('DOMContentLoaded', () => {
            // Restore tab from URL hash
            const hash = window.location.hash.slice(1); // Remove #
            const validTabs = ['magic-regular', 'magic-playoff', 'progress', 'scenarios', 'standings', 'remaining'];

            if (hash && validTabs.includes(hash)) {
                showTab(hash);
            } else {
                // Default to first tab
                showTab('magic-regular');
            }

            loadDataEnhanced();
            restorePageState();

            // Initialize ads safely after page load
            setTimeout(() => {
                initializeAdsAfterLoad();
            }, 500);
        });
        window.reloadData = loadDataEnhanced;

        // ===== ä»Šæ—¥/æ˜æ—¥ã®è©¦åˆæç”» =====
        function formatJSTDateISO(date = new Date()) {
            // Returns YYYY-MM-DD in Asia/Tokyo
            return new Intl.DateTimeFormat('en-CA', {
                timeZone: 'Asia/Tokyo', year: 'numeric', month: '2-digit', day: '2-digit'
            }).format(date);
        }

        // (Removed) JS-driven footer logic. Footer is now static HTML-only.
        function getJSTDate(offsetDays = 0) {
            // Compute date in JST adding offset days
            const now = new Date();
            const ts = now.getTime() + offsetDays * 24 * 60 * 60 * 1000;
            return new Date(ts);
        }

        // íŒ€ ì•½ìë¡œ ë¦¬ê·¸ íŒë‹¨í•˜ëŠ” í—¬í¼ í•¨ìˆ˜
        function getTeamLeague(teamAbbr) {
            // Use canonical abbreviations (YOG, HAN, CHU, YDB, HIR, YAK)
            const centralTeams = ['YOG', 'HAN', 'CHU', 'YDB', 'HIR', 'YAK'];
            const pacificTeams = ['SOF', 'LOT', 'SEI', 'ORI', 'NIP', 'RAK'];
            
            if (centralTeams.includes(teamAbbr)) return 'Central';
            if (pacificTeams.includes(teamAbbr)) return 'Pacific';
            return 'Unknown';
        }

        // ===== ì–¸ì–´ ë³€í™˜ ê¸°ëŠ¥ =====
        const SUPPORTED_LANGUAGES = ['ja', 'ko', 'en'];
        const LANGUAGE_URL_MAP = {
            'ja': 'https://npb-dashboard.com/',
            'ko': 'https://npb-dashboard.com/?lang=ko',
            'en': 'https://npb-dashboard.com/?lang=en',
            'x-default': 'https://npb-dashboard.com/'
        };
        let currentLanguage = 'ja';

        function getLanguageFromUrl() {
            try {
                const params = new URLSearchParams(window.location.search);
                const langParam = params.get('lang');
                if (langParam && SUPPORTED_LANGUAGES.includes(langParam)) {
                    return langParam;
                }
            } catch (err) {
                console.error('Failed to parse language from URL', err);
            }
            return null;
        }

        function syncUrlWithLanguage(lang) {
            try {
                const url = new URL(window.location.href);
                if (lang === 'ja') {
                    url.searchParams.delete('lang');
                } else {
                    url.searchParams.set('lang', lang);
                }
                window.history.replaceState({}, '', url);
            } catch (err) {
                console.error('Failed to sync URL with language', err);
            }
        }

        function updateLanguageLinks(lang) {
            const canonicalEl = document.getElementById('canonical-link');
            const canonicalHref = LANGUAGE_URL_MAP[lang] || LANGUAGE_URL_MAP['ja'];
            if (canonicalEl) {
                canonicalEl.setAttribute('href', canonicalHref);
            }
            document.querySelectorAll('link[data-hreflang]').forEach(link => {
                const code = link.getAttribute('data-hreflang');
                if (LANGUAGE_URL_MAP[code]) {
                    link.setAttribute('href', LANGUAGE_URL_MAP[code]);
                }
            });
        }

        // í˜„ì¬ ì–¸ì–´ ì´ˆê¸°í™” (localStorageì—ì„œ ì½ê¸°)
        function initLanguage() {
            const urlLang = getLanguageFromUrl();
            const savedLang = localStorage.getItem('npb-language');
            if (urlLang && translations[urlLang]) {
                currentLanguage = urlLang;
            } else if (savedLang && translations[savedLang]) {
                currentLanguage = savedLang;
            }
            localStorage.setItem('npb-language', currentLanguage);
            updateLanguage();
            updateActiveLanguageButton();
            updateMetaTags(currentLanguage);
            syncUrlWithLanguage(currentLanguage);
        }
        
        // ì–¸ì–´ ë³€ê²½ í•¨ìˆ˜
        function changeLanguage(lang) {
            if (!translations[lang]) return;
            
            currentLanguage = lang;
            localStorage.setItem('npb-language', lang);
            updateLanguage();
            updateActiveLanguageButton();
            
            // ë©”íƒ€ íƒœê·¸ë„ ì—…ë°ì´íŠ¸
            updateMetaTags(lang);
            syncUrlWithLanguage(lang);
        }
        
        // í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateLanguage() {
            // ì¼ë°˜ í…ìŠ¤íŠ¸ ë²ˆì—­
            const elements = document.querySelectorAll('[data-i18n]');
            elements.forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (translations[currentLanguage] && translations[currentLanguage][key]) {
                    element.textContent = translations[currentLanguage][key];
                }
            });
            
            // HTML ì½˜í…ì¸  ë²ˆì—­ (ë„ì›€ë§ ë“±)
            const htmlElements = document.querySelectorAll('[data-i18n-html]');
            htmlElements.forEach(element => {
                const key = element.getAttribute('data-i18n-html');
                if (translations[currentLanguage] && translations[currentLanguage][key]) {
                    element.innerHTML = translations[currentLanguage][key];
                }
            });
        }
        
        // ì–¸ì–´ ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateActiveLanguageButton() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-lang') === currentLanguage) {
                    btn.classList.add('active');
                }
            });
        }
        
        // ë©”íƒ€ íƒœê·¸ ì—…ë°ì´íŠ¸ (SEOìš©)
        function updateMetaTags(lang) {
            const titleMap = {
                'ja': 'NPB 2025é †ä½è¡¨ãƒ»ãƒã‚¸ãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼ãƒ»ã‚¯ãƒªãƒ³ãƒãƒ»CSé€²å‡ºç¢ºç‡ãƒ»å„ªå‹äºˆæƒ³ | ãƒ—ãƒ­é‡çƒãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹',
                'ko': 'ã€ë§¤ì¼ ìë™ ì—…ë°ì´íŠ¸ã€‘NPB 2025 ìˆœìœ„í‘œÂ·ë§¤ì§ë„˜ë²„Â·í´ë¦°ì¹˜Â·CSì§„ì¶œí™•ë¥ Â·ìš°ìŠ¹ì˜ˆìƒ | í”„ë¡œì•¼êµ¬ ë°ì´í„°ë² ì´ìŠ¤',
                'en': 'ã€Daily Auto-Updateã€‘NPB 2025 Standingsãƒ»Magic Numbersãƒ»Clinchãƒ»CS Playoff Probabilityãƒ»Championship Prediction | Baseball Database'
            };
            
            const descriptionMap = {
                'ja': 'ã€2025å¹´æœ€æ–°ã€‘NPBé †ä½è¡¨ãƒ»ãƒã‚¸ãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼ãƒ»ã‚¯ãƒªãƒ³ãƒãƒ»CSé€²å‡ºç¢ºç‡ãƒ»å„ªå‹äºˆæƒ³ã€‚ã‚»ãƒªãƒ¼ã‚°ãƒ»ãƒ‘ãƒªãƒ¼ã‚°å…¨12çƒå›£ã®å‹ç‡åˆ†æã€æ®‹ã‚Šè©¦åˆæ•°ã€ãƒã‚¹ãƒˆã‚·ãƒ¼ã‚ºãƒ³ã‚·ãƒŠãƒªã‚ªã¾ã§å®Œå…¨ç¶²ç¾…ã€‚å·¨äººãƒ»é˜ªç¥ãƒ»ã‚½ãƒ•ãƒˆãƒãƒ³ã‚¯ãªã©å…¨ãƒãƒ¼ãƒ å¯¾å¿œã€‚',
                'ko': 'ã€2025ë…„ ìµœì‹ ã€‘NPB ìˆœìœ„í‘œÂ·ë§¤ì§ë„˜ë²„Â·í´ë¦°ì¹˜Â·CSì§„ì¶œí™•ë¥ Â·ìš°ìŠ¹ì˜ˆìƒì„ ë§¤ì¼ ìë™ì—…ë°ì´íŠ¸. ì„¼íŠ¸ëŸ´Â·í¼ì‹œí”½ë¦¬ê·¸ ì „12êµ¬ë‹¨ì˜ ìŠ¹ë¥ ë¶„ì„, ë‚¨ì€ê²½ê¸°ìˆ˜, í”Œë ˆì´ì˜¤í”„ ì‹œë‚˜ë¦¬ì˜¤ê¹Œì§€ ì™„ì „ë§ë¼. ìì´ì–¸ì¸ Â·íƒ€ì´ê±°ìŠ¤Â·í˜¸í¬ìŠ¤ ë“± ì „íŒ€ ì§€ì›.',
                'en': 'ã€2025 Latestã€‘Daily auto-update of NPB standings, magic numbers, clinch, CS playoff probability, championship predictions. Complete coverage of all 12 teams from Central & Pacific leagues including win rate analysis, remaining games, playoff scenarios. Giants, Tigers, Hawks and all teams supported.'
            };
            const ogLocaleMap = {
                'ja': 'ja_JP',
                'ko': 'ko_KR',
                'en': 'en_US'
            };
            
            // Title ì—…ë°ì´íŠ¸
            if (titleMap[lang]) {
                document.title = titleMap[lang];
            }
            const ogTitle = document.querySelector('meta[property="og:title"]');
            if (ogTitle && titleMap[lang]) {
                ogTitle.setAttribute('content', titleMap[lang]);
            }
            const twitterTitle = document.querySelector('meta[name="twitter:title"]');
            if (twitterTitle && titleMap[lang]) {
                twitterTitle.setAttribute('content', titleMap[lang]);
            }
            
            // Description ì—…ë°ì´íŠ¸  
            const metaDesc = document.querySelector('meta[name="description"]');
            if (metaDesc && descriptionMap[lang]) {
                metaDesc.setAttribute('content', descriptionMap[lang]);
            }
            const ogDesc = document.querySelector('meta[property="og:description"]');
            if (ogDesc && descriptionMap[lang]) {
                ogDesc.setAttribute('content', descriptionMap[lang]);
            }
            const twitterDesc = document.querySelector('meta[name="twitter:description"]');
            if (twitterDesc && descriptionMap[lang]) {
                twitterDesc.setAttribute('content', descriptionMap[lang]);
            }
            const ogLocale = document.querySelector('meta[property="og:locale"]');
            if (ogLocale) {
                ogLocale.setAttribute('content', ogLocaleMap[lang] || ogLocaleMap['ja']);
            }
            
            // HTML lang ì†ì„± ì—…ë°ì´íŠ¸
            document.documentElement.setAttribute('lang', lang);
            const languageMeta = document.querySelector('meta[name="language"]');
            if (languageMeta) {
                languageMeta.setAttribute('content', lang);
            }
            updateLanguageLinks(lang);
        }
        
        // ë™ì  ì½˜í…ì¸  ë²ˆì—­ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
        function getTranslation(key) {
            return translations[currentLanguage] && translations[currentLanguage][key] ? 
                   translations[currentLanguage][key] : key;
        }
        
        // ì¡°ê±´ ë©”ì‹œì§€ ë²ˆì—­ í•¨ìˆ˜
        function translateCondition(condition) {
            if (!condition) return condition;
            
            // ì •ê·œí‘œí˜„ì‹ì„ ì‚¬ìš©í•˜ì—¬ ë™ì  ë©”ì‹œì§€ ë²ˆì—­
            if (condition.includes('å‹å¿…è¦')) {
                const match = condition.match(/(\d+)å‹å¿…è¦/);
                if (match) {
                    return `${match[1]} ${getTranslation('wins-needed')}`;
                }
            }
            
            if (condition.includes('CSé€²å‡ºã¾ã§') && condition.includes('å‹')) {
                const match = condition.match(/CSé€²å‡ºã¾ã§(\d+)å‹/);
                if (match) {
                    return `${match[1]} ${getTranslation('wins-needed')} for CS`;
                }
            }
            
            // ê³ ì • ë©”ì‹œì§€ ë²ˆì—­
            const conditionMap = {
                'ç¢ºå®š': getTranslation('championship-secured'),
                'å„ªå‹ç¢ºå®šæ¸ˆã¿': getTranslation('championship-secured'),
                'CSé€²å‡ºç¢ºå®š': getTranslation('playoff-advancement-secured'),
                'ãƒ•ã‚¡ã‚¤ãƒŠãƒ«ç›´è¡Œ': currentLanguage === 'ja' ? 'ãƒ•ã‚¡ã‚¤ãƒŠãƒ«ç›´è¡Œ' : 
                               currentLanguage === 'ko' ? 'íŒŒì´ë„ ì§í–‰' : 'Final Direct',
                'ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã‚¹ãƒ†ãƒ¼ã‚¸': currentLanguage === 'ja' ? 'ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã‚¹ãƒ†ãƒ¼ã‚¸' :
                                   currentLanguage === 'ko' ? 'í¼ìŠ¤íŠ¸ ìŠ¤í…Œì´ì§€' : 'First Stage',
                'ä¸å¯èƒ½': currentLanguage === 'ja' ? 'ä¸å¯èƒ½' :
                         currentLanguage === 'ko' ? 'ë¶ˆê°€ëŠ¥' : 'Impossible'
            };
            
            return conditionMap[condition] || condition;
        }
        
        // ìƒíƒœ ë²ˆì—­ í•¨ìˆ˜
        function translateStatus(status) {
            const statusMap = {
                'å„ªå‹æ±ºå®š': getTranslation('championship-decided'),
                'CSç¢ºå®š': getTranslation('playoff-secured'),
                'åœå¤–ç¢ºå®š': getTranslation('eliminated'),
                'å¯èƒ½æ€§ã‚ã‚Š': getTranslation('still-possible')
            };
            return statusMap[status] || status;
        }
        
        // íŒ€ëª… ë²ˆì—­ í•¨ìˆ˜
        function translateTeamName(teamName, isShort = false) {
            if (!teamName) return teamName;
            
            // íŒ€ëª…ì„ í‚¤ë¡œ ë³€í™˜í•˜ëŠ” ë§¤í•‘ í…Œì´ë¸”
            const teamKeyMap = {
                // ì¼ë³¸ì–´ íŒ€ëª… -> í‚¤
                'èª­å£²ã‚¸ãƒ£ã‚¤ã‚¢ãƒ³ãƒ„': 'giants',
                'ã‚¸ãƒ£ã‚¤ã‚¢ãƒ³ãƒ„': 'giants',
                'é˜ªç¥ã‚¿ã‚¤ã‚¬ãƒ¼ã‚¹': 'tigers', 
                'ã‚¿ã‚¤ã‚¬ãƒ¼ã‚¹': 'tigers',
                'ä¸­æ—¥ãƒ‰ãƒ©ã‚´ãƒ³ã‚º': 'dragons',
                'ãƒ‰ãƒ©ã‚´ãƒ³ã‚º': 'dragons',
                'åºƒå³¶æ±æ´‹ã‚«ãƒ¼ãƒ—': 'carp',
                'ã‚«ãƒ¼ãƒ—': 'carp',
                'æ±äº¬ãƒ¤ã‚¯ãƒ«ãƒˆã‚¹ãƒ¯ãƒ­ãƒ¼ã‚º': 'swallows',
                'ã‚¹ãƒ¯ãƒ­ãƒ¼ã‚º': 'swallows',
                'æ¨ªæµœDeNAãƒ™ã‚¤ã‚¹ã‚¿ãƒ¼ã‚º': 'baystars',
                'ãƒ™ã‚¤ã‚¹ã‚¿ãƒ¼ã‚º': 'baystars',
                'ã‚½ãƒ•ãƒˆãƒãƒ³ã‚¯ãƒ›ãƒ¼ã‚¯ã‚¹': 'hawks',
                'ãƒ›ãƒ¼ã‚¯ã‚¹': 'hawks',
                'æ±åŒ—æ¥½å¤©ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¤ãƒ¼ã‚°ãƒ«ã‚¹': 'eagles',
                'ã‚¤ãƒ¼ã‚°ãƒ«ã‚¹': 'eagles',
                'åŸ¼ç‰è¥¿æ­¦ãƒ©ã‚¤ã‚ªãƒ³ã‚º': 'lions',
                'ãƒ©ã‚¤ã‚ªãƒ³ã‚º': 'lions',
                'åƒè‘‰ãƒ­ãƒƒãƒ†ãƒãƒªãƒ¼ãƒ³ã‚º': 'marines',
                'ãƒãƒªãƒ¼ãƒ³ã‚º': 'marines',
                'åŒ—æµ·é“æ—¥æœ¬ãƒãƒ ãƒ•ã‚¡ã‚¤ã‚¿ãƒ¼ã‚º': 'fighters',
                'ãƒ•ã‚¡ã‚¤ã‚¿ãƒ¼ã‚º': 'fighters',
                'ã‚ªãƒªãƒƒã‚¯ã‚¹ãƒãƒ•ã‚¡ãƒ­ãƒ¼ã‚º': 'buffaloes',
                'ãƒãƒ•ã‚¡ãƒ­ãƒ¼ã‚º': 'buffaloes',
                
                // ì˜ì–´ íŒ€ëª… -> í‚¤
                'Giants': 'giants',
                'Tigers': 'tigers',
                'Dragons': 'dragons',
                'Carp': 'carp', 
                'Swallows': 'swallows',
                'BayStars': 'baystars',
                'Hawks': 'hawks',
                'Eagles': 'eagles',
                'Lions': 'lions',
                'Marines': 'marines',
                'Fighters': 'fighters',
                'Buffaloes': 'buffaloes'
            };
            
            // íŒ€ëª…ì—ì„œ í‚¤ ì°¾ê¸°
            let teamKey = teamKeyMap[teamName];
            if (!teamKey) {
                // ë¶€ë¶„ ë§¤ì¹­ ì‹œë„
                for (const [name, key] of Object.entries(teamKeyMap)) {
                    if (teamName.includes(name) || name.includes(teamName)) {
                        teamKey = key;
                        break;
                    }
                }
            }
            
            if (teamKey) {
                const suffix = isShort ? '-short' : '';
                return getTranslation(teamKey + suffix);
            }
            
            return teamName; // ë§¤ì¹­ë˜ì§€ ì•Šìœ¼ë©´ ì›ë˜ ì´ë¦„ ë°˜í™˜
        }
        
        // ì–¸ì–´ ë³€ê²½ì‹œ ë™ì  ì½˜í…ì¸ ë„ ì¬ìƒì„±
        function refreshDynamicContent() {
            if (standingsData) {
                // í…Œì´ë¸” ë°ì´í„° ì¬ìƒì„±
                updateAllTables();
            }
        }
        
        // ëª¨ë“  í…Œì´ë¸” ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (ê¸°ì¡´ í•¨ìˆ˜ë“¤ í˜¸ì¶œ)
        function updateAllTables() {
            // ë§¤ì§ë„˜ë²„ í…Œì´ë¸”
            if (standingsData?.central_league?.standings) {
                updateMagicTable('central-magic-regular', standingsData.central_league.standings, true);
                updateMagicTable('central-magic-playoff', standingsData.central_league.standings, false);
            }
            if (standingsData?.pacific_league?.standings) {
                updateMagicTable('pacific-magic-regular', standingsData.pacific_league.standings, true);
                updateMagicTable('pacific-magic-playoff', standingsData.pacific_league.standings, false);
            }
            
            // ìƒì„¸ ìˆœìœ„í‘œ
            if (standingsData?.central_league?.standings) {
                updateDetailedTable('central-detailed', standingsData.central_league.standings);
            }
            if (standingsData?.pacific_league?.standings) {
                updateDetailedTable('pacific-detailed', standingsData.pacific_league.standings);
            }
        }
        
        // ê¸°ì¡´ changeLanguage í•¨ìˆ˜ ìˆ˜ì •
        const originalChangeLanguage = changeLanguage;
        changeLanguage = function(lang) {
            originalChangeLanguage(lang);
            refreshDynamicContent();
        }
        
        // í˜ì´ì§€ ë¡œë“œì‹œ ì–¸ì–´ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            initLanguage();
        });


        // No JS footer init required; footer is static in HTML.
    </script>

    <!-- AdSense Ad - Mobile -->
    <div style="margin: 20px 0; text-align: center; min-width: 320px;">
    <ins class="adsbygoogle"
         style="display:block; margin: 20px auto; min-width: 300px;"
         data-ad-client="ca-pub-5508768187151867"
         data-ad-slot="7298546648"
         data-ad-format="auto"
         data-full-width-responsive="true"></ins>
    
    </div>

    <!-- Site footer (static) -->
    <footer class="site-footer" role="contentinfo">
        <div class="footer-content">
            <span>Â© 2025 NPB Statistics</span>
            <span>|</span>
            <a href="https://npb-dashboard.com" target="_blank" rel="noopener noreferrer">npb-dashboard.com</a>
        </div>
    </footer>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const gameTicker = document.getElementById('game-ticker');
        if (!gameTicker) return;

        const prevDayBtn = document.getElementById('ticker-prev-day');
        const nextDayBtn = document.getElementById('ticker-next-day');
        const dateDisplay = document.getElementById('ticker-date');
        const gamesContainer = document.getElementById('ticker-games');

        let currentDate = new Date();
        let allGames = [];
        let teamData = {};

        async function fetchGameData() {
            try {
                const [gamesResponse, upcomingResponse, teamsResponse] = await Promise.all([
                    fetch('./data/games.json'),
                    fetch('./data/upcoming.json'),
                    fetch('./data/teams.json')
                ]);
                const games = await gamesResponse.json();
                const upcoming = await upcomingResponse.json();
                const teams = await teamsResponse.json();
                
                allGames = [...games, ...upcoming];
                
                // Create a team map for easy lookup
                if (teams.central_league) {
                    teams.central_league.forEach(team => {
                        teamData[team.team_id] = team;
                    });
                }
                if (teams.pacific_league) {
                    teams.pacific_league.forEach(team => {
                        teamData[team.team_id] = team;
                    });
                }

                updateTicker();
            } catch (error) {
                console.error('Error fetching game data:', error);
                gamesContainer.innerHTML = '<span>Error loading games.</span>';
            }
        }

        function formatDate(date) {
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(today.getDate() - 1);
            const tomorrow = new Date(today);
            tomorrow.setDate(today.getDate() + 1);

            const isToday = date.toDateString() === today.toDateString();
            const isYesterday = date.toDateString() === yesterday.toDateString();
            const isTomorrow = date.toDateString() === tomorrow.toDateString();

            const dateOptions = { month: 'long', day: 'numeric', timeZone: 'Asia/Tokyo' };
            const dayOptions = { weekday: 'short', timeZone: 'Asia/Tokyo' };
            const dateStr = date.toLocaleDateString('ja-JP', dateOptions);
            const dayStr = date.toLocaleDateString('ja-JP', dayOptions);

            if (isToday) {
                return `${dateStr}<br><span style="font-size: 11px; color: #0066cc;">ä»Šæ—¥ (${dayStr})</span>`;
            } else if (isYesterday) {
                return `${dateStr}<br><span style="font-size: 11px; color: #666;">æ˜¨æ—¥ (${dayStr})</span>`;
            } else if (isTomorrow) {
                return `${dateStr}<br><span style="font-size: 11px; color: #666;">æ˜æ—¥ (${dayStr})</span>`;
            }

            return `${dateStr}<br><span style="font-size: 11px; color: #666;">${dayStr}</span>`;
        }

        function getGamesForDate(date) {
            const dateString = date.toISOString().split('T')[0];
            const gamesForDate = allGames.filter(game => (game.date === dateString || game.game_date === dateString));

            // Group games by team matchup
            const gamesByMatchup = new Map();

            gamesForDate.forEach(game => {
                // Create normalized key regardless of home/away order
                const teams = [game.home_team_abbr, game.away_team_abbr].sort();
                const key = `${teams[0]}-${teams[1]}`;
                const status = game.status || game.game_status || 'scheduled';

                if (!gamesByMatchup.has(key)) {
                    gamesByMatchup.set(key, []);
                }
                gamesByMatchup.get(key).push({ ...game, resolved_status: status });
            });

            // For each matchup, prefer completed games over scheduled ones
            const uniqueGames = [];
            gamesByMatchup.forEach(games => {
                // Sort by status priority: completed > postponed > scheduled
                games.sort((a, b) => {
                    const statusPriority = { 'completed': 0, 'postponed': 1, 'scheduled': 2 };
                    return (statusPriority[a.resolved_status] || 2) - (statusPriority[b.resolved_status] || 2);
                });

                // Take the highest priority game
                uniqueGames.push(games[0]);
            });

            return uniqueGames;
        }

        function getTeamShortName(teamId) {
            return teamData[teamId]?.team_abbreviation || teamId;
        }

        function getTeamLogo(teamId) {
            const abbr = getTeamShortName(teamId);
            const src = TEAM_LOGOS[abbr] || '';
            return src ? `<img class="ticker-team-logo" src="${src}" alt="${abbr}">` : '';
        }

        function renderGames(games) {
            if (games.length === 0) {
                gamesContainer.innerHTML = '<span style="color: #666; font-size: 13px;">æœ¬æ—¥ã®è©¦åˆã¯ã‚ã‚Šã¾ã›ã‚“</span>';
                return;
            }

            // Sort games: completed games first, then scheduled games
            games.sort((a, b) => {
                const statusA = a.status || a.game_status || 'scheduled';
                const statusB = b.status || b.game_status || 'scheduled';

                // Completed games come first
                if (statusA === 'completed' && statusB !== 'completed') return -1;
                if (statusA !== 'completed' && statusB === 'completed') return 1;

                // Within same status, sort by league (Central first, then Pacific)
                const leagueA = a.league || 'Unknown';
                const leagueB = b.league || 'Unknown';
                return leagueA.localeCompare(leagueB);
            });

            const html = games.map(game => {
                // Use team abbreviations directly since they're always available
                const homeTeamAbbr = game.home_team_abbr;
                const awayTeamAbbr = game.away_team_abbr;

                // Convert to Japanese short names (first 2-3 characters)
                const teamShortNames = {
                    'YOG': 'å·¨äºº',
                    'HAN': 'é˜ªç¥',
                    'CHU': 'ä¸­æ—¥',
                    'HIR': 'åºƒå³¶',
                    'YDB': 'æ¨ªæµœ',
                    'YAK': 'ãƒ¤ã‚¯ãƒ«ãƒˆ',
                    'SOF': 'ã‚½ãƒ•ãƒˆãƒãƒ³ã‚¯',
                    'LOT': 'ãƒ­ãƒƒãƒ†',
                    'SEI': 'è¥¿æ­¦',
                    'ORI': 'ã‚ªãƒªãƒƒã‚¯ã‚¹',
                    'NIP': 'æ—¥ãƒãƒ ',
                    'RAK': 'æ¥½å¤©'
                };

                const homeTeamName = teamShortNames[homeTeamAbbr] || homeTeamAbbr;
                const awayTeamName = teamShortNames[awayTeamAbbr] || awayTeamAbbr;
                const homeScore = game.home_score;
                const awayScore = game.away_score;
                const status = game.status || game.game_status || 'scheduled';

                // Extract time and venue from stadium field
                let gameTime = '';
                let venue = game.stadium || '';

                // Parse time from stadium field if it contains time (e.g., "æ±äº¬ãƒ‰ãƒ¼ãƒ  18ï¼š00")
                // Only for scheduled games (upcoming.json has time, games.json doesn't)
                if (status === 'scheduled' && venue && venue.includes(' ')) {
                    const parts = venue.split(' ');
                    if (parts[parts.length - 1].includes('ï¼š')) {
                        gameTime = parts.pop();
                        venue = parts.join(' ');
                    }
                }

                // Get team logo directly using abbreviation
                const homeTeamLogo = TEAM_LOGOS[homeTeamAbbr] ?
                    `<img class="ticker-team-logo" src="${TEAM_LOGOS[homeTeamAbbr]}" alt="${homeTeamName}">` : '';
                const awayTeamLogo = TEAM_LOGOS[awayTeamAbbr] ?
                    `<img class="ticker-team-logo" src="${TEAM_LOGOS[awayTeamAbbr]}" alt="${awayTeamName}">` : '';

                if (status === 'completed') {
                    const isDraw = game.is_draw || (homeScore === awayScore);
                    const awayWin = awayScore > homeScore;
                    const homeWin = homeScore > awayScore;

                    return `
                        <div class="ticker-game">
                            <div style="display: flex; align-items: center; gap: 4px;">
                                <div class="ticker-team${awayWin ? ' winner' : ''}">
                                    ${awayTeamLogo}
                                    <span class="ticker-team-name">${awayTeamName}</span>
                                    <span class="ticker-score">${awayScore}</span>
                                </div>
                                <span style="margin: 0 2px; color: #999;">-</span>
                                <div class="ticker-team${homeWin ? ' winner' : ''}">
                                    <span class="ticker-score">${homeScore}</span>
                                    <span class="ticker-team-name">${homeTeamName}</span>
                                    ${homeTeamLogo}
                                </div>
                                <div class="ticker-status" style="margin-left: 8px; color: ${isDraw ? '#666' : '#d32f2f'}; font-weight: bold; text-align: center; display: flex; flex-direction: column; justify-content: center; line-height: 1;">
                                    <div>${isDraw ? 'å¼•åˆ†' : 'çµ‚äº†'}</div>
                                    <div style="font-size: 11px; color: #666; font-weight: normal; margin-top: -2px;">${game.innings || '9'}å›</div>
                                </div>
                            </div>
                            <div class="ticker-venue" style="display: flex; justify-content: center; font-size: 10px; color: #888; margin-top: 1px;">
                                ${venue ? `<span>${venue.replace('ã‚¹ã‚¿ã‚¸ã‚¢ãƒ ', '').replace('çƒå ´', '').replace('ãƒ‰ãƒ¼ãƒ ', '').replace('MAZDA Zoom-Zoom ', '').replace('PayPay', '').trim()}</span>` : ''}
                            </div>
                        </div>
                    `;
                } else if (status === 'postponed') {
                    return `
                        <div class="ticker-game">
                            <div style="display: flex; align-items: center; gap: 4px;">
                                <div class="ticker-team">
                                    ${awayTeamLogo}
                                    <span class="ticker-team-name">${awayTeamName}</span>
                                </div>
                                <span style="margin: 0 2px;">vs</span>
                                <div class="ticker-team">
                                    <span class="ticker-team-name">${homeTeamName}</span>
                                    ${homeTeamLogo}
                                </div>
                                <span class="ticker-status" style="margin-left: 8px; color: #f57c00; font-weight: bold;">å»¶æœŸ</span>
                            </div>
                            <div class="ticker-venue" style="display: flex; justify-content: center; font-size: 10px; color: #888; margin-top: 1px;">
                                ${venue ? `<span>${venue.replace('ã‚¹ã‚¿ã‚¸ã‚¢ãƒ ', '').replace('çƒå ´', '').replace('ãƒ‰ãƒ¼ãƒ ', '').replace('MAZDA Zoom-Zoom ', '').replace('PayPay', '').trim()}</span>` : ''}
                            </div>
                        </div>
                    `;
                } else {
                    // Scheduled game
                    return `
                        <div class="ticker-game">
                            <div style="display: flex; align-items: center; gap: 4px;">
                                <div class="ticker-team">
                                    ${awayTeamLogo}
                                    <span class="ticker-team-name">${awayTeamName}</span>
                                </div>
                                <span style="margin: 0 2px;">vs</span>
                                <div class="ticker-team">
                                    <span class="ticker-team-name">${homeTeamName}</span>
                                    ${homeTeamLogo}
                                </div>
                            </div>
                            <div class="ticker-venue" style="display: flex; justify-content: center; font-size: 11px; color: #666; margin-top: 1px;">
                                ${gameTime ? `<span style="color: #0066cc; font-weight: bold; margin-right: 3px; font-size: 11px;">${gameTime}</span>` : ''}
                                ${venue ? `<span>${venue.replace('ã‚¹ã‚¿ã‚¸ã‚¢ãƒ ', '').replace('çƒå ´', '').trim()}</span>` : ''}
                            </div>
                        </div>
                    `;
                }
            }).join('');

            gamesContainer.innerHTML = html;
        }

        function updateTicker() {
            dateDisplay.innerHTML = formatDate(currentDate);
            const games = getGamesForDate(currentDate);
            renderGames(games);

            // Check if content overflows and apply scrolling animation
            setTimeout(() => {
                const container = document.querySelector('.ticker-games-container');
                const content = document.querySelector('.ticker-games');

                if (container && content) {
                    const containerWidth = container.clientWidth;
                    const contentWidth = content.scrollWidth;

                    if (contentWidth > containerWidth) {
                        content.classList.add('scrolling');
                    } else {
                        content.classList.remove('scrolling');
                    }
                }
            }, 100);
        }

        window.goToToday = function() {
            currentDate = new Date();
            updateTicker();
        }

        prevDayBtn.addEventListener('click', () => {
            currentDate.setDate(currentDate.getDate() - 1);
            updateTicker();
        });

        nextDayBtn.addEventListener('click', () => {
            currentDate.setDate(currentDate.getDate() + 1);
            updateTicker();
        });

        fetchGameData();
    });
    </script>
</body>
</html>
