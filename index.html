<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NPB ëŒ€ì‹œë³´ë“œ v3</title>
    <!-- Design System CSS -->
    <link rel="stylesheet" href="css/tokens.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/npb-specific.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸŸï¸ NPB ëŒ€ì‹œë³´ë“œ</h1>
            <p>ì¼ë³¸ í”„ë¡œì•¼êµ¬ 2025ì‹œì¦Œ ìˆœìœ„ ë° í†µê³„ ë¶„ì„</p>
            <div class="controls">
                <span style="margin-left: auto; color: #6b7280; font-size: 14px;">
                    ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: <span id="last-update">ë¡œë”© ì¤‘...</span>
                </span>
            </div>
        </div>
        
        <!-- ë§¤ì§ë„˜ë²„ í˜„í™© ì¹´ë“œ -->
        <div class="magic-status-card" id="magic-status-card" style="display: none;">
            <div class="magic-status-title">
                <span>ğŸ“Š</span>
                <span>ë§¤ì§ë„˜ë²„ í˜„í™©</span>
            </div>
            <div class="magic-status-grid">
                <div class="magic-status-item">
                    <div class="magic-status-label">ìš°ìŠ¹/ì§„ì¶œ í™•ì •</div>
                    <div class="magic-status-value">
                        <span id="clinched-count">0</span>
                        <span class="magic-status-unit">íŒ€</span>
                    </div>
                </div>
                <div class="magic-status-item">
                    <div class="magic-status-label">íƒˆë½ í™•ì •</div>
                    <div class="magic-status-value">
                        <span id="eliminated-count">0</span>
                        <span class="magic-status-unit">íŒ€</span>
                    </div>
                </div>
                <div class="magic-status-item">
                    <div class="magic-status-label">ê²½ìŸ ì¤‘</div>
                    <div class="magic-status-value">
                        <span id="competing-count">0</span>
                        <span class="magic-status-unit">íŒ€</span>
                    </div>
                </div>
                <div class="magic-status-item">
                    <div class="magic-status-label">í‰ê·  ë§¤ì§ë„˜ë²„</div>
                    <div class="magic-status-value">
                        <span id="avg-magic-number">0</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="initialization-error">
            <!-- ì´ˆê¸°í™” ì˜¤ë¥˜ ë©”ì‹œì§€ -->
        </div>
        
        <div class="tab-nav">
            <button class="tab-button active" data-tab="standings">ìˆœìœ„</button>
            <button class="tab-button" data-tab="magic-number">ë§¤ì§ë„˜ë²„</button>
            <button class="tab-button" data-tab="home-away">í™ˆ/ì›ì •</button>
            <button class="tab-button" data-tab="head-to-head">ìƒëŒ€ì „ì </button>
            <button class="tab-button" data-tab="season-progress">ì‹œì¦Œ ì§„í–‰</button>
            <button class="tab-button" data-tab="trends-analysis">ì¶”ì´ ë¶„ì„</button>
            <button class="tab-button" data-tab="interleague">êµë¥˜ì „</button>
            <button class="tab-button" data-tab="team-schedule">íŒ€ë³„ ì¼ì •</button>
        </div>
        
        <div id="standings-tab" class="tab-content active">
            <div id="standings-container">
                <div class="loading-indicator">ìˆœìœ„ ë°ì´í„° ë¡œë”© ì¤‘...</div>
            </div>
        </div>
        
        <div id="magic-number-tab" class="tab-content">
            <div id="magic-number-container">
                <div class="loading-indicator">ë§¤ì§ë„˜ë²„ ê³„ì‚° ì¤‘...</div>
            </div>
        </div>
        
        <div id="season-progress-tab" class="tab-content">
            <div id="season-progress-container">
                <div class="loading-indicator">ì‹œì¦Œ ì§„í–‰ë¥  ê³„ì‚° ì¤‘...</div>
            </div>
        </div>

        <div id="trends-analysis-tab" class="tab-content">
            <div id="trends-analysis-container">
                <div class="loading-indicator">ì¶”ì´ ë¶„ì„ ë°ì´í„° ë¡œë”© ì¤‘...</div>
            </div>
        </div>


        <div id="home-away-tab" class="tab-content">
            <div id="home-away-container">
                <div class="loading-indicator">í™ˆ/ì›ì • ë¶„ì„ ë°ì´í„° ë¡œë”© ì¤‘...</div>
            </div>
        </div>

        <div id="head-to-head-tab" class="tab-content">
            <div id="head-to-head-container">
                <div class="loading-indicator">ìƒëŒ€ì „ì  ë°ì´í„° ë¡œë”© ì¤‘...</div>
            </div>
        </div>


        <div id="team-schedule-tab" class="tab-content">
            <div id="team-schedule-container">
                <div class="loading-indicator">íŒ€ë³„ ì¼ì • ë¡œë”© ì¤‘...</div>
            </div>
        </div>


        <div id="interleague-tab" class="tab-content">
            <div id="interleague-container">
                <div class="loading-indicator">êµë¥˜ì „ ë°ì´í„° ë¡œë”© ì¤‘...</div>
            </div>
        </div>

    </div>
    
    <div id="debug-panel">
        <div id="debug-info">
            <!-- ë””ë²„ê·¸ ì •ë³´ -->
        </div>
    </div>

    <!-- ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¨¼ì € ë¡œë“œ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    
    <!-- NPB JavaScript ëª¨ë“ˆë“¤ ìˆœì°¨ì ìœ¼ë¡œ ë¡œë“œ -->
    <!-- í•µì‹¬ ìœ í‹¸ë¦¬í‹° ëª¨ë“ˆë“¤ ë¨¼ì € ë¡œë“œ -->
    <script src="js/core/utils.js?v=2"></script>
    <script src="js/core/data-manager.js?v=2"></script>
    <script src="js/core/api-client.js?v=2"></script>
    <script src="js/core/table-sort.js?v=1"></script>
    <script src="js/core/unified-table.js?v=1"></script>
    
    <!-- í…Œì´ë¸” ëª¨ë“ˆë“¤ ë¡œë“œ -->
    <script src="js/tables/standings.js?v=2"></script>
    <script src="js/tables/home-away.js?v=3"></script>
    <script src="js/tables/magic-number.js?v=2"></script>
    <script src="js/tables/head-to-head.js?v=2"></script>
    <script src="js/tables/interleague.js?v=2"></script>
    <script src="js/tables/extra-tabs.js?v=2"></script>
    
    <!-- ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ë§ˆì§€ë§‰ì— ë¡œë“œ -->
    <script src="js/app.js?v=2"></script>
    
    <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ ë° í•µì‹¬ ê¸°ëŠ¥ ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
        // íƒ­ ë„¤ë¹„ê²Œì´ì…˜ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');
            
            // íƒ­ ì „í™˜ í•¨ìˆ˜
            const switchToTab = (targetTab, animate = true) => {
                // í˜„ì¬ í™œì„± íƒ­ ì°¾ê¸°
                const currentActive = document.querySelector('.tab-content.active');
                
                // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
                tabButtons.forEach(btn => btn.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));
                
                // ìƒˆ íƒ­ í™œì„±í™”
                const targetButton = document.querySelector(`[data-tab="${targetTab}"]`);
                const targetContent = document.getElementById(`${targetTab}-tab`);
                
                if (targetButton && targetContent) {
                    targetButton.classList.add('active');
                    targetContent.classList.add('active');
                    
                    // ìŠ¤í¬ë¡¤ì„ íƒ­ìœ¼ë¡œ ì´ë™ (ëª¨ë°”ì¼ì—ì„œ ìœ ìš©)
                    if (window.innerWidth <= 768) {
                        targetButton.scrollIntoView({ 
                            behavior: 'smooth', 
                            block: 'nearest', 
                            inline: 'center' 
                        });
                    }
                }
            };
            
            // íƒ­ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
            tabButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetTab = button.dataset.tab;
                    switchToTab(targetTab);
                });
            });
            
            // í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜ ì§€ì›
            document.addEventListener('keydown', (e) => {
                const activeTab = document.querySelector('.tab-button.active');
                if (!activeTab) return;
                
                let newTab = null;
                if (e.key === 'ArrowRight') {
                    newTab = activeTab.nextElementSibling;
                } else if (e.key === 'ArrowLeft') {
                    newTab = activeTab.previousElementSibling;
                }
                
                if (newTab && newTab.classList.contains('tab-button')) {
                    e.preventDefault();
                    switchToTab(newTab.dataset.tab);
                }
            });
            
            // ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„ ì—…ë°ì´íŠ¸
            const updateLastUpdateTime = () => {
                const lastUpdateElement = document.getElementById('last-update');
                if (lastUpdateElement) {
                    const now = new Date();
                    const options = {
                        year: 'numeric', 
                        month: '2-digit', 
                        day: '2-digit',
                        hour: '2-digit', 
                        minute: '2-digit',
                        timeZone: 'Asia/Tokyo'
                    };
                    lastUpdateElement.textContent = now.toLocaleString('ja-JP', options);
                }
            };
            
            // ì„œë¸Œ íƒ­ ë„¤ë¹„ê²Œì´ì…˜ ì´ˆê¸°í™”
            const initializeSubTabs = () => {
                const subTabButtons = document.querySelectorAll('.sub-tab-btn');
                const subContents = document.querySelectorAll('.sub-content');
                
                subTabButtons.forEach(button => {
                    button.addEventListener('click', (e) => {
                        e.preventDefault();
                        const targetSubTab = button.dataset.subtab;
                        const parentContainer = button.closest('.tab-content');
                        const parentContainerId = parentContainer.id.replace('-tab', '-container');
                        
                        // í•´ë‹¹ ë¶€ëª¨ íƒ­ ë‚´ì˜ ì„œë¸Œ íƒ­ë“¤ë§Œ ì²˜ë¦¬
                        const siblingButtons = parentContainer.querySelectorAll('.sub-tab-btn');
                        const siblingContents = parentContainer.querySelectorAll('.sub-content');
                        
                        // ëª¨ë“  ì„œë¸Œ íƒ­ ë¹„í™œì„±í™”
                        siblingButtons.forEach(btn => btn.classList.remove('active'));
                        siblingContents.forEach(content => content.classList.remove('active'));
                        
                        // í´ë¦­ëœ ì„œë¸Œ íƒ­ í™œì„±í™”
                        button.classList.add('active');
                        const targetContent = parentContainer.querySelector(`#${targetSubTab}-content`);
                        if (targetContent) {
                            targetContent.classList.add('active');
                        }
                        
                        // í•´ë‹¹ í…Œì´ë¸” ì¸ìŠ¤í„´ìŠ¤ì˜ ì„œë¸Œíƒ­ ì „í™˜
                        if (window.npbDashboard && window.npbDashboard.tables) {
                            const tableInstance = Object.values(window.npbDashboard.tables)
                                .find(table => table.container && table.container.id === parentContainerId);
                            
                            if (tableInstance && typeof tableInstance.switchSubTab === 'function') {
                                tableInstance.switchSubTab(targetSubTab);
                            } else if (tableInstance && tableInstance.currentSubTab !== undefined) {
                                tableInstance.currentSubTab = targetSubTab;
                                if (typeof tableInstance.renderCurrentSubTab === 'function') {
                                    tableInstance.renderCurrentSubTab();
                                }
                            }
                        }
                    });
                });
            };
            
            // ì´ˆê¸° ì—…ë°ì´íŠ¸ ì‹œê°„ ì„¤ì •
            updateLastUpdateTime();
            
            // ì„œë¸Œ íƒ­ ì´ˆê¸°í™”
            initializeSubTabs();
            
            // 1ë¶„ë§ˆë‹¤ ì—…ë°ì´íŠ¸ ì‹œê°„ ê°±ì‹ 
            setInterval(updateLastUpdateTime, 60000);
        });
    </script>
</body>
</html>
