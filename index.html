<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="NPB(日本プロ野球)2025年シーズンの順位表、マジックナンバー、プレーオフ進出状況を詳細に追跡。セントラル・パシフィック両リーグのリアルタイム成績、勝率計算、残り試合分析。">
    <meta name="keywords" content="プロ野球, NPB, 順位表, マジック, 優勝, プレーオフ, CS, クライマックスシリーズ, セリーグ, パリーグ, 日本シリーズ, 野球速報, 野球結果, 残り試合, 勝率, 巨人, 阪神, 中日, 広島, ヤクルト, 横浜, ソフトバンク, 楽天, 西武, ロッテ, 日ハム, オリックス, 野球ニュース, スポーツ, 2025年">
    <meta name="author" content="NPB Statistics">
    <meta name="robots" content="index, follow">
    <meta name="language" content="ja">
    <link rel="canonical" href="https://sanghunbruceham.github.io/npb/">
    
    <title>NPB 2025 順位表・マジックナンバー | 日本プロ野球リアルタイム成績</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="20250902_2341_NPB 대시보드 아이콘_simple_compose_01k45dz9pjetvtptav6rv4m473.png">
    <link rel="icon" type="image/png" sizes="16x16" href="20250902_2341_NPB 대시보드 아이콘_simple_compose_01k45dz9pjetvtptav6rv4m473.png">
    <link rel="apple-touch-icon" href="20250902_2341_NPB 대시보드 아이콘_simple_compose_01k45dz9pjetvtptav6rv4m473.png">
    <link rel="shortcut icon" href="20250902_2341_NPB 대시보드 아이콘_simple_compose_01k45dz9pjetvtptav6rv4m473.png">
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://sanghunbruceham.github.io/npb/">
    <meta property="og:title" content="NPB 2025 順位表・マジックナンバー | 日本プロ野球リアルタイム成績">
    <meta property="og:description" content="NPB(日本プロ野球)2025年シーズンの順位表、マジックナンバー、プレーオフ進出状況をリアルタイム追跡">
    <meta property="og:image" content="https://sanghunbruceham.github.io/npb/images/npb-og-image.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="NPB Statistics">
    <meta property="og:locale" content="ja_JP">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://sanghunbruceham.github.io/npb/">
    <meta name="twitter:title" content="NPB 2025 順位表・マジックナンバー">
    <meta name="twitter:description" content="NPB(日本プロ野球)2025年シーズンの順位表、マジックナンバー、プレーオフ進出状況をリアルタイム追跡">
    <meta name="twitter:image" content="https://sanghunbruceham.github.io/npb/images/npb-og-image.jpg">
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-LFKN46L0P6"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);} 
      gtag('js', new Date());
      gtag('config', 'G-LFKN46L0P6');
    </script>
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SportsOrganization",
      "name": "NPB Statistics",
      "description": "NPB(日本プロ野球)2025年シーズンの順位表とマジックナンバー情報",
      "url": "https://sanghunbruceham.github.io/npb/",
      "sport": "Baseball",
      "foundingDate": "2025",
      "knowsAbout": [
        "日本プロ野球",
        "NPB",
        "セントラルリーグ",
        "パシフィックリーグ",
        "マジックナンバー",
        "プレーオフ"
      ],
      "mainEntity": {
        "@type": "SportsEvent",
        "name": "NPB 2025 Regular Season",
        "startDate": "2025-03-29",
        "endDate": "2025-10-31",
        "sport": "Baseball",
        "organizer": {
          "@type": "SportsOrganization",
          "name": "Nippon Professional Baseball"
        }
      }
    }
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body { 
            font-family: Arial, sans-serif; 
            background: white; 
            color: black; 
            font-size: 14px; 
            line-height: 1.4;
            min-width: 320px;
        }
        
        .header { 
            background: #333; 
            color: white; 
            padding: 10px 20px;
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .site-name {
            font-size: 16px;
            font-weight: bold;
            color: white;
            text-decoration: none;
        }
        
        h1 { 
            font-size: 18px; 
            margin: 0; 
            font-weight: bold;
        }
        
        .nav { 
            background: #f5f5f5; 
            border-bottom: 2px solid #ddd;
            width: 100%;
        }
        
        .nav-tabs { 
            display: flex; 
            max-width: 1200px; 
            margin: 0 auto;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .nav-tab { 
            padding: 12px 20px; 
            cursor: pointer; 
            border-right: 1px solid #ddd; 
            font-size: 14px; 
            background: #f5f5f5; 
            border: none; 
            font-family: inherit;
            flex: 1;
            min-width: 150px;
            text-align: center;
        }
        
        .nav-tab:hover { 
            background: #e9e9e9; 
        }
        
        .nav-tab.active { 
            background: white; 
            font-weight: bold; 
            border-bottom: 2px solid #0066cc; 
        }
        
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px;
            width: 100%;
        }
        
        .tab-content { 
            display: none; 
        }
        
        .tab-content.active { 
            display: block; 
        }
        
        h2 { 
            font-size: 16px; 
            margin: 15px 0 8px 0; 
            font-weight: bold; 
        }
        
        h3 {
            font-size: 14px;
            margin: 10px 0;
            font-weight: bold;
        }
        
        table { 
            border-collapse: collapse; 
            width: 100%; 
            margin: 10px 0; 
        }
        
        th, td { 
            border: 1px solid #ddd; 
            padding: 6px 8px; 
            text-align: left; 
            font-size: 13px; 
            white-space: nowrap; 
        }
        
        th { 
            background: #f5f5f5; 
            font-weight: bold; 
        }
        
        tr:nth-child(even) { 
            background: #f9f9f9; 
        }
        
        .leagues { 
            display: grid; 
            /* Always stack leagues vertically (Central above Pacific) */
            grid-template-columns: 1fr; 
            gap: 30px; 
            margin: 20px 0; 
        }
        
        .center { 
            text-align: center; 
        }
        
        .right { 
            text-align: right; 
        }
        
        .rank1 { 
            background: #fff3cd; 
        }
        
        .rank2 { 
            background: #f0f0f0; 
        }
        
        .rank3 { 
            background: #ffeedd; 
        }
        
        .win { 
            color: #0066cc; 
        }
        
        .loss { 
            color: #cc0000; 
        }
        
        .pct { 
            font-weight: bold; 
        }
        
        .info { 
            font-size: 12px; 
            color: #666; 
            margin: 10px 0;
            text-align: center;
        }
        
        .loading { 
            text-align: center; 
            padding: 20px; 
            color: #666; 
        }
        
        .magic-number { 
            font-size: 24px; 
            font-weight: bold; 
            color: #0066cc; 
        }
        
        .eliminated { 
            color: #cc0000; 
        }
        
        .clinched { 
            color: #00aa00; 
        }
        
        .scroll-table { 
            overflow-x: auto; 
        }
        
        @media (max-width: 768px) { 
            .leagues { 
                grid-template-columns: 1fr; 
                gap: 20px; 
            } 
            
            .container { 
                padding: 10px; 
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .nav-tab {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #ddd;
            }
            
            table { 
                font-size: 11px; 
            }
            
            th, td { 
                padding: 4px 6px; 
            }
            
            .nav-tab { 
                padding: 10px 12px; 
                font-size: 12px; 
            }
            
            .scroll-table {
                width: 100%;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .scroll-table table {
                min-width: 600px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <a href="/npb/" class="site-name">NPB Dashboard</a>
            <h1>NPB 2025 シーズン</h1>
        </div>
    </div>
    
    <div class="nav">
        <div class="nav-tabs">
            <div class="nav-tab active" onclick="showTab('magic-regular')">正規シーズン優勝マジック</div>
            <div class="nav-tab" onclick="showTab('magic-playoff')">プレーオフマジック</div>
            <div class="nav-tab" onclick="showTab('scenarios')">経路の数</div>
            <div class="nav-tab" onclick="showTab('standings')">チーム順位</div>
            <div class="nav-tab" onclick="showTab('remaining')">残り試合数</div>
        </div>
    </div>

    <div class="container">
        <div class="info">
            最終更新: <span id="last-update">読み込み中...</span> | 
            総試合数: <span id="total-games">758試合</span> |
            今日の試合: <span id="today-games">5試合</span>
        </div>
        
        <!-- Regular Season Magic Numbers -->
        <div id="magic-regular" class="tab-content active">
            <h2>正規シーズン優勝マジックナンバー</h2>
            
            <div style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px; padding: 12px; margin: 15px 0; font-size: 13px; color: #495057;">
                <strong>📊 マジック / エリミネーションの定義</strong><br>
                <div style="margin-top: 8px; line-height: 1.5;">
                • <strong>総試合数</strong>: NPBは各チーム<strong>143試合</strong><br>
                • <strong>勝率</strong>: 勝 / (勝 + 敗)（分は勝率に含めない）<br>
                • <strong>優勝マジック</strong>: (2位の<strong>最大可能勝数</strong>) − (1位の現在勝数) + 1（0以下で✓）<br>
                • <strong>エリミネート(E)</strong>: 1位勝数 ＞ チーム最大可能勝数, または <code>(143+1) − 1位勝 − チーム敗 ≤ 0</code><br>
                • <strong>記号</strong>: <strong>✓</strong>＝確定, <strong>E</strong>＝不可能, <strong>-</strong>＝該当なし
                </div>
            </div>
            
            <div class="leagues">
                <div>
                    <h3>セントラルリーグ</h3>
                    <table>
                        <thead>
                            <tr>
                                <th class="center">順位</th>
                                <th>チーム</th>
                                <th class="center">試合</th>
                                <th class="center">勝</th>
                                <th class="center">敗</th>
                                <th class="center">分</th>
                                <th class="center">勝率</th>
                                <th class="center">ゲーム差</th>
                                <th class="center">残り試合</th>
                                <th class="center">最大勝</th>
                                <th class="center">1位条件</th>
                                <th class="center">マジック</th>
                                <th class="center">エリミネート</th>
                                <th class="center">進出状況</th>
                            </tr>
                        </thead>
                        <tbody id="central-magic-regular">
                            <tr><td colspan="14" class="loading">読み込み中...</td></tr>
                        </tbody>
                    </table>
                </div>
                <div>
                    <h3>パシフィックリーグ</h3>
                    <table>
                        <thead>
                            <tr>
                                <th class="center">順位</th>
                                <th>チーム</th>
                                <th class="center">試合</th>
                                <th class="center">勝</th>
                                <th class="center">敗</th>
                                <th class="center">分</th>
                                <th class="center">勝率</th>
                                <th class="center">ゲーム差</th>
                                <th class="center">残り試合</th>
                                <th class="center">最大勝</th>
                                <th class="center">1位条件</th>
                                <th class="center">マジック</th>
                                <th class="center">エリミネート</th>
                                <th class="center">進出状況</th>
                            </tr>
                        </thead>
                        <tbody id="pacific-magic-regular">
                            <tr><td colspan="14" class="loading">読み込み中...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Playoff Magic Numbers -->
        <div id="magic-playoff" class="tab-content">
            <h2>プレーオフ進出マジックナンバー</h2>
            
            <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 4px; padding: 12px; margin: 15px 0; font-size: 13px; color: #856404;">
                <strong>🏆 プレーオフ (CS) 進出の判定</strong><br>
                <div style="margin-top: 8px; line-height: 1.5;">
                • <strong>進出枠</strong>: 各リーグ<strong>上位3位</strong>がCS進出<br>
                • <strong>マジック</strong>: 4位の<strong>最大可能勝数</strong>を基準に、対象チームが到達すべき勝数（0以下で✓）<br>
                • <strong>エリミネート(E)</strong>: <code>(143+1) − 3位勝 − チーム敗 ≤ 0</code> または チーム最大可能勝数 ＜ 3位勝数
                </div>
            </div>
            <div class="leagues">
                <div>
                    <h3>セントラルリーグ (上位3チーム)</h3>
                    <table>
                        <thead>
                            <tr>
                                <th class="center">順位</th>
                                <th>チーム</th>
                                <th class="center">勝</th>
                                <th class="center">敗</th>
                                <th class="center">分</th>
                                <th class="center">勝率</th>
                                <th class="center">試合</th>
                                <th class="center">ゲーム差</th>
                                <th class="center">残り試合</th>
                                <th class="center">最大勝</th>
                                <th class="center">3位条件</th>
                                <th class="center">マジック</th>
                                <th class="center">エリミネート</th>
                                <th class="center">進出状況</th>
                            </tr>
                        </thead>
                        <tbody id="central-magic-playoff">
                            <tr><td colspan="14" class="loading">読み込み中...</td></tr>
                        </tbody>
                    </table>
                </div>
                <div>
                    <h3>パシフィックリーグ (上位3チーム)</h3>
                    <table>
                        <thead>
                            <tr>
                                <th class="center">順位</th>
                                <th>チーム</th>
                                <th class="center">勝</th>
                                <th class="center">敗</th>
                                <th class="center">分</th>
                                <th class="center">勝率</th>
                                <th class="center">試合</th>
                                <th class="center">ゲーム差</th>
                                <th class="center">残り試合</th>
                                <th class="center">最大勝</th>
                                <th class="center">3位条件</th>
                                <th class="center">マジック</th>
                                <th class="center">エリミネート</th>
                                <th class="center">進出状況</th>
                            </tr>
                        </thead>
                        <tbody id="pacific-magic-playoff">
                            <tr><td colspan="14" class="loading">読み込み中...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Scenarios -->
        <div id="scenarios" class="tab-content">
            <h2>経路の数 - 目標勝率達成に必要な勝数</h2>
            
            <div style="background: #e7f3ff; border: 1px solid #b3d7ff; border-radius: 4px; padding: 12px; margin: 15px 0; font-size: 13px; color: #004085;">
                <strong>📈 勝率別シナリオ分析</strong><br>
                <div style="margin-top: 8px; line-height: 1.5;">
                • <strong>目標勝率</strong>: 残り試合を30%〜90%の勝率で進めた場合の最終成績を予測<br>
                • <strong>必要勝数</strong>: 各勝率を達成するために残り試合で必要な勝利数<br>
                • <strong>最終勝率</strong>: シーズン終了時点の勝率予想（分は勝率に含めない）<br>
                • <strong>残り試合</strong>: <code>143 − 現在の試合数</code> を使用
                </div>
            </div>
            <div style="margin-bottom: 20px;">
                <h3>セントラルリーグ</h3>
                <div class="scroll-table">
                    <table style="font-size: 11px; border-collapse: collapse;">
                        <thead id="central-scenarios-header">
                            <!-- KBO 스타일 4줄 헤더 -->
                        </thead>
                        <tbody id="central-scenarios">
                            <tr><td colspan="20" class="loading">読み込み中...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div>
                <h3>パシフィックリーグ</h3>
                <div class="scroll-table">
                    <table style="font-size: 11px; border-collapse: collapse;">
                        <thead id="pacific-scenarios-header">
                            <!-- KBO 스타일 4줄 헤더 -->
                        </thead>
                        <tbody id="pacific-scenarios">
                            <tr><td colspan="20" class="loading">読み込み中...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Detailed Standings -->
        <div id="standings" class="tab-content">
            <h2>詳細順位表</h2>
            <div style="background: #f1f3f5; border: 1px solid #dee2e6; border-radius: 4px; padding: 10px; margin: 10px 0; font-size: 12px; color: #495057;">
                • <strong>勝率</strong>= 勝 / (勝+敗), <strong>残り</strong>= 143 − 試合, <strong>差</strong>= 首位からのゲーム差<br>
                • <strong>分</strong>は勝率に含まれません。表示は最新JSONに基づきます。
            </div>
            <div class="scroll-table">
                <h3>セントラルリーグ</h3>
                <table>
                    <thead>
                        <tr>
                            <th class="center">順位</th>
                            <th>チーム</th>
                            <th class="center">試合</th>
                            <th class="center">勝</th>
                            <th class="center">敗</th>
                            <th class="center">分</th>
                            <th class="center">勝率</th>
                            <th class="center">残り</th>
                            <th class="center">差</th>
                            <th class="center">ホーム</th>
                            <th class="center">ホーム率</th>
                            <th class="center">アウェー</th>
                            <th class="center">アウェー率</th>
                            <th class="center">最高順位</th>
                            <th class="center">最低順位</th>
                        </tr>
                    </thead>
                    <tbody id="central-detailed">
                        <tr><td colspan="15" class="loading">読み込み中...</td></tr>
                    </tbody>
                </table>
            </div>
            <div class="scroll-table" style="margin-top: 30px;">
                <h3>パシフィックリーグ</h3>
                <table>
                    <thead>
                        <tr>
                            <th class="center">順位</th>
                            <th>チーム</th>
                            <th class="center">試合</th>
                            <th class="center">勝</th>
                            <th class="center">敗</th>
                            <th class="center">分</th>
                            <th class="center">勝率</th>
                            <th class="center">残り</th>
                            <th class="center">差</th>
                            <th class="center">ホーム</th>
                            <th class="center">ホーム率</th>
                            <th class="center">アウェー</th>
                            <th class="center">アウェー率</th>
                            <th class="center">最高順位</th>
                            <th class="center">最低順位</th>
                        </tr>
                    </thead>
                    <tbody id="pacific-detailed">
                        <tr><td colspan="15" class="loading">読み込み中...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Remaining Games -->
        <div id="remaining" class="tab-content">
            <h2>チーム別残り試合数</h2>
            <div style="background: #f1f3f5; border: 1px solid #dee2e6; border-radius: 4px; padding: 10px; margin: 10px 0; font-size: 12px; color: #495057;">
                • <strong>残り試合</strong>= 143 − 現在の試合数（ホーム/アウェー配分は均等近似）<br>
                • <strong>対戦相手</strong>は簡易推定で、実際の日程と異なる場合があります。
            </div>
            <div class="leagues">
                <div>
                    <h3>セントラルリーグ</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>チーム</th>
                                <th class="center">試合</th>
                                <th class="center">残り試合</th>
                                <th class="center">ホーム</th>
                                <th class="center">アウェー</th>
                                <th class="center">対戦相手</th>
                            </tr>
                        </thead>
                        <tbody id="central-remaining">
                            <tr><td colspan="6" class="loading">読み込み中...</td></tr>
                        </tbody>
                    </table>
                </div>
                <div>
                    <h3>パシフィックリーグ</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>チーム</th>
                                <th class="center">試合</th>
                                <th class="center">残り試合</th>
                                <th class="center">ホーム</th>
                                <th class="center">アウェー</th>
                                <th class="center">対戦相手</th>
                            </tr>
                        </thead>
                        <tbody id="pacific-remaining">
                            <tr><td colspan="6" class="loading">読み込み中...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
    </main>

    <script>
        // ===== グローバル変数 =====
        let standingsData = null;      // 順位表データ
        let seasonConfig = null;       // シーズン設定データ  
        let TOTAL_GAMES = 143;         // NPB 正規シーズン: 1チーム143試合

        // ===== タブ切り替え機能 =====
        function showTab(tabId) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
                tab.setAttribute('aria-hidden', 'true');
            });
            
            // Reset all nav buttons
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
                tab.setAttribute('aria-selected', 'false');
            });
            
            // Show selected tab
            const selectedTab = document.getElementById(tabId);
            selectedTab.classList.add('active');
            selectedTab.setAttribute('aria-hidden', 'false');
            
            // Activate nav button
            event.target.classList.add('active');
            event.target.setAttribute('aria-selected', 'true');
        }


        // ===== 正規シーズン優勝マジック更新 =====
        function updateMagicRegular() {
            updateMagicTable('central-magic-regular', standingsData.central_league?.standings || [], true);
            updateMagicTable('pacific-magic-regular', standingsData.pacific_league?.standings || [], true);
        }

        // ===== プレーオフマジック更新 =====
        function updateMagicPlayoff() {
            updateMagicTable('central-magic-playoff', standingsData.central_league?.standings || [], false);
            updateMagicTable('pacific-magic-playoff', standingsData.pacific_league?.standings || [], false);
        }

        // ===== マジックナンバーテーブル更新（共通関数） =====
        function updateMagicTable(id, teams, isRegular) {
            const tbody = document.getElementById(id);
            if (!teams.length) {
                tbody.innerHTML = '<tr><td colspan="13" class="loading">データがありません</td></tr>';
                return;
            }

            const leader = teams[0];
            const thirdPlace = teams[2] || {};
            
            tbody.innerHTML = teams.map(team => {
                const rankClass = team.position_rank === 1 ? 'rank1' : 
                                 team.position_rank === 2 ? 'rank2' : 
                                 team.position_rank === 3 ? 'rank3' : '';
                
                const remainingGames = TOTAL_GAMES - team.games_played;
                const maxWins = team.wins + remainingGames;
                let magic = '-';
                let clinch = '-';
                let csConfirmed = '-';  // 플레이오프용 CS확정 변수
                let eliminate = '-';
                let condition = '-';
                
                if (isRegular) {
                    // 正規シーズン優勝マジックナンバー計算
                    if (team.position_rank === 1) {
                        const secondPlace = teams[1];
                        if (secondPlace && remainingGames > 0) {
                            // マジックナンバー = （2位チームの最大可能勝数） - （1位チームの現在勝数） + 1
                            const secondPlaceRemaining = TOTAL_GAMES - secondPlace.games_played;
                            const secondPlaceMaxWins = secondPlace.wins + secondPlaceRemaining;
                            const magicNumber = secondPlaceMaxWins - team.wins + 1;
                            
                            if (magicNumber <= 0) {
                                magic = '✓'; // 優勝確定済
                                clinch = '優勝';
                                condition = '確定';
                            } else {
                                magic = magicNumber;
                                condition = `${magicNumber}勝必要`;
                            }
                        } else if (remainingGames === 0) {
                            magic = '✓'; // シーズン終了
                            clinch = '確定';
                            condition = '確定';
                        }
                    } else {
                        // 2位以下チームの優勝条件: 1位チームが何勝以下で終わる必要があるか
                        const teamMaxWins = team.wins + remainingGames;
                        const leaderCurrentWins = leader.wins;
                        const leaderRemaining = TOTAL_GAMES - leader.games_played;
                        
                        if (teamMaxWins <= leaderCurrentWins) {
                            condition = '不可能';
                        } else {
                            // このチームが1位になるために1位チームが最大何勝までに抑える必要があるか
                            const leaderMaxAllowed = teamMaxWins - 1;
                            if (leaderMaxAllowed < leaderCurrentWins) {
                                condition = '不可能';
                            } else {
                                condition = `1位${leaderMaxAllowed}勝以下`;
                            }
                        }
                    }
                    
                    // 優勝エリミネート計算（1位に対する組み合わせ番号）
                    if (team.position_rank > 1) {
                        const teamMaxWins = team.wins + (TOTAL_GAMES - team.games_played); // = TOTAL_GAMES - losses - draws
                        const alreadyEliminated = leader.wins > teamMaxWins;
                        if (alreadyEliminated) {
                            eliminate = 'E';
                        } else {
                            // MLBの定義に準拠した組み合わせ式: G+1 - 1位勝 - 当該チーム敗
                            const combo = (TOTAL_GAMES + 1) - leader.wins - team.losses;
                            eliminate = combo <= 0 ? 'E' : combo;
                        }
                    }
                } else {
                    // 全チームの最大可能勝数を計算・ソート
                    const allMaxWins = teams.map(t => ({
                        team: t.team_abbreviation,
                        maxWins: t.wins + (TOTAL_GAMES - t.games_played)
                    })).sort((a, b) => b.maxWins - a.maxWins);
                    
                    // 3位カットライン（3番目の最大可能勝数）と4位の最大可能勝数
                    const thirdHighestMaxWins = allMaxWins[2] ? allMaxWins[2].maxWins : 0;
                    const fourthHighestMaxWins = allMaxWins[3] ? allMaxWins[3].maxWins : 0;
                    
                    // プレーオフマジック（4位の最大可能勝数基準）
                    if (team.playoff_magic !== undefined) {
                        clinch = team.playoff_magic === 0 ? '✓' : team.playoff_magic;
                    } else if (remainingGames > 0) {
                        if (fourthHighestMaxWins > 0) {
                            const need = fourthHighestMaxWins - team.wins + 1;
                            clinch = need <= 0 ? '✓' : need;
                        } else {
                            clinch = '✓';
                        }
                    }
                    
                    // CS進出確定判定: 現在の勝数が4位の最大可能勝数を上回るか
                    const teamMaxWins = team.wins + remainingGames;
                    if (team.wins > fourthHighestMaxWins) {
                        csConfirmed = 'CS確定';
                        condition = '確定';
                    } else if (team.wins === fourthHighestMaxWins) {
                        condition = '同率の可能性';
                    } else if (teamMaxWins < thirdHighestMaxWins) {
                        // 3位ラインに最大でも届かない場合は厳しい
                        condition = `3位${thirdHighestMaxWins}勝超必要`;
                    } else {
                        condition = `4位最大${fourthHighestMaxWins}勝`; // 目安情報
                    }
                    
                    // エリミネーション（3位の現在勝数基準の組み合わせ式）
                    if (team.playoff_elimination !== undefined) {
                        eliminate = team.playoff_elimination;
                    } else if (thirdPlace && thirdPlace.wins !== undefined) {
                        const teamMaxWinsPlayoff = team.wins + (TOTAL_GAMES - team.games_played);
                        const alreadyEliminated = teamMaxWinsPlayoff < thirdPlace.wins;
                        if (alreadyEliminated) {
                            eliminate = 'E';
                        } else {
                            // 3位に対する組み合わせ式: G+1 - 3位勝 - 当該チーム敗
                            const combo = (TOTAL_GAMES + 1) - thirdPlace.wins - team.losses;
                            eliminate = combo <= 0 ? 'E' : combo;
                        }
                    }
                }
                
                if (isRegular) {
                    // 정규시즌: 順位 チーム 勝 敗 分 勝率 ゲーム差 残り試合 最大勝 1位条件 マジック エリミネート 進出状況
                    return `
                        <tr class="${rankClass}">
                            <td class="center">${team.position_rank}</td>
                            <td>${team.team_abbreviation}</td>
                            <td class="center">${team.games_played}</td>
                            <td class="center win">${team.wins}</td>
                            <td class="center loss">${team.losses}</td>
                            <td class="center">${team.draws || 0}</td>
                            <td class="center pct">${team.win_percentage.toFixed(3)}</td>
                            <td class="center">${team.games_behind > 0 ? team.games_behind.toFixed(1) : '-'}</td>
                            <td class="center">${remainingGames}</td>
                            <td class="center">${maxWins}</td>
                            <td class="center" style="font-size: 11px;">${condition}</td>
                            <td class="center ${magic === '✓' ? 'clinched' : 'magic-number'}">${magic}</td>
                            <td class="center ${eliminate === 'E' ? 'eliminated' : ''}">${eliminate}</td>
                            <td class="center ${clinch !== '-' ? 'clinched' : ''}" style="font-size: 11px;">${clinch}</td>
                        </tr>
                    `;
                } else {
                    // 플레이오프: 順位 チーム 勝 敗 分 勝率 ゲーム差 残り試合 最大勝 3位条件 マジック エリミネート 進出状況
                    return `
                        <tr class="${rankClass}">
                            <td class="center">${team.position_rank}</td>
                            <td>${team.team_abbreviation}</td>
                            <td class="center">${team.games_played}</td>
                            <td class="center win">${team.wins}</td>
                            <td class="center loss">${team.losses}</td>
                            <td class="center">${team.draws || 0}</td>
                            <td class="center pct">${team.win_percentage.toFixed(3)}</td>
                            <td class="center">${team.games_behind > 0 ? team.games_behind.toFixed(1) : '-'}</td>
                            <td class="center">${remainingGames}</td>
                            <td class="center">${maxWins}</td>
                            <td class="center" style="font-size: 11px;">${condition}</td>
                            <td class="center ${clinch === '✓' ? 'clinched' : 'magic-number'}">${clinch}</td>
                            <td class="center ${eliminate === 'E' ? 'eliminated' : ''}">${eliminate}</td>
                            <td class="center ${csConfirmed !== '-' ? 'clinched' : ''}" style="font-size: 11px;">${csConfirmed}</td>
                        </tr>
                    `;
                }
            }).join('');
        }

        // ===== 詳細順位表更新 =====
        function updateDetailedStandings() {
            updateDetailedTable('central-detailed', standingsData.central_league?.standings || []);
            updateDetailedTable('pacific-detailed', standingsData.pacific_league?.standings || []);
        }

        // ===== 詳細順位テーブル更新（共通関数） =====
        function updateDetailedTable(id, teams) {
            const tbody = document.getElementById(id);
            if (!teams.length) {
                tbody.innerHTML = '<tr><td colspan="15" class="loading">データがありません</td></tr>';
                return;
            }

            tbody.innerHTML = teams.map(team => {
                const rankClass = team.position_rank === 1 ? 'rank1' : 
                                 team.position_rank === 2 ? 'rank2' : 
                                 team.position_rank === 3 ? 'rank3' : '';
                
                const remainingGames = TOTAL_GAMES - team.games_played;
                
                // ホーム/アウェイ分割シミュレート（実データなしの場合の仮計算）
                const homeAdvantage = seasonConfig?.display_config?.home_advantage || 0.55;
                const homeGames = Math.floor(team.games_played / 2);
                const awayGames = team.games_played - homeGames;
                const homeWins = Math.floor(team.wins * homeAdvantage); // ホームアドバンテージ計算
                const awayWins = team.wins - homeWins;
                const homeLosses = homeGames - homeWins;
                const awayLosses = awayGames - awayWins;
                const homeWinPct = homeGames > 0 ? (homeWins / homeGames).toFixed(3) : '0.000';
                const awayWinPct = awayGames > 0 ? (awayWins / awayGames).toFixed(3) : '0.000';
                
                // 最高/最低順位可能性計算
                const maxWins = team.wins + remainingGames;  // このチームの最大可能勝数
                const minWins = team.wins;                   // このチームの最小可能勝数（現在勝数）
                
                // 最高順位計算: 他チームが最悪成績で終わった場合
                let bestRank = 1;
                teams.forEach(other => {
                    if (other.team_id !== team.team_id) {
                        const otherMinWins = other.wins; // 他チームの最小勝数（現在勝数）
                        if (otherMinWins > maxWins) {
                            bestRank++; // このチームより上位確定
                        }
                    }
                });
                
                // 最低順位計算: 他チームが最高成績で終わった場合  
                let worstRank = 1;
                teams.forEach(other => {
                    if (other.team_id !== team.team_id) {
                        const otherMaxWins = other.wins + (TOTAL_GAMES - other.games_played);
                        if (otherMaxWins > minWins) {
                            worstRank++; // このチームより上位可能
                        }
                    }
                });
                
                // CS進出/脱落状況を用いた現実的な範囲補正（簡易）
                // 4位の最大可能勝数（全チームの最大可能勝数の4番目）
                const allMaxWins = teams
                    .map(t => t.wins + (TOTAL_GAMES - t.games_played))
                    .sort((a, b) => b - a);
                const fourthHighestMaxWins = allMaxWins[3] ?? 0;
                const thirdPlace = teams[2];
                
                // CS確定なら最低順位は3位以内
                if (team.wins > fourthHighestMaxWins) {
                    worstRank = Math.min(worstRank, 3);
                }
                // 3位の現在勝数に最大でも届かないなら最高順位は4位以下
                if (thirdPlace && (team.wins + remainingGames) < thirdPlace.wins) {
                    bestRank = Math.max(bestRank, 4);
                }

                // 順位は1-6位に制限
                bestRank = Math.min(bestRank, 6);
                worstRank = Math.min(worstRank, 6);
                
                return `
                    <tr class="${rankClass}">
                        <td class="center">${team.position_rank}</td>
                        <td>${team.team_abbreviation}</td>
                        <td class="center">${team.games_played}</td>
                        <td class="center win">${team.wins}</td>
                        <td class="center loss">${team.losses}</td>
                        <td class="center">${team.draws || 0}</td>
                        <td class="center pct">${team.win_percentage.toFixed(3)}</td>
                        <td class="center">${remainingGames}</td>
                        <td class="center">${team.games_behind > 0 ? team.games_behind.toFixed(1) : '-'}</td>
                        <td class="center">${homeWins}-${homeLosses}</td>
                        <td class="center">${homeWinPct}</td>
                        <td class="center">${awayWins}-${awayLosses}</td>
                        <td class="center">${awayWinPct}</td>
                        <td class="center">${bestRank}</td>
                        <td class="center">${worstRank}</td>
                    </tr>
                `;
            }).join('');
        }

        // ===== 勝率シナリオ分析更新 =====
        function updateScenarios() {
            updateScenariosTable('central-scenarios', standingsData.central_league?.standings || []);
            updateScenariosTable('pacific-scenarios', standingsData.pacific_league?.standings || []);
        }

        // ===== 勝率シナリオテーブル更新（共通関数） =====
        function updateScenariosTable(id, teams) {
            const tbody = document.getElementById(id);
            const headerId = id.replace('-scenarios', '-scenarios-header');
            const header = document.getElementById(headerId);
            const league = id.includes('central') ? 'central' : 'pacific';
            
            if (!teams.length) {
                tbody.innerHTML = '<tr><td colspan="20" class="loading">データがありません</td></tr>';
                return;
            }

            // Create KBO-style 4-row header
            if (header) {
                let headerHTML = `
                    <tr>
                        <td rowspan="4" style="background: #f8f9fa; font-weight: bold; vertical-align: middle; width: 60px;">최종승률</td>`;
                
                // Row 1: Team rankings
                teams.forEach(team => {
                    headerHTML += `<td class="center" style="background: #f0f0f0; font-weight: bold; padding: 4px;">${team.position_rank}위</td>`;
                });
                headerHTML += `</tr><tr>`;
                
                // Row 2: Team names
                teams.forEach(team => {
                    headerHTML += `<td class="center" style="background: #f8f9fa; font-weight: bold; padding: 4px;">${team.team_abbreviation}</td>`;
                });
                headerHTML += `</tr><tr>`;
                
                // Row 3: Current records + games played
                teams.forEach(team => {
                    headerHTML += `<td class="center" style="background: #f0f0f0; font-size: 11px; padding: 4px;">${team.wins}-${team.losses}-${team.draws || 0} (試合${team.games_played})</td>`;
                });
                headerHTML += `</tr><tr>`;
                
                // Row 4: Remaining games
                teams.forEach(team => {
                    const remaining = TOTAL_GAMES - team.games_played;
                    headerHTML += `<td class="center" style="background: #f8f9fa; font-size: 11px; padding: 4px;">잔여${remaining}</td>`;
                });
                headerHTML += `</tr>`;
                
                header.innerHTML = headerHTML;
            }

            // 表示する勝率ターゲット（高い順から） - 動的設定
            const winRateTargets = seasonConfig?.scenario_config?.win_rate_targets || [0.700, 0.650, 0.600, 0.550, 0.500, 0.450, 0.400, 0.350, 0.300];
            
            tbody.innerHTML = winRateTargets.map(targetRate => {
                let row = `<td class="center" style="background: #f8f9fa; font-weight: bold; padding: 4px; font-size: 12px;">${(targetRate * 100).toFixed(0)}%</td>`;
                
                teams.forEach(team => {
                    const remainingGames = TOTAL_GAMES - team.games_played;
                    const currentWins = team.wins;
                    const currentLosses = team.losses;
                    const currentDraws = team.draws || 0;
                    
                    // 目標勝率達成に必要な残り成績計算
                    const totalGamesMinusDraws = TOTAL_GAMES - currentDraws;
                    const requiredTotalWins = Math.ceil(targetRate * totalGamesMinusDraws);
                    const requiredWins = Math.max(0, requiredTotalWins - currentWins);
                    const requiredLosses = remainingGames - requiredWins;
                    
                    let cellContent = '';
                    let cellStyle = 'text-align: center; padding: 4px; font-size: 10px; min-width: 40px;';
                    
                    if (requiredWins > remainingGames) {
                        // 達成不可能
                        cellContent = '-';
                        cellStyle += 'background: #ffebee; color: #c62828;';
                    } else if (requiredWins <= 0) {
                        // 既に達成または容易
                        const finalRate = (currentWins / (TOTAL_GAMES - currentDraws)) * 100;
                        if (finalRate >= targetRate * 100) {
                            cellContent = '✓';
                            cellStyle += 'background: #e8f5e8; color: #2e7d32; font-weight: bold;';
                        } else {
                            cellContent = `${requiredWins}-${requiredLosses}`;
                            cellStyle += 'background: #e8f5e8; color: #2e7d32;';
                        }
                    } else {
                        // 必要成績表示: 勝-敗
                        cellContent = `${requiredWins}-${requiredLosses}`;
                        
                        // 最終勝率を0.500と比較して色分け
                        const finalRate = (currentWins + requiredWins) / (TOTAL_GAMES - currentDraws);
                        if (finalRate > 0.500) {
                            cellStyle += 'background: #e8f5e8; color: #2e7d32;'; // Green - above .500
                        } else if (finalRate === 0.500) {
                            cellStyle += 'background: #fff3e0; color: #f57c00;'; // Yellow - exactly .500
                        } else {
                            cellStyle += 'background: #ffebee; color: #c62828;'; // Red - below .500
                        }
                    }
                    
                    row += `<td style="${cellStyle}">${cellContent}</td>`;
                });
                
                return `<tr>${row}</tr>`;
            }).join('');
        }

        // ===== 残り試合数更新 =====
        function updateRemainingGames() {
            updateRemainingTable('central-remaining', standingsData.central_league?.standings || []);
            updateRemainingTable('pacific-remaining', standingsData.pacific_league?.standings || []);
        }

        // ===== 残り試合テーブル更新（共通関数） =====
        function updateRemainingTable(id, teams) {
            const tbody = document.getElementById(id);
            if (!teams.length) {
                tbody.innerHTML = '<tr><td colspan="6" class="loading">データがありません</td></tr>';
                return;
            }

            tbody.innerHTML = teams.map(team => {
                const remainingGames = TOTAL_GAMES - team.games_played;
                const homeRemaining = Math.floor(remainingGames / 2);
                const awayRemaining = remainingGames - homeRemaining;
                
                // 対戦相手の分布（仮データ）
                const opponents = teams
                    .filter(t => t.team_id !== team.team_id)
                    .map(t => `${t.team_abbreviation}(${Math.floor(remainingGames / 5)})`)
                    .slice(0, 3)
                    .join(', ');
                
                return `
                    <tr>
                        <td>${team.team_abbreviation}</td>
                        <td class="center">${team.games_played}</td>
                        <td class="center">${remainingGames}</td>
                        <td class="center">${homeRemaining}</td>
                        <td class="center">${awayRemaining}</td>
                        <td style="font-size: 11px;">${opponents}</td>
                    </tr>
                `;
            }).join('');
        }

        // ===== エラー表示機能 =====
        function showError(errorMsg = 'データ読み込みに失敗しました') {
            const errorHtml = `<tr><td colspan="15" class="loading">❌ ${errorMsg}</td></tr>`;
            document.querySelectorAll('tbody').forEach(tbody => {
                tbody.innerHTML = errorHtml;
            });
            
            // 에러 상세 정보 표시
            const errorDetail = document.createElement('div');
            errorDetail.style.cssText = 'position: fixed; top: 10px; right: 10px; background: #ffebee; color: #c62828; padding: 10px; border: 1px solid #e57373; border-radius: 4px; z-index: 1000; max-width: 300px;';
            errorDetail.innerHTML = `
                <strong>エラー詳細:</strong><br>
                ${errorMsg}<br>
                <small>ブラウザのコンソール(F12)で詳細を確認してください</small>
                <button onclick="this.parentNode.remove()" style="float: right; margin-left: 10px;">×</button>
            `;
            document.body.appendChild(errorDetail);
            
            // 5秒 후 자동 제거
            setTimeout(() => {
                if (errorDetail.parentNode) {
                    errorDetail.remove();
                }
            }, 5000); // 5秒後に自動除去
        }
        
        // ===== データパス取得（GitHub Pages対応） =====
        function getDataPath() {
            const hostname = window.location.hostname;
            const isGitHubPages = hostname.endsWith('.github.io') || hostname.includes('github');
            
            if (isGitHubPages) {
                // GitHub Pages: 절대 경로 사용
                const basePath = window.location.pathname.replace('/index.html', '').replace('/', '');
                return basePath ? `/${basePath}/data/standings.json` : '/data/standings.json';
            } else {
                // 로컬: 상대 경로 사용  
                return './data/standings.json';
            }
        }
        
        // ===== データ型正規化処理 =====
        function normalizeStandingsData(data) {
            if (!data) return data;
            
            // 각 리그의 팀 데이터 정규화
            ['central_league', 'pacific_league'].forEach(league => {
                if (data[league]?.standings) {
                    data[league].standings = data[league].standings.map(team => ({
                        ...team,
                        // 문자열을 숫자로 변환
                        win_percentage: parseFloat(team.win_percentage) || 0,
                        games_behind: parseFloat(team.games_behind) || 0,
                        wins: parseInt(team.wins) || 0,
                        losses: parseInt(team.losses) || 0,
                        draws: parseInt(team.draws) || 0,
                        games_played: parseInt(team.games_played) || 0,
                        runs_scored: parseInt(team.runs_scored) || 0,
                        runs_allowed: parseInt(team.runs_allowed) || 0,
                        run_differential: parseInt(team.run_differential) || 0
                    }));
                }
            });
            
            return data;
        }
        
        // ===== メインデータ読み込み処理 =====
        async function loadDataEnhanced() {
            try {
                
                // 순위 데이터 로딩 (cache-busting)
                const basePath = getDataPath();
                const cacheBust = `v=${Date.now()}`;
                const dataUrl = basePath + (basePath.includes('?') ? '&' : '?') + cacheBust;
                const response = await fetch(dataUrl);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${dataPath}`);
                }
                
                const rawData = await response.json();
                
                // 시즌 설정 데이터 로딩 (dashboard.json, cache-busting 동일 적용)
                try {
                    const dashboardBase = basePath.replace('standings.json', 'dashboard.json');
                    const dashboardUrl = dashboardBase + (dashboardBase.includes('?') ? '&' : '?') + cacheBust;
                    const dashboardResponse = await fetch(dashboardUrl);
                    if (dashboardResponse.ok) {
                        seasonConfig = await dashboardResponse.json();
                        // NPB 정규시즌은 팀당 143試合. 대시보드가 있더라도 TOTAL_GAMES는 143으로 고정.
                        if (seasonConfig.season_stats) {
                            const allTeams = [...(rawData.central_league?.standings || []), ...(rawData.pacific_league?.standings || [])];
                            const maxGamesPlayed = Math.max(...allTeams.map(t => t.games_played));
                            TOTAL_GAMES = 143;
                        }
                    }
                } catch (dashboardError) {
                    // ダッシュボードデータなし、デフォルト値使用
                }
                
                // 데이터 타입 정규화
                standingsData = normalizeStandingsData(rawData);
                
                if (standingsData.updated_at) {
                    document.getElementById('last-update').textContent = 
                        new Date(standingsData.updated_at).toLocaleString('ja-JP');
                }
                
                // 실제 통계 데이터 표시
                if (seasonConfig && seasonConfig.season_stats) {
                    const stats = seasonConfig.season_stats;
                    document.getElementById('total-games').textContent = `${stats.total_games}試合`;
                    document.getElementById('today-games').textContent = `${stats.today_games}試合`;
                }
                
                updateMagicRegular();
                updateMagicPlayoff();
                updateScenarios();
                updateDetailedStandings();
                updateRemainingGames();
                
            } catch (error) {
                showError(`データ読み込みエラー: ${error.message}`);
            }
        }
        
        document.addEventListener('DOMContentLoaded', loadDataEnhanced);
        window.reloadData = loadDataEnhanced;
    </script>
</body>
</html>
